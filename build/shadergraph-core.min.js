!function t(n,e,r){function i(u,s){if(!e[u]){if(!n[u]){var a="function"==typeof require&&require;if(!s&&a)return a(u,!0);if(o)return o(u,!0);throw new Error("Cannot find module '"+u+"'")}var c=e[u]={exports:{}};n[u][0].call(c.exports,function(t){var e=n[u][1][t];return i(e?e:t)},c,c.exports,t,n,e,r)}return e[u].exports}for(var o="function"==typeof require&&require,u=0;u<r.length;u++)i(r[u]);return i}({1:[function(t,n){var e,r;r=t("../graph"),e=function(){function t(){var t;this.node=new r.Node(this,null!=(t="function"==typeof this.makeOutlets?this.makeOutlets():void 0)?t:{})}return t.prototype.link=function(){},t.prototype.call=function(t,n){null==n&&(n=0)},t.prototype.externals=function(){return{}},t.prototype._link=function(t,n,e,r,i){return n.link(this.node,t,r,i)},t.prototype._include=function(t,n){return n.include(this.node,t)},t.prototype._call=function(t,n,e,r){var i,o,u,s,a,c,l,p,h,f,d;for(n.call(this.node,t,r),u=null,f=this.node.inputs,p=0,h=f.length;h>p;p++)if(c=f[p],l=null!=(d=c.input)?d.node.owner:void 0,"("===c.type[0]){null==u&&(u=this._externals());for(s in u)i=u[s],i.name===c.name&&(a=s,o=i);null!=l&&l.link(n,e,a,o,c)}else null!=l&&l.call(n,e,r+1);return n},t}(),n.exports=e},{"../graph":8}],2:[function(t,n){var e,r,i,o,u={}.hasOwnProperty,s=function(t,n){function e(){this.constructor=t}for(var r in n)u.call(n,r)&&(t[r]=n[r]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t};i=t("../graph"),e=t("./block"),o=t("../linker"),r=function(t){function n(t){this.graph=t,n.__super__.constructor.apply(this,arguments),this.namespace=o.entry()}return s(n,t),n.prototype.makeOutlets=function(){var t,n,e,r,o,u,s,a,c,l,p;for(e=[],t=[],r=[],l=this.graph.inputs(),u=0,a=l.length;a>u;u++)n=l[u],t.push(n.type);for(p=this.graph.outputs(),s=0,c=p.length;c>s;s++)n=p[s],r.push(n.type);return t=t.join(","),r=r.join(","),o="("+t+")("+r+")",e.push({name:"callback",type:o,inout:i.OUT}),e},n.prototype.fetch=function(){return this.make(phase),this.subroutine},n.prototype.make=function(t){return this.subroutine=o.compile(this.graph.tail().owner,t,this.namespace)},n.prototype.link=function(t,n,e,r){return this.make(n),this._include(this.subroutine,t),this._link(this.subroutine,t,n,e,r)},n.prototype._externals=function(){var t,n;return null!=(t=null!=(n=this.subroutine)?n.externals:void 0)?t:{}},n}(e),n.exports=r},{"../graph":8,"../linker":14,"./block":1}],3:[function(t,n,e){e.Block=t("./block"),e.Shader=t("./shader"),e.Isolate=t("./isolate"),e.Callback=t("./callback"),e.Material=t("./material")},{"./block":1,"./callback":2,"./isolate":4,"./material":5,"./shader":6}],4:[function(t,n){var e,r,i,o,u={}.hasOwnProperty,s=function(t,n){function e(){this.constructor=t}for(var r in n)u.call(n,r)&&(t[r]=n[r]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t};r=t("../graph"),e=t("./block"),o=t("../linker"),i=function(t){function n(t){this.graph=t,n.__super__.constructor.apply(this,arguments),this.namespace=o.entry()}return s(n,t),n.prototype.makeOutlets=function(){var t,n,e,r,i,o,u,s;for(n=[],u=this.graph.inputs(),e=0,i=u.length;i>e;e++)t=u[e],n.push(t);for(s=this.graph.outputs(),r=0,o=s.length;o>r;r++)t=s[r],n.push(t);return n},n.prototype.make=function(t){return this.subroutine=o.compile(this.graph.tail().owner,t,this.namespace)},n.prototype.fetch=function(t){var n;return t=function(){var e,r,i,o;for(i=this.graph.outputs(),o=[],e=0,r=i.length;r>e;e++)n=i[e],n.name===t.name&&o.push(n);return o}.call(this)[0],null!=t?t.node.owner.fetch(t):void 0},n.prototype.link=function(t,n,e,r,i){var o;return o=fetch(i),this._include(o,t),this._link(o,t,n,e,r)},n.prototype.call=function(t,n,e){return null==e&&(e=0),this.make(n),this._call(this.subroutine,t,n,e)},n.prototype._externals=function(){var t,n;return null!=(t=null!=(n=this.subroutine)?n.externals:void 0)?t:{}},n}(e),n.exports=i},{"../graph":8,"../linker":14,"./block":1}],5:[function(t,n){var e,r,i,o={}.hasOwnProperty,u=function(t,n){function e(){this.constructor=t}for(var r in n)o.call(n,r)&&(t[r]=n[r]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t};e=t("./block"),i=t("./block"),r=function(t){function n(t,e){var r,i,o,u,s,a,c;for(this.vertex=t,this.fragment=e,this.snippets=[this.vertex,this.fragment],this.namespace=this.vertex.namespace,this.externals={},a=this.snippets,u=0,s=a.length;s>u;u++){o=a[u],c=o.externals;for(i in c)r=c[i],this.externals[i]=r}n.__super__.constructor.apply(this,arguments)}return u(n,t),n.prototype.makeOutlets=function(){var t,n,e,r,i,o,u,s;for(e=[],u=this.snippets,i=0,o=u.length;o>i;i++){r=u[i],e=e.concat(r.main.signature),s=r.externals;for(n in s)t=s[n],e.push(t)}return e},n.prototype.get=function(t){return this.snippets[{vertex:0,fragment:1}[t]]},n.prototype.call=function(t,n,e){var r;return null==e&&(e=0),r=get(n),this._call(r,t,n,e)},n.prototype._externals=function(){return this.externals},n}(e),n.exports=i},{"./block":1}],6:[function(t,n){var e,r,i={}.hasOwnProperty,o=function(t,n){function e(){this.constructor=t}for(var r in n)i.call(n,r)&&(t[r]=n[r]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t};e=t("./block"),r=function(t){function n(t){this.snippet=t,this.namespace=this.snippet.namespace,n.__super__.constructor.apply(this,arguments)}return o(n,t),n.prototype.makeOutlets=function(){var t,n,e,r;e=[],e=e.concat(this.snippet.main.signature),r=this.snippet.externals;for(n in r)t=r[n],e.push(t);return e},n.prototype.call=function(t,n,e){return null==e&&(e=0),this._call(this.snippet,t,n,e)},n.prototype._externals=function(){return this.snippet.externals},n}(e),n.exports=r},{"./block":1}],7:[function(t,n){var e;e=function(){function t(t,n){this.parent=null!=n?n:null,this.nodes=[],t&&this.add(t)}return t.IN=0,t.OUT=1,t.prototype.inputs=function(){var t,n,e,r,i,o,u,s,a;for(t=[],s=this.nodes,r=0,o=s.length;o>r;r++)for(n=s[r],a=n.inputs,i=0,u=a.length;u>i;i++)e=a[i],null===e.input&&t.push(e);return t},t.prototype.outputs=function(){var t,n,e,r,i,o,u,s,a;for(e=[],s=this.nodes,r=0,o=s.length;o>r;r++)for(t=s[r],a=t.outputs,i=0,u=a.length;u>i;i++)n=a[i],0===n.output.length&&e.push(n);return e},t.prototype.tail=function(){return this.nodes[this.nodes.length-1]},t.prototype.add=function(t,n){var e,r,i;{if(!t.length){if(t.graph&&!n)throw"Adding node to two graphs at once";return t.graph=this,this.nodes.push(t)}for(e=0,r=t.length;r>e;e++)i=t[e],this.add(i)}},t.prototype.remove=function(t,n){var e,r,i;{if(!t.length){if(t.graph!==this)throw"Removing node from wrong graph.";return n||t.disconnect(),this.nodes.splice(this.nodes.indexOf(t),1),t.graph=null}for(e=0,r=t.length;r>e;e++)i=t[e],this.remove(i)}},t.prototype.adopt=function(t){var n,e,r;{if(!t.length)return t.graph.remove(t,!0),this.add(t,!0);for(n=0,e=t.length;e>n;n++)r=t[n],this.adopt(r)}},t}(),n.exports=e},{}],8:[function(t,n,e){e.Graph=t("./graph"),e.Node=t("./node"),e.Outlet=t("./outlet"),e.IN=e.Graph.IN,e.OUT=e.Graph.OUT},{"./graph":7,"./node":9,"./outlet":10}],9:[function(t,n){var e,r,i;e=t("./graph"),i=t("./outlet"),r=function(){function t(t,n){this.owner=t,this.graph=null,this.inputs=[],this.outputs=[],this.outlets=null,this.setOutlets(n)}return t.prototype.getIn=function(t){var n;return function(){var e,r,i,o;for(i=this.inputs,o=[],e=0,r=i.length;r>e;e++)n=i[e],n.name===t&&o.push(n);return o}.call(this)[0]},t.prototype.getOut=function(t){var n;return function(){var e,r,i,o;for(i=this.outputs,o=[],e=0,r=i.length;r>e;e++)n=i[e],n.name===t&&o.push(n);return o}.call(this)[0]},t.prototype.get=function(t){return this.getIn(t)||this.getOut(t)},t.prototype.setOutlets=function(t){var n,e,r,o,u,s,a,c,l,p,h,f,d;if(o=function(t){return new i(t.inout,t.name,t.hint,t.type,t.meta)},null!=t){if(null==this.outlets){for(this.outlets={},a=0,p=t.length;p>a;a++)s=t[a],this._add(o(s));return}for(e=function(t){return[t.name,t.inout,t.type].join("-")},u={},c=0,h=t.length;h>c;c++)s=t[c],u[e(s)]=!0;d=this.outlets;for(r in d)s=d[r],r=e(s),u[r]?u[r]=s:this._remove(s);for(l=0,f=t.length;f>l;l++)s=t[l],n=u[e(s)],n instanceof i?this._morph(n,s):this._add(o(s))}return this.outlets},t.prototype.connect=function(t,n,e){var r,i,o,u,s,a,c,l,p,h,f,d;for(s={},i={},f=t.inputs,c=0,p=f.length;p>c;c++)u=f[c],(e||!u.input)&&(a=u.type,r=[a,u.hint].join("-"),i[r]||(i[r]=u),s[a]=s[a]||[],s[a].push(u));for(d=this.outputs,l=0,h=d.length;h>l;l++)u=d[l],n&&u.output.length||(a=u.type,r=[a,u.hint].join("-"),o=s[a],i[r]?(i[r].connect(u),delete i[r],o.splice(o.indexOf(u),1)):o&&o.length&&o.shift().connect(u));return this},t.prototype.disconnect=function(){var t,n,e,r,i,o,u;for(o=this.inputs,n=0,r=o.length;r>n;n++)t=o[n],t.disconnect();for(u=this.outputs,e=0,i=u.length;i>e;e++)t=u[e],t.disconnect();return this},t.prototype._key=function(t){return[t.name,t.inout].join("-")},t.prototype._add=function(t){var n;if(n=this._key(t),t.node)throw"Adding outlet to two nodes at once.";if(this.outlets[n])throw"Adding two identical outlets to same node. ("+n+")";return t.setNode(this),t.inout===e.IN&&this.inputs.push(t),t.inout===e.OUT&&this.outputs.push(t),this.outlets[n]=t},t.prototype._morph=function(t,n){var e;return e=this._key(n),delete this.outlets[e],t.morph(n),e=this._key(n),this.outlets[e]=n},t.prototype._remove=function(t){var n,r;if(r=this._key(t),n=t.inout,t.node!==this)throw"Removing outlet from wrong node.";return t.disconnect(),t.setNode(null),delete this.outlets[r],t.inout===e.IN&&this.inputs.splice(this.inputs.indexOf(t),1),t.inout===e.OUT&&this.outputs.splice(this.outputs.indexOf(t),1),this},t}(),n.exports=r},{"./graph":7,"./outlet":10}],10:[function(t,n){var e,r;e=t("./graph"),r=function(){function t(n,e,r,i,o){this.inout=n,this.name=e,this.hint=r,this.type=i,this.meta=o,null==this.hint&&(this.hint=e),this.node=null,this.input=null,this.output=[],this.id=t.id(this.hint)}return t.index=0,t.id=function(n){return"_io_"+ ++t.index+"_"+n},t.prototype.morph=function(t){return this.inout=t.inout,this.name=t.name,this.hint=t.hint,this.type=t.type,this.meta=t.meta},t.prototype.connect=function(t){if(this.inout===e.IN&&t.inout===e.OUT)return t.connect(this);if(this.inout!==e.OUT||t.inout!==e.IN)throw"Can only connect out to in.";if(t.input!==this)return t.disconnect(),t.input=this,this.output.push(t)},t.prototype.disconnect=function(t){var n,e,r,i;if(this.input&&this.input.disconnect(this),this.output.length){if(!t){for(i=this.output,e=0,r=i.length;r>e;e++)t=i[e],t.input=null;return this.output=[]}if(n=this.output.indexOf(t),n>=0)return this.output.splice(n,1),t.input=null}},t.prototype.setNode=function(t){this.node=t},t}(),n.exports=r},{"./graph":7}],11:[function(t,n){var e,r,i,o,u,s,a,c,l,p,h;e=t("./linker"),r=function(){function n(t){return null==t&&(t={}),this instanceof n?void(this.library=new e.Library(t)):new n(t)}return n.prototype.shader=function(){return new e.Factory(this.library)},n.Graph=t("./graph"),n.Snippet=t("./snippet"),n.Block=t("./block"),n.Linker=t("./linker"),n}(),n.exports=r,window.ShaderGraph=r,i="float foobar(vec3 color) {\n  return color.x;\n}",o="void foobar(out float valueOut, in float valueIn) {\n  valueOut = valueIn * 2.0;\n}",u="float callback(vec3 color);\nvoid main(in vec3 color) {\n  float f = callback(color);\n}",h={code1:i,code2:o,code3:u},l=r(h),c=l.shader(),s=c.group().snippet("code1").snippet("code2").callback().snippet("code3").end(),p=s.compile(),a=function(t){var n,e,r,i;return n={},e=i=r=0,t=t.replace(/\b_io_[0-9]+([A-Za-z0-9_]+)\b/g,function(t,r){var i;return null!=(i=n[t])?i:n[t]="_io_"+ ++e+r}),t=t.replace(/\b_sn_[0-9]+([A-Za-z0-9_]+)\b/g,function(t,e){var r;return null!=(r=n[t])?r:n[t]="_sn_"+ ++i+e}),t=t.replace(/\b_pg_[0-9]+_\b/g,function(t){var e;return null!=(e=n[t])?e:n[t]="_pg_"+ ++r+"_"})},window.graph=s,window.snippet=p,window.code=a(p.code)},{"./block":3,"./graph":8,"./linker":14,"./snippet":19}],12:[function(t,n){var e,r,i,o;e=t("../graph"),r="_i_n_o_u_t",i="return",o=function(t,n,o,u,s){var a,c,l,p,h,f,d,g,v,m,y,_,x,k,b,w,M;return h={},M={},a={},g=[],x=function(){var t,e,r,i,f;for(i=0,f=s.length;f>i;i++)r=s[i],d(r.node,r.module);return u=l(u),""!==u&&g.push(u),t=p(o),null!=n&&(t.entry=n),x=c(t),g.push(x.code),e=g.join("\n"),{namespace:x.name,code:e,main:x,entry:x.name,externals:h,uniforms:M,attributes:a}},d=function(t,n){var e,r,i,o,u,s,c,l;g.push(n.code),u=n.uniforms;for(r in u)e=u[r],M[r]=e;s=n.attributes;for(r in s)e=s[r],a[r]=e;c=n.externals,l=[];for(r in c)e=c[r],i=e.name,o=t.get(i),l.push(o.input?void 0:h[r]=e);return l},f=function(t){return t.replace(r,"")},m=function(t){var n;return n=f(t),n!==t},v=function(t,n){var r;return r=t.get(n),r.inout===e.IN?null===r.input:r.inout===e.OUT?0===r.output.length:void 0},_=function(t,n){var e;return e=t.get(n),e.input&&(e=e.input),n=e.name,m(n)?_(e.node,f(n)):e.id},b=function(t,n,e,r,o){var u,s,a,c,l,p,h,f;for(s=[],p="",h=0,f=r.length;f>h;h++)if(u=r[h],l=u.param,c=u.name,!m(c)&&(a=t(c),c===i?p=""+a+" = ":s.push(a),o))if(n(c))if(c===i){if(""!==o["return"])throw"Error: two unconnected return values within same graph";o.type=u.spec,o["return"]="  return "+a+";\n",o.vars[a]="  "+l(a),o.signature.push(u)}else o.params.push(l(a,!0)),o.signature.push(u.copy(a));else o.vars[a]="  "+l(a);return s=s.join(", "),"  "+p+e+"("+s+")"},l=function(t){var n;return function(){var e,r,i;for(i=[],e=0,r=t.length;r>e;e++)n=t[e],i.push(y(n));return i}().join(";\n")},w=function(t,n){var e,r,o,u,s;for(o=u=0,s=t.length;s>u;o=++u){if(e=t[o],r=n[o],!r)return!1;if(e.type!==r.type)return!1;if(e.name===i!=(r.name===i))return!1}return!0},y=function(){return function(t){var n,r,o,u,s,a,l,p,h,f,d,g,v,m,y,_,M,T,j,O,P,C,E,I,S;if(d=t.node,h=t.module,f=t.name,u=t.external,x=h.main,o=h.entry,w(x.signature,u.signature))return"#define "+f+" "+o;for(a=[],m=[],p={},y=[h.namespace,i].join(""),I=u.signature,T=0,O=I.length;O>T;T++)n=I[T],l=n.inout===e.IN?a:m,l.push(n);for(S=x.signature,j=0,P=S.length;P>j;j++)n=S[j],l=n.inout===e.IN?a:m,g=l.shift(),E=g.name,E===i&&(E=y),p[n.name]=E;return C=function(t){return p[t]},M=function(){return!0},s=k(),r=b(C,M,o,x.signature,s),p={"return":y},C=function(t){var n;return null!=(n=p[t])?n:t},v=k(),_=b(C,M,o,u.signature,v),v.calls=[r],v.entry=f,c(v).code}}(this),p=function(){return function(t){var n,e,r,i,o,u,s;for(r=function(t,e){var r,i,o;return d(t,e),x=e.main,r=e.entry,o=function(n){return _(t,n)},i=function(n){return v(t,n)},n.calls.push(b(o,i,r,x.signature,n))},n=k(),i=function(){var n;n=[];for(o in t)e=t[o],n.push(e);return n}(),i.sort(function(t,n){return n.priority-t.priority}),u=0,s=i.length;s>u;u++)e=i[u],r(e.node,e.module);return n}}(this),k=function(){return{entry:null,vars:{},"return":"",type:"void",calls:[],params:[],signature:[]}},c=function(t){var e,r,i,u,s,a,c,l,p,h,f,d,g,v,m;return a=null!=(m=t.entry)?m:n,u=null,1===t.calls.length&&(g=function(){var t;t=[];for(c in o)i=o[c],t.push(i);return t}()[0],e=t,r=g.module,w(t.signature,r.main.signature)&&(u="#define "+a+" "+r.entry)),null==u&&(d=function(){var n,e;n=t.vars,e=[];for(f in n)s=n[f],e.push(s);return e}(),l=t.params,v=t.calls,h=t.type,p=t["return"],v.push(""),d.length?(d.push(""),d=d.join(";\n")+"\n"):d="",v=v.join(";\n"),l=l.join(", "),u=""+h+" "+a+"("+l+") {\n"+d+v+p+"}"),{signature:t.signature,code:u,name:a}},x()},n.exports=o},{"../graph":8}],13:[function(t,n){var e,r,i,o,u;i=t("../graph"),e=t("../block"),o=t("./program"),r=function(){function t(t){this.library=t,this.end()}return t.prototype.snippet=function(t,n){return this._append(this._shader(t,n))},t.prototype.material=function(t,n,e){return this._append(this._material(t,n,e))},t.prototype.group=function(){return this._push(),this._push(),this},t.prototype.next=function(){var t;return t=this._pop(),this._state.start=this._state.start.concat(t.start),this._state.end=this._state.end.concat(t.end),this._state.nodes=this._state.nodes.concat(t.nodes),this._push(),this},t.prototype.combine=function(){var t,n,e,r,i,o,u,s,a,c,l;for(a=this._combine(),e=a[0],n=a[1],c=e.start,i=0,u=c.length;u>i;i++)for(r=c[i],l=n.end,o=0,s=l.length;s>o;o++)t=l[o],t.connect(r,!0);return n.end=e.end,this},t.prototype.isolate=function(){var t,n,r,i,o;return o=this._combine(),r=o[0],n=o[1],r.nodes.length&&(i=this._subgraph(r),t=new e.Isolate(i),this._append(t.node)),this},t.prototype.callback=function(){var t,n,r,i,o;return o=this._combine(),r=o[0],n=o[1],r.nodes.length&&(i=this._subgraph(r),t=new e.Callback(i),this._append(t.node)),this},t.prototype.pass=function(){return this.next(),this._state.end=this._stack[2].end,this.combine()},t.prototype.end=function(){var t;return t=this.graph,this.graph=new i.Graph,this._state=new u,this._stack=[this._state],t&&(t.compile=function(){return o.compile(t.tail().owner)}),t},t.prototype.compile=function(){return this.end().compile()},t.prototype.concat=function(t){var n,e,r,i,o,u,s,a,c;for(e=t._state,this.graph.adopt(e.nodes),a=e.start,i=0,u=a.length;u>i;i++)for(r=a[i],c=this._state.end,o=0,s=c.length;s>o;o++)n=c[o],n.connect(r);return this._state.start.length||(this._state.start=e.start),this._state.end=e.end,this._state.nodes=this._state.nodes.concat(e.nodes),t.end(),this},t.prototype.link=function(t){return this.group(),this.concat(t),this.callback()},t.prototype._shader=function(t,n){var r,i;return i=this.library.fetch(t),i.apply(n),r=new e.Shader(i),r.node},t.prototype._material=function(t,n,r){var i;return t=this.library.fetch(t),n=this.library.fetch(n),t.apply(r),n.apply(r,t.namespace),i=new e.Material(t,n),i.node},t.prototype._subgraph=function(t){var n;return n=new i.Graph,n.adopt(t.nodes),n},t.prototype._combine=function(){if(this._stack.length<=2)throw"Popping factory stack too far";return this.next()._pop(),[this._pop(),this._state]},t.prototype._push=function(){return this._stack.unshift(new u),this._state=this._stack[0]},t.prototype._pop=function(){return this._state=this._stack[1],this._stack.shift()},t.prototype._append=function(t){var n,e,r,i;for(this.graph.add(t),i=this._state.end,e=0,r=i.length;r>e;e++)n=i[e],n.connect(t);return this._state.start.length||(this._state.start=[t]),this._state.end=[t],this._state.nodes.push(t),this},t.prototype._prepend=function(t){var n,e,r,i;for(this.graph.add(t),i=this._state.start,e=0,r=i.length;r>e;e++)n=i[e],t.connect(n);return this._state.end.length||(this._state.end=[t]),this._state.start=[t],this._state.nodes.push(t),this},t}(),u=function(){function t(t,n,e){this.start=null!=t?t:[],this.end=null!=n?n:[],this.nodes=null!=e?e:[]}return t}(),n.exports=r},{"../block":3,"../graph":8,"./program":16}],14:[function(t,n,e){e.Factory=t("./factory"),e.Library=t("./library"),e.Program=t("./program"),e.assemble=t("./assemble"),e.compile=e.Program.compile,e.entry=e.Program.entry},{"./assemble":12,"./factory":13,"./library":15,"./program":16}],15:[function(t,n){var e,r;r=t("../snippet"),e=function(){function t(t){this.snippets=null!=t?t:{},this.objects={}}return t.prototype.fetch=function(t){if(null==this.snippets[t])throw"Unknown snippet `"+t+"`";return null==this.objects[t]&&(this.objects[t]=r.load(t,this.snippets[t])),this.objects[t].clone()},t}(),n.exports=e},{"../snippet":19}],16:[function(t,n){var e,r,i;r=t("../snippet").Snippet,i=t("./assemble"),e=function(){function t(t,n){this.block=t,this.namespace=n,this.included={},this.includes=[],this.calls={},this.links=[]}return t.index=0,t.entry=function(){return"_pg_"+ ++t.index+"_"},t.compile=function(n,e,r){var i;return i=new t(n,r),i.compile(e)},t.prototype.compile=function(n){var e,r;return e=this.block.node.graph,this.block.call(this,n,0),this._snippet(i(n,null!=(r=this.namespace)?r:t.entry(),this.calls,this.links,this.includes))},t.prototype.link=function(t,n,e,r){return this.links.push({node:t,module:n,name:e,external:r})},t.prototype.include=function(t,n){return this.included[n.namespace]?void 0:(this.included[n.namespace]=!0,this.includes.push({node:t,module:n}))},t.prototype.call=function(t,n,e){var r,i;return i=n.namespace,(r=this.calls[i])?r.priority=Math.max(r.priority,e):this.calls[i]={node:t,module:n,priority:e},this},t.prototype._snippet=function(t){var n,e;e=new r;for(n in t)e[n]=t[n];return e},t}(),n.exports=e},{"../snippet":19,"./assemble":12}],17:[function(t,n){var e,r,i,o,u;u=t("./walk"),o=function(){var t;return t=+new Date,function(n){var e;return e=+new Date-t,console.log(n,e+" ms"),e}},r=function(t){var n,e,r,i,o,u,s,a,c,l;for(e={},r=function(t){return e[t.name]=!0},r(t.main),c=["external","internal","varying","uniform"],o=0,s=c.length;s>o;o++)for(n=c[o],l=t[n],u=0,a=l.length;a>u;u++)i=l[u],r(i);return e},e=function(t){var n,e,o,u,s;return e=t.ast,o=t.code,s=t.signatures,u=r(s),n=i(o,u),[s,n]},i=function(t,n){var e,r;return r=new RegExp("\\b("+function(){var t;t=[];for(e in n)t.push(e);return t}().join("|")+")\\b","g"),t=t.replace(/\/\/[^\n]*/g,""),t=t.replace(/\/\*([^*]|\*[^\/])*\*\//g,""),t=t.replace(/^#[^\n]*/gm,""),function(i,o){var u,s;null==i&&(i=""),null==o&&(o={}),u={};for(e in n)u[e]=i+(null!=(s=o[e])?s:e);return t.replace(r,function(t){return u[t]})}},n.exports=e},{"./walk":22}],18:[function(t,n){var e,r;n.exports=e={},e["in"]=0,e.out=1,e.inout=2,r=function(t){return t.token.data},e.node=function(t){var n,r;return"function"===(null!=(n=t.children[5])?n.type:void 0)?e["function"](t):"keyword"===(null!=(r=t.token)?r.type:void 0)?e.external(t):void 0},e.external=function(t){var n,e,i,o,u,s,a,c,l,p,h,f,d;for(n=t.children,c=r(n[1]),l=r(n[3]),p=r(n[4]),o=n[5],"attribute"!==c&&"uniform"!==c&&"varying"!==c&&(c="global"),s=[],d=o.children,e=h=0,f=d.length;f>h;e=++h)n=d[e],"ident"===n.type&&(i=r(n),u=o.children[e+1],a="quantifier"===(null!=u?u.type:void 0),s.push({decl:"external",storage:c,type:p,ident:i,quant:!!a}));return s},e["function"]=function(t){var n,i,o,u,s,a,c,l,p,h;return o=t.children,l=r(o[1]),p=r(o[3]),h=r(o[4]),a=o[5],c=r(a.children[0]),n=a.children[1],i=a.children[2],s=function(){var t,r,i,o;for(i=n.children,o=[],t=0,r=i.length;r>t;t++)u=i[t],o.push(e.argument(u));return o}(),[{decl:"function",storage:l,type:h,ident:c,body:!!i,args:s}]},e.argument=function(t){var n,e,i,o,u,s,a;return n=t.children,s=r(n[1]),i=r(n[2]),a=r(n[4]),o=n[5],e=r(o.children[0]),u=o.children[1],{decl:"argument",storage:s,inout:i,type:a,ident:e,quant:!!u}},e.param=function(t,n,e,r){var i,o;return i=[],null!=n&&i.push(n),null!=e&&i.push(e),i.push(""),i=i.join(" "),o=r?"["+r+"]":"",""!==t&&(t+=" "),function(n,e){return(e?t:"")+(""+i+n+o)}},e.type=function(t,n,r,i,o){var u,s,a,c,l,p,h,f,d;return p={"float":"f",vec2:"v2",vec3:"v3",vec4:"v4",mat3:"m3",mat4:"m4",sampler2D:"t",samplerCube:"t"},u={"float":0,vec2:window.THREE?new THREE.Vector3:null,vec3:window.THREE?new THREE.Vector3:null,vec4:window.THREE?new THREE.Vector4:null,mat4:window.THREE?new THREE.Matrix4:null,sampler2D:0,samplerCube:0},s={"in":e["in"],out:e.out,inout:e.inout},l={"const":"const"},h=p[n],r&&(h+="v"),f=u[h],a=null!=(d=s[i])?d:s["in"],o=l[o],c=e.param(i,o,n,r),{name:t,type:h,spec:n,param:c,value:f,inout:a,copy:function(t){return e.copy(this,t)}}},e.copy=function(t,n){var e,r,i,o,u,s,a;return a=t,i=a.name,t=a.type,u=a.spec,o=a.param,s=a.value,r=a.inout,e=a.copy,null!=n&&(i=n),{name:i,type:t,spec:u,param:o,value:s,inout:r,copy:e}}},{}],19:[function(t,n,e){e.Snippet=t("./snippet"),e.parse=t("./parse"),e.compile=t("./compile"),e.decl=t("./decl"),e.load=e.Snippet.load},{"./compile":17,"./decl":18,"./parse":20,"./snippet":21}],20:[function(t,n){var e,r,i,o,u,s,a,c,l,p,h,f,d,g,v;g=t("../../vendor/glsl-tokenizer"),p=t("../../vendor/glsl-parser"),u=t("./decl"),v=t("./walk"),o=!1,e="_i_n_o_u_t",r="return",d=function(){var t;return t=+new Date,function(n){var e;return e=+new Date-t,console.log(n,e+" ms"),e}},c=function(t,n){var e,r;return e=l(t,n),r=h(e,n)},l=function(t,n){var e,r,i,u,s,a,c,l;if(o&&(u=d()),c=g().process(p(),n),l=c[0],e=l[0],i=c[1],o&&u("GLSL Tokenize & Parse"),!e||i.length){for(s=0,a=i.length;a>s;s++)r=i[s],console.error("[ShaderGraph] "+t+" -",r.message);throw"GLSL parse error"}return e},h=function(t,n){var e,r,u,c,l,p,h;return o&&(p=d()),l=[],v(a,i(l),t,""),h=f(l),u=h[0],r=h[1],e=h[2],c=s(u,r,e),o&&p("GLSL AST"),{ast:t,code:n,signatures:c}},a=function(t,n){switch(t.type){case"decl":return n(u.node(t)),!1}return!0},i=function(t){return function(n){var e,r,i,o;if(null!=n){for(o=[],r=0,i=n.length;i>r;r++)e=n[r],o.push(t.push(e));return o}}},f=function(t){var n,e,r,i,o,u,s,a;for(i=null,r=[],e=[],o={},s=0,a=t.length;a>s;s++)u=t[s],u.body?(o[u.ident]&&(e=function(){var t,r,i;for(i=[],t=0,r=e.length;r>t;t++)n=e[t],n.ident!==u.ident&&i.push(n);return i}(),delete o[u.ident]),r.push(u),i=u):"global"===u.storage?r.push(u):(e.push(u),o[u.ident]=!0);return[i,r,e]},s=function(t,n,i){var o,s,a,c,l,p,h,f,d;for(c={uniform:[],attribute:[],varying:[],external:[],internal:[],global:[],main:null},s=function(t){return u.type(t.ident,t.type,t.quant,t.inout,t.storage)},a=function(t,n){var i,o,a,c,l,p,h,f,d,g,v;for(f=function(){var n,e,r,i;for(r=t.args,i=[],n=0,e=r.length;e>n;n++)o=r[n],i.push(s(o));return i}(),g=0,v=f.length;v>g;g++)c=f[g],c.inout===u.inout&&(i=c,a=c.copy(),i.inout=u["in"],a.inout=u.out,a.name+=e,f.push(a));return"void"!==t.type&&f.push(u.type(r,t.type,!1,"out")),p=function(){var t,n,e;for(e=[],t=0,n=f.length;n>t;t++)c=f[t],c.inout===u["in"]&&e.push(c.type);return e}().join(","),h=function(){var t,n,e;for(e=[],t=0,n=f.length;n>t;t++)c=f[t],c.inout===u.out&&e.push(c.type);return e}().join(","),d="("+p+")("+h+")",l={name:t.ident,type:d,signature:f,inout:n,spec:t.type}},c.main=a(t,u.out),p=0,f=n.length;f>p;p++)l=n[p],c.internal.push({name:l.ident});for(h=0,d=i.length;d>h;h++)switch(l=i[h],l.decl){case"external":o=s(l),c[l.storage].push(o);break;case"function":o=a(l,u["in"]),c.external.push(o)}return c},n.exports=c},{"../../vendor/glsl-parser":23,"../../vendor/glsl-tokenizer":27,"./decl":18,"./walk":22}],21:[function(t,n){var e,r,i;i=t("./parse"),r=t("./compile"),e=function(){function t(t,n){this._signatures=t,this._assembler=n,this.namespace=null,this.code=null,this.main=null,this.entry=null,this.uniforms=null,this.externals=null,this.attributes=null}return t.index=0,t.namespace=function(){return"_sn_"+ ++t.index+"_"},t.load=function(n,e){var o,u,s,a;return u=i(n,e),a=r(u),s=a[0],o=a[1],new t(s,o)},t.prototype.clone=function(){return new t(this._signatures,this._assembler)},t.prototype.apply=function(n,e){var r,i,o,u,s,a,c,l,p,h,f,d,g,v;for(this.namespace=e,null==this.namespace&&(this.namespace=t.namespace()),this.code=this._assembler(this.namespace),this.main=this._signatures.main,this.entry=this.namespace+this.main.name,this.uniforms={},this.externals={},this.attributes={},s=function(t){return function(n,e){return t.uniforms[t.namespace+(null!=e?e:n.name)]=n}}(this),o=function(t){return function(n){return t.externals[t.namespace+n.name]=n}}(this),r=function(t){return function(n){return t.attributes[n.name]=n}}(this),d=this._signatures.uniform,a=0,p=d.length;p>a;a++)i=d[a],s(i);for(g=this._signatures.external,c=0,h=g.length;h>c;c++)i=g[c],o(i);for(v=this._signatures.attribute,l=0,f=v.length;f>l;l++)i=v[l],r(i);for(u in n)i=n[u],s(i,u);return null},t}(),n.exports=e},{"./compile":17,"./parse":20}],22:[function(t,n){var e,r;e=!1,r=function(t,n,i,o){var u,s,a,c,l,p,h,f;if(e&&console.log(o,i.type,null!=(p=i.token)?p.data:void 0,null!=(h=i.token)?h.type:void 0),a=t(i,n))for(f=i.children,s=c=0,l=f.length;l>c;s=++c)u=f[s],r(t,n,u,o+"  ",e);return null},n.exports=r},{}],23:[function(t,n){n.exports=t("./lib/index")},{"./lib/index":25}],24:[function(t,n){function e(){return this}function r(t,n){var e=m[t];return n=n||0,e?n>e.lbp&&(e.lbp=n):(e=Object.create(v),e.id=t,e.lbp=n,m[t]=e),e}function i(t){var n,e=f;for(l(),n=e.nud();t<f.lbp;)e=f,l(),n=e.led(n);return n}function o(t,n,e){var o=r(t,n);o.led=e||function(t){return this.children=[t,i(n)],this.type="binary",this}}function u(t,n,e){var o=r(t,n);return o.led=e||function(t){return this.children=[t,i(n-1)],this.type="binary",this},o}function s(t,n){var e=r(t);return e.nud=n||function(){return this.children=[i(70)],this.type="unary",this},e}function a(t){var n=r(t,150);n.led=function(t){return this.children=[t],this.type="suffix",this}}function c(t){return u(t,10,function(t){return this.children=[t,i(9)],this.assignment=!0,this.type="assign",this})}function l(t){var n,r,i,o;if(t&&f.data!==t)return h.unexpected("expected `"+t+"`, got `"+f.data+"`");if(g>=d.length)return void(f=m["(end)"]);if(n=d[g++],r=n.data,i=n.type,"ident"===i)o=h.scope.find(r)||h.create_node(),i=o.type;else if("builtin"===i)o=m["(builtin)"];else if("keyword"===i)o=m["(keyword)"];else if("operator"===i){if(o=m[r],!o)return h.unexpected("unknown operator `"+r+"`")}else{if("float"!==i&&"integer"!==i)return h.unexpected("unexpected token.");i="literal",o=m["(literal)"]}return o&&(o.nud||(o.nud=e),o.children||(o.children=[])),o=Object.create(o),o.token=n,o.type=i,o.data||(o.data=r),f=o}function p(t){return function(){return h.unexpected(t)}}var h,f,d,g,v={nud:function(){return this.children&&this.children.length?this:p("unexpected")()},led:p("missing operator")},m={};r("(ident)").nud=e,r("(keyword)").nud=e,r("(builtin)").nud=e,r("(literal)").nud=e,r("(end)"),r(":"),r(";"),r(","),r(")"),r("]"),r("}"),u("&&",30),u("||",30),o("|",43),o("^",44),o("&",45),o("==",46),o("!=",46),o("<",47),o("<=",47),o(">",47),o(">=",47),o(">>",48),o("<<",48),o("+",50),o("-",50),o("*",60),o("/",60),o("%",60),o("?",20,function(t){return this.children=[t,i(0),(l(":"),i(0))],this.type="ternary",this}),o(".",80,function(t){return f.type="literal",h.fake(f),this.children=[t,f],l(),this}),o("[",80,function(t){return this.children=[t,i(0)],this.type="binary",l("]"),this}),o("(",80,function(t){if(this.children=[t],this.type="call",")"!==f.data)for(;;){if(this.children.push(i(0)),","!==f.data)break;l(",")}return l(")"),this}),s("-"),s("+"),s("!"),s("~"),s("defined"),s("(",function(){return this.type="group",this.children=[i(0)],l(")"),this}),s("++"),s("--"),a("++"),a("--"),c("="),c("+="),c("-="),c("*="),c("/="),c("%="),c("&="),c("|="),c("^="),c(">>="),c("<<="),n.exports=function(t,n){function e(t){h.unshift(t,!1);for(var n=0,r=t.children.length;r>n;++n)e(t.children[n]);h.shift()}h=t,d=n,g=0;var r;if(d.length){if(l(),r=i(0),r.parent=h[0],e(r),g<d.length)throw new Error("did not use all tokens");r.parent.children=[r]}}},{}],25:[function(t,n){function e(){function t(t){if("whitespace"===t.type||"line-comment"===t.type||"block-comment"===t.type)return void Xn.push(t);for(Wn.push(t),Sn=Sn||Wn[0],Sn&&Xn.length&&(Sn.preceding=Sn.preceding||[],Sn.preceding=Sn.preceding.concat(Xn),Xn=[]);e();)switch(Kn[0].mode){case d:W();break;case g:V();break;case _:X();break;case x:Y();break;case M:en();break;case v:kn(!0,!0);break;case T:bn();break;case f:nn();break;case P:tn();break;case C:$();break;case m:Cn();break;case y:En();break;case k:Mn();break;case b:On();break;case D:Pn();break;case E:jn();break;case w:Tn();break;case q:wn()}}function n(n){return arguments.length&&t(n),Kn.length>1?void ln("unexpected EOF"):void Zn.emit("end")}function e(){return Yn||!Kn.length?!1:(Sn=Wn[0])&&!Zn.paused}function h(t){Kn.unshift(t),Kn.shift()}function j(t,n){t.parent=Kn[0];var e=[].unshift.call(this,t);if(n=void 0===n?!0:n,p){for(var r="",i=0,o=this.length-1;o>i;++i)r+=" |";console.log(r,"\\"+t.type,t.token.data)}return n&&Fn!==t&&Fn.children.push(t),Fn=t,e}function O(){var t=[].shift.call(this),n=Jn[this.length],e=!1;if(p){for(var r="",i=0,o=this.length;o>i;++i)r+=" |";console.log(r,"/"+t.type)}return Jn.length?"function"==typeof Jn[0]?e=Jn[0](t):void 0!==n&&(e=n.test?n.test(t.type):n===t.type):e=!0,e&&Zn.emit("data",t),Fn=t.parent,t}function V(){function t(){if(Sn.data===Kn[0].expecting)return Kn.scope.exit(),Kn.shift();switch(Sn.type){case"preprocessor":return Kn.fake(on()),void Wn.shift();default:return void Kn.unshift(Ln())}}return fn(function(){return Kn.scope.enter(),l},t)()}function W(){if(Kn[0].brace)return"}"!==Sn.data?ln("expected `}`, got "+Sn.data):(Kn[0].brace=!1,Wn.shift(),Kn.shift());switch(Sn.type){case"eof":return Kn.shift();case"keyword":switch(Sn.data){case"for":return Kn.unshift(Gn());
case"if":return Kn.unshift(zn());case"while":return Kn.unshift(An());case"do":return Kn.unshift(Hn());case"break":return Kn.fake(r(I,Sn)),Wn.shift();case"continue":return Kn.fake(r(S,Sn)),Wn.shift();case"discard":return Kn.fake(r(F,Sn)),Wn.shift();case"return":return Kn.unshift(Bn());case"precision":return Kn.unshift(Nn())}return Kn.unshift(un(B));case"ident":var t;if(t=Kn.scope.find(Sn.data))return Kn.unshift("struct"===t.parent.type?un(B):an(";"));case"operator":if("{"===Sn.data){Kn[0].brace=!0;var n=Dn();return n.expecting="}",Wn.shift(),Kn.unshift(n)}if(";"===Sn.data)return Wn.shift(),Kn.shift();default:return Kn.unshift(an(";"))}}function X(){function t(){return"invariant"===Sn.data?d.flags&U?(Kn.unshift(cn()),l):ln("`invariant` is not allowed here"):(Kn.fake(r(L,{data:"",position:Sn.position})),l)}function n(){return i(Sn)?d.flags&G?(Kn.unshift(cn()),l):ln("storage is not allowed here"):(Kn.fake(r(L,{data:"",position:Sn.position})),l)}function e(){return o(Sn)?d.flags&z?ln("parameter is not allowed here"):(Kn.unshift(cn()),l):(Kn.fake(r(L,{data:"",position:Sn.position})),l)}function s(){return u(Sn)?(Kn.unshift(cn()),l):(Kn.fake(r(L,{data:"",position:Sn.position})),l)}function a(){if("struct"===Sn.data)return d.flags&A?(Kn.unshift(sn()),l):ln("cannot nest structs");if("keyword"===Sn.type)return Kn.unshift(cn()),l;var t=Kn.scope.find(Sn.data);return t?(Kn.fake(Object.create(t)),Wn.shift(),l):ln("expected user defined type, struct or keyword, got "+Sn.data)}function c(){return","!==Sn.data||d.flags&R?"["===Sn.data?void Kn.unshift(Qn()):")"===Sn.data?Kn.shift():";"===Sn.data?d.stage+3:"ident"!==Sn.type?ln("expected identifier, got "+Sn.data):(d.collected_name=Wn.shift(),l):Kn.shift()}function p(){return"("===Sn.data?(Wn.unshift(d.collected_name),delete d.collected_name,Kn.unshift(Vn()),d.stage+2):l}function h(){return Wn.unshift(d.collected_name),delete d.collected_name,Kn.unshift(qn()),l}function f(){return Kn.shift()}var d=Kn[0];return fn(t,n,e,s,a,c,p,h,f)()}function Y(){if("ident"===Sn.type){var t=Sn.data;return Kn.unshift(Rn()),void Kn.scope.define(t)}if("operator"===Sn.type){if(","===Sn.data)return Kn[1].flags&R?Wn.shift():Kn.shift();if("="===Sn.data)return Kn[1].flags&N?(Wn.shift(),void Kn.unshift(an(",",";"))):ln("`=` is not allowed here.");if("["===Sn.data)return void Kn.unshift(Qn())}return Kn.shift()}function $(){return"keyword"===Sn.type?(Kn[0].type="keyword",void(Kn[0].mode=P)):"ident"===Sn.type?(Kn[0].type="ident",void(Kn[0].mode=f)):ln("expected keyword or user-defined name, got "+Sn.data)}function tn(){return"keyword"!==Sn.type?ln("expected keyword, got "+Sn.data):(Kn.shift(),Wn.shift())}function nn(){return"ident"!==Sn.type?ln("expected user-defined name, got "+Sn.data):(Kn[0].data=Sn.data,Kn.shift(),Wn.shift())}function en(){function t(t){return a(Kn,t),Kn.shift()}var n=Kn[0].expecting;if(Kn[0].tokens=Kn[0].tokens||[],void 0===Kn[0].parenlevel&&(Kn[0].parenlevel=0,Kn[0].bracelevel=0),Kn[0].parenlevel<1&&n.indexOf(Sn.data)>-1)return t(Kn[0].tokens);switch("("===Sn.data?++Kn[0].parenlevel:")"===Sn.data&&--Kn[0].parenlevel,Sn.data){case"{":++Kn[0].bracelevel;break;case"}":--Kn[0].bracelevel;break;case"(":++Kn[0].parenlevel;break;case")":--Kn[0].parenlevel}return Kn[0].parenlevel<0?ln("unexpected `)`"):Kn[0].bracelevel<0?ln("unexpected `}`"):void Kn[0].tokens.push(Wn.shift())}function rn(t){return function(){return r(t,Sn)}}function on(){return r(K[Sn.type],Sn,Fn)}function un(t){var n=r(_,Sn,Fn);return n.flags=t,n}function sn(t,n){var e=r(v,Sn,Fn);return e.allow_assign=void 0===t?!0:t,e.allow_comma=void 0===n?!0:n,e}function an(){var t=r(M,Sn,Fn);return t.expecting=[].slice.call(arguments),t}function cn(t){var n=Sn;return t&&(n={type:"(implied)",data:"(default)",position:n.position}),r(P,n,Fn)}function ln(t){Yn=!0,Zn.emit("error",new Error((t||"unexpected "+Kn)+" at line "+Kn[0].token.line))}function pn(t,n){return hn(t,Sn.type)&&hn(n,Sn.data)}function hn(t,n){switch(typeof t){case"string":return n!==t&&ln("expected `"+t+"`, got "+n+"\n"+Sn.data),!Yn;case"object":return t&&-1===t.indexOf(n)&&ln("expected one of `"+t.join("`, `")+"`, got "+n),!Yn}return!0}function fn(){var t,n,e=[].slice.call(arguments);return function(){var r=Kn[0];return r.stage||(r.stage=0),(t=e[r.stage])?(n=t(),n===l?++r.stage:void(void 0!==n&&(r.stage=n))):ln("parser in undefined state!")}}function dn(t,n){return n=n||"operator",function(){if(pn(n,t)){var e=Wn.shift(),r=Kn[0].children,i=r[r.length-1];return i&&i.token&&e.preceding&&(i.token.succeeding=i.token.succeeding||[],i.token.succeeding=i.token.succeeding.concat(e.preceding)),l}}}function gn(t){return function(){return Kn.unshift(an(t)),l}}function vn(t){return t?function(){var t=Sn.data;return pn("ident")&&(Kn.unshift(Rn()),Kn.scope.define(t),l)}:function(){if(pn("ident")){var t=Object.create(Kn.scope.find(Sn.data));return t.token=Sn,Wn.shift(),l}}}function mn(){return function(){var t=Dn();return t.expecting="}",Kn.unshift(t),l}}function yn(t){return function(){var n=Kn[0].stage;return"{"!==Sn.data?(Kn.unshift(Ln()),n+t):(Wn.shift(),l)}}function _n(){return function(){return Kn.shift(),Kn.shift()}}function xn(){kn=fn(dn("struct","keyword"),function(){return"{"===Sn.data?(Kn.fake(r(f,{data:"",position:Sn.position,type:"ident"})),l):vn(!0)()},function(){return Kn.scope.enter(),l},dn("{"),function(){return"}"===Sn.data?(Kn.scope.exit(),Wn.shift(),Kn.shift()):";"===Sn.data?void Wn.shift():void Kn.unshift(un(Q))}),bn=fn(function(){return Wn.shift(),l},function(){return pn("keyword",["lowp","mediump","highp"])&&(Kn.unshift(cn()),l)},function(){return Kn.unshift(cn()),l},function(){return Kn.shift()}),wn=fn(dn("["),gn("]"),dn("]"),function(){return Kn.shift()}),Mn=fn(dn("for","keyword"),dn("("),function(){var t;if("ident"===Sn.type){if((t=Kn.scope.find(Sn.data))||(t=Kn.create_node()),"struct"===t.parent.type)return Kn.unshift(un(B)),l}else if("builtin"===Sn.type||"keyword"===Sn.type)return Kn.unshift(un(B)),l;return gn(";")()},dn(";"),gn(";"),dn(";"),gn(")"),dn(")"),yn(3),mn(),dn("}"),_n()),Tn=fn(dn("if","keyword"),dn("("),gn(")"),dn(")"),yn(3),mn(),dn("}"),function(){return"else"===Sn.data?(Wn.shift(),Kn.unshift(Ln()),l):_n()()},_n()),jn=fn(dn("return","keyword"),function(){return";"===Sn.data?l:(Kn.unshift(an(";")),l)},function(){Wn.shift(),_n()()}),On=fn(dn("while","keyword"),dn("("),gn(")"),dn(")"),yn(3),mn(),dn("}"),_n()),Pn=fn(dn("do","keyword"),yn(3),mn(),dn("}"),dn("while","keyword"),dn("("),gn(")"),dn(")"),_n()),Cn=fn(function(){for(var t=1,n=Kn.length;n>t;++t)if(Kn[t].mode===m)return ln("function definition is not allowed within another function");return l},function(){if(pn("ident")){var t=Sn.data,n=Kn.scope.find(t);return Kn.unshift(Rn()),Kn.scope.define(t),Kn.scope.enter(n?n.scope:null),l}},dn("("),function(){return Kn.unshift(Un()),l},dn(")"),function(){return";"===Sn.data?(Kn.scope.exit(),Kn.shift(),Kn.shift()):l},dn("{"),mn(),dn("}"),function(){return Kn.scope.exit(),l},function(){return Kn.shift(),Kn.shift(),Kn.shift()}),En=fn(function(){return"void"===Sn.data?(Kn.fake(cn()),Wn.shift(),l):")"===Sn.data?void Kn.shift():"struct"===Sn.data?(Kn.unshift(sn(Z,J)),l):(Kn.unshift(un(H)),l)},function(){return","===Sn.data?(Wn.shift(),0):")"===Sn.data?void Kn.shift():void ln("expected one of `,` or `)`, got "+Sn.data)})}var kn,bn,wn,Mn,Tn,jn,On,Pn,Cn,En,In,Sn,Fn,Dn=rn(g),Ln=rn(d),qn=rn(x),Nn=rn(T),Rn=rn(f),Vn=(rn(C),rn(m)),Un=rn(y),Gn=rn(k),zn=rn(w),An=rn(b),Bn=rn(E),Hn=rn(D),Qn=rn(q),Zn=s(t,n),Jn=arguments.length?[].slice.call(arguments):[],Kn=[],Wn=[],Xn=[],Yn=!1;return Kn.shift=O,Kn.unshift=j,Kn.fake=h,Kn.unexpected=ln,Kn.scope=new c(Kn),Kn.create_node=function(){var t=r(f,Sn);return t.parent=Zn.program,t},xn(),Fn=Dn(),Fn.expecting="(eof)",Fn.mode=g,Fn.token={type:"(program)",data:"(program)"},In=Fn,Zn.program=In,Zn.scope=function(t){return 1===arguments.length&&(Kn.scope=t),Kn.scope},Kn.unshift(Fn),Zn}function r(t,n){return{mode:t,token:n,children:[],type:W[t]}}function i(t){return"const"===t.data||"attribute"===t.data||"uniform"===t.data||"varying"===t.data}function o(t){return"in"===t.data||"inout"===t.data||"out"===t.data}function u(t){return"highp"===t.data||"mediump"===t.data||"lowp"===t.data}n.exports=e;var s=t("../../through"),a=t("./expr"),c=t("./scope"),l=new Object,p=!1,h=0,f=h++,d=h++,g=h++,v=h++,m=h++,y=h++,_=h++,x=h++,k=h++,b=h++,w=h++,M=h++,T=h++,j=h++,O=h++,P=h++,C=h++,E=h++,I=h++,S=h++,F=h++,D=h++,L=h++,q=h++,N=1,R=2,V=4,U=8,G=16,z=32,A=64,B=255,H=B&~(N|R|z|U|V),Q=B&~(N|U|G|A),Z=!1,J=!1,K={"block-comment":j,"line-comment":j,preprocessor:O},W=h=["ident","stmt","stmtlist","struct","function","functionargs","decl","decllist","forloop","whileloop","if","expr","precision","comment","preprocessor","keyword","keyword_or_ident","return","break","continue","discard","do-while","placeholder","quantifier"]},{"../../through":31,"./expr":24,"./scope":26}],26:[function(t,n){function e(t){return this.constructor!==e?new e(t):(this.state=t,this.scopes=[],void(this.current=null))}n.exports=e;var r=e,i=r.prototype;i.enter=function(t){this.scopes.push(this.current=this.state[0].scope=t||{})},i.exit=function(){this.scopes.pop(),this.current=this.scopes[this.scopes.length-1]},i.define=function(t){this.current[t]=this.state[0]},i.find=function(t){for(var n=this.scopes.length-1;n>-1;--n)if(this.scopes[n].hasOwnProperty(t))return this.scopes[n][t];return null}},{}],27:[function(t,n){function e(){function t(t){t.length&&q.queue({type:k[V],data:t,position:z,line:G})}function n(t){for(N=0,H+=t.toString(),L=H.length;F=H[N],L>N;)switch(V){case c:N=j();break;case l:N=T();break;case p:N=M();break;case h:N=O();break;case f:N=E();break;case x:N=C();break;case d:N=I();break;case a:N=S();break;case y:N=w();break;case s:N=b()}R+=N,H=H.slice(N)}function e(){U.length&&t(U.join("")),V=_,t("(eof)"),q.queue(null)}function b(){return U=U.length?[]:U,"/"===D&&"*"===F?(z=R+N-1,V=c,D=F,N+1):"/"===D&&"/"===F?(z=R+N-1,V=l,D=F,N+1):"#"===F?(V=p,z=R+N,N):/\s/.test(F)?(V=y,z=R+N,N):(A=/\d/.test(F),B=/[^\w_]/.test(F),z=R+N,V=A?f:B?h:a,N)}function w(){return"\n"===F&&++G,/[^\s]/g.test(F)?(t(U.join("")),V=s,N):(U.push(F),D=F,N+1)}function M(){return"\n"===F&&++G,"\n"===F&&"\\"!==D?(t(U.join("")),V=s,N):(U.push(F),D=F,N+1)}function T(){return M()}function j(){return"/"===F&&"*"===D?(U.push(F),t(U.join("")),V=s,N+1):("\n"===F&&++G,U.push(F),D=F,N+1)}function O(){if("."===D&&/\d/.test(F))return V=d,N;if("/"===D&&"*"===F)return V=c,N;if("/"===D&&"/"===F)return V=l,N;if("."===F&&U.length){for(;P(U););return V=d,N}if(";"===F){if(U.length)for(;P(U););return t(F),V=s,N+1}var n=2===U.length&&"="!==F;if(/[\w_\d\s]/.test(F)||n){for(;P(U););return V=s,N}return U.push(F),D=F,N+1}function P(n){for(var e,r=0,i=n.length;;){e=o.indexOf(n.slice(0,n.length+r).join(""));{if(-1!==e)return t(o[e]),z+=o[e].length,U=U.slice(o[e].length),U.length;if(r-=1,i-=1,0>i)return 0}}}function C(){return/[^a-fA-F0-9]/.test(F)?(t(U.join("")),V=s,N):(U.push(F),D=F,N+1)}function E(){return"."===F?(U.push(F),V=d,D=F,N+1):/[eE]/.test(F)?(U.push(F),V=d,D=F,N+1):"x"===F&&1===U.length&&"0"===U[0]?(V=x,U.push(F),D=F,N+1):/[^\d]/.test(F)?(t(U.join("")),V=s,N):(U.push(F),D=F,N+1)}function I(){return"f"===F&&(U.push(F),D=F,N+=1),/[eE]/.test(F)?(U.push(F),D=F,N+1):/[^\d]/.test(F)?(t(U.join("")),V=s,N):(U.push(F),D=F,N+1)}function S(){if(/[^\d\w_]/.test(F)){var n=U.join("");return V=i.indexOf(n)>-1?m:u.indexOf(n)>-1?v:g,t(U.join("")),V=s,N}return U.push(F),D=F,N+1}var F,D,L,q=r(n,e),N=0,R=0,V=s,U=[],G=1,z=0,A=!1,B=!1,H="";return q}n.exports=e;var r=t("../through"),i=t("./lib/literals"),o=t("./lib/operators"),u=t("./lib/builtins"),s=999,a=9999,c=0,l=1,p=2,h=3,f=4,d=5,g=6,v=7,m=8,y=9,_=10,x=11,k=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"]},{"../through":31,"./lib/builtins":28,"./lib/literals":29,"./lib/operators":30}],28:[function(t,n){n.exports=["gl_Position","gl_PointSize","gl_ClipVertex","gl_FragCoord","gl_FrontFacing","gl_FragColor","gl_FragData","gl_FragDepth","gl_Color","gl_SecondaryColor","gl_Normal","gl_Vertex","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_FogCoord","gl_MaxLights","gl_MaxClipPlanes","gl_MaxTextureUnits","gl_MaxTextureCoords","gl_MaxVertexAttribs","gl_MaxVertexUniformComponents","gl_MaxVaryingFloats","gl_MaxVertexTextureImageUnits","gl_MaxCombinedTextureImageUnits","gl_MaxTextureImageUnits","gl_MaxFragmentUniformComponents","gl_MaxDrawBuffers","gl_ModelViewMatrix","gl_ProjectionMatrix","gl_ModelViewProjectionMatrix","gl_TextureMatrix","gl_NormalMatrix","gl_ModelViewMatrixInverse","gl_ProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverse","gl_TextureMatrixInverse","gl_ModelViewMatrixTranspose","gl_ProjectionMatrixTranspose","gl_ModelViewProjectionMatrixTranspose","gl_TextureMatrixTranspose","gl_ModelViewMatrixInverseTranspose","gl_ProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixInverseTranspose","gl_TextureMatrixInverseTranspose","gl_NormalScale","gl_DepthRangeParameters","gl_DepthRange","gl_ClipPlane","gl_PointParameters","gl_Point","gl_MaterialParameters","gl_FrontMaterial","gl_BackMaterial","gl_LightSourceParameters","gl_LightSource","gl_LightModelParameters","gl_LightModel","gl_LightModelProducts","gl_FrontLightModelProduct","gl_BackLightModelProduct","gl_LightProducts","gl_FrontLightProduct","gl_BackLightProduct","gl_FogParameters","gl_Fog","gl_TextureEnvColor","gl_EyePlaneS","gl_EyePlaneT","gl_EyePlaneR","gl_EyePlaneQ","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_ObjectPlaneR","gl_ObjectPlaneQ","gl_FrontColor","gl_BackColor","gl_FrontSecondaryColor","gl_BackSecondaryColor","gl_TexCoord","gl_FogFragCoord","gl_Color","gl_SecondaryColor","gl_TexCoord","gl_FogFragCoord","gl_PointCoord","radians","degrees","sin","cos","tan","asin","acos","atan","pow","exp","log","exp2","log2","sqrt","inversesqrt","abs","sign","floor","ceil","fract","mod","min","max","clamp","mix","step","smoothstep","length","distance","dot","cross","normalize","faceforward","reflect","refract","matrixCompMult","lessThan","lessThanEqual","greaterThan","greaterThanEqual","equal","notEqual","any","all","not","texture2D","texture2DProj","texture2DLod","texture2DProjLod","textureCube","textureCubeLod"]},{}],29:[function(t,n){n.exports=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"]},{}],30:[function(t,n){n.exports=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"]},{}],31:[function(t,n){var e;e=function(t,n){var e,r;return r=[],e=[],{output:r,parser:null,write:t,end:n,process:function(n,e){return this.parser=n,t(e),this.flush(),this.parser.flush()},flush:function(){return n(),[r,e]},queue:function(t){var n;return null!=t?null!=(n=this.parser)?n.write(t):void 0:void 0},emit:function(t,n){return"data"===t&&null==n.parent&&r.push(n),"error"===t?e.push(n):void 0}}},n.exports=e},{}]},{},[11]);