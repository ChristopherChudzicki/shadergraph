!function t(e,n,r){function i(u,s){if(!n[u]){if(!e[u]){var a="function"==typeof require&&require;if(!s&&a)return a(u,!0);if(o)return o(u,!0);throw new Error("Cannot find module '"+u+"'")}var c=n[u]={exports:{}};e[u][0].call(c.exports,function(t){var n=e[u][1][t];return i(n?n:t)},c,c.exports,t,e,n,r)}return n[u].exports}for(var o="function"==typeof require&&require,u=0;u<r.length;u++)i(r[u]);return i}({1:[function(t,e){var n,r,i;r=t("./graph"),i=function(){function t(t,e){this.start=null!=t?t:[],this.end=null!=e?e:[]}return t}(),n=function(){function t(t){this.library=t,this.end()}return t.prototype.snippet=function(t,e){var n,r;return r=this.library.fetch(t),n=r.apply(e),this},t.prototype.append=function(t){var e,n,r,i;for(this.graph.add(t),i=this._state.end,n=0,r=i.length;r>n;n++)e=i[n],e.connect(t);return this._state.start.length||(this._state.start=[t]),this._state.end=[t],this},t.prototype.prepend=function(t){var e,n,r,i;for(this.graph.add(t),i=this._state.start,n=0,r=i.length;r>n;n++)e=i[n],t.connect(e);return this._state.end.length||(this._state.end=[t]),this._state.start=[t],this},t.prototype.group=function(){return this._push(),this._push()},t.prototype.pass=function(){return this.next(),this._state.start.push(null),this.combine()},t.prototype.next=function(){var t;return t=this._pop(),this._state.start=this._state.start.concat(t.start),this._state.end=this._state.end.concat(t.end),this._push()},t.prototype.combine=function(){var t,e,n,r,i,o,u,s,a,c;if(this._stack.length<=2)throw"Popping factory stack too far";if(this.next()._pop(),n=this._pop(),e=this._state,n.start.length)for(a=n.start,i=0,u=a.length;u>i;i++)if(r=a[i])for(c=e.end,o=0,s=c.length;s>o;o++)t=c[o],t.connect(r,!0);else n.end=n.end.concat(e.end);return e.end=n.end,this},t.prototype.end=function(){var t;return t=this.graph,this.graph=new r.Graph,this._state=new i,this._stack=[this._state],this.group(),t&&(t.compile=function(){return t.tail().owner().compile()}),t},t.prototype._push=function(){return this._stack.unshift(new i),this._state=this._stack[0],this},t.prototype._pop=function(){return this._state=this._stack[1],this._stack.shift,this},t}(),e.exports=n},{"./graph":3}],2:[function(t,e){var n;n=function(){function t(t,e){this.parent=null!=e?e:null,this.nodes=[],t&&this.add(t)}return t.IN=0,t.OUT=1,t.prototype.inputs=function(){var t,e,n,r,i,o,u,s,a;for(t=[],s=this.nodes,r=0,o=s.length;o>r;r++)for(e=s[r],a=e.inputs,i=0,u=a.length;u>i;i++)n=a[i],null===n.input&&t.push(n);return t},t.prototype.outputs=function(){var t,e,n,r,i,o,u,s,a;for(n=[],s=this.nodes,r=0,o=s.length;o>r;r++)for(t=s[r],a=t.outputs,i=0,u=a.length;u>i;i++)e=a[i],0===e.output.length&&n.push(e);return n},t.prototype.tail=function(){return this.nodes[this.nodes.length-1]},t.prototype.add=function(t,e){var n,r,i;{if(!t.length){if(t.graph&&!e)throw"Adding node to two graphs at once";return t.setGraph(this),this.nodes.push(t)}for(n=0,r=t.length;r>n;n++)i=t[n],this.add(i)}},t.prototype.remove=function(t,e){var n,r,i;{if(!t.length){if(t.graph!==this)throw"Removing node from wrong graph.";return e||t.disconnect(),this.nodes.splice(this.nodes.indexOf(t),1),t.setGraph(null)}for(n=0,r=t.length;r>n;n++)i=t[n],this.remove(i)}},t}(),e.exports=n},{}],3:[function(t,e,n){n.Graph=t("./graph"),n.Node=t("./node"),n.Outlet=t("./outlet")},{"./graph":2,"./node":4,"./outlet":5}],4:[function(t,e){var n,r,i;n=t("./graph"),i=t("./outlet"),r=function(){function t(t,e){this.owner=t,this.graph=null,this.inputs=[],this.outputs=[],this.outlets=null,this.setOutlets(e)}return t.prototype.getOwner=function(){return this.owner},t.prototype.setGraph=function(t){this.graph=t},t.prototype.getIn=function(t){var e;return function(){var n,r,i,o;for(i=this.inputs,o=[],n=0,r=i.length;r>n;n++)e=i[n],e.name===t&&o.push(e);return o}.call(this)[0]},t.prototype.getOut=function(t){var e;return function(){var n,r,i,o;for(i=this.outputs,o=[],n=0,r=i.length;r>n;n++)e=i[n],e.name===t&&o.push(e);return o}.call(this)[0]},t.prototype.get=function(t){return this.getIn(t)||this.getOut(t)},t.prototype.setOutlets=function(t){var e,n,r,o,u,s,a,c,l,h,f,p,d;if(o=function(t){return new i(t.inout,t.name,t.hint,t.type,t.meta)},null!=t){if(null==this.outlets){for(this.outlets={},a=0,h=t.length;h>a;a++)s=t[a],this._add(o(s));return this.first=!1}for(n=function(t){return[t.name,t.inout,t.type].join("-")},u={},c=0,f=t.length;f>c;c++)s=t[c],u[n(s)]=!0;d=this.outlets;for(r in d)s=d[r],r=n(s),u[r]?u[r]=s:this._remove(s);for(l=0,p=t.length;p>l;l++)s=t[l],e=u[n(s)],e instanceof i?this._morph(e,s):this._add(o(s))}return this.outlets},t.prototype.connect=function(t,e,n){var r,i,o,u,s,a,c,l,h,f,p,d;for(s={},i={},p=t.inputs,c=0,h=p.length;h>c;c++)u=p[c],(n||!u.input)&&(a=u.type,r=[a,u.hint].join("-"),i[r]||(i[r]=u),s[a]=s[a]||[],s[a].push(u));for(d=this.outputs,l=0,f=d.length;f>l;l++)u=d[l],e&&u.output.length||(a=u.type,r=[a,u.hint].join("-"),o=s[a],i[r]?(i[r].connect(u),delete i[r],o.splice(o.indexOf(u),1)):o&&o.length&&o.shift().connect(u));return this},t.prototype.disconnect=function(){var t,e,n,r,i,o,u;for(o=this.inputs,e=0,r=o.length;r>e;e++)t=o[e],t.disconnect();for(u=this.outputs,n=0,i=u.length;i>n;n++)t=u[n],t.disconnect();return this},t.prototype._key=function(t){return[t.name,t.inout].join("-")},t.prototype._add=function(t){var e;if(e=this._key(t),t.node)throw"Adding outlet to two nodes at once.";if(this.outlets[e])throw"Adding two identical outlets to same node. ("+e+")";return t.setNode(this),t.inout===n.IN&&this.inputs.push(t),t.inout===n.OUT&&this.outputs.push(t),this.outlets[e]=t},t.prototype._morph=function(t,e){var n;return n=this._key(e),delete this.outlets[n],t.morph(e),n=this._key(e),this.outlets[n]=e},t.prototype._remove=function(t){var e,r;if(r=this._key(t),e=t.inout,t.node!==this)throw"Removing outlet from wrong node.";return t.disconnect(),t.setNode(null),delete this.outlets[r],t.inout===n.IN&&this.inputs.splice(this.inputs.indexOf(t),1),t.inout===n.OUT&&this.outputs.splice(this.outputs.indexOf(t),1),this},t}(),e.exports=r},{"./graph":2,"./outlet":5}],5:[function(t,e){var n,r;n=t("./graph"),r=function(){function t(e,n,r,i,o){this.inout=e,this.name=n,this.hint=r,this.type=i,this.meta=null!=o?o:{},this.node=null,null==this.hint&&(this.hint=n),this.index=++t.ID,this.key=null,this.input=null,this.output=[]}return t.ID=0,t.prototype.id=function(){return["","sg",this.name,this.index].join("_")},t.prototype.morph=function(t){return this.inout=t.inout,this.name=t.name,this.type=t.type,this.meta=t.meta||{}},t.prototype.connect=function(t){if(this.inout===n.IN&&t.inout===n.OUT)return t.connect(this);if(this.inout!==n.OUT||t.inout!==n.IN)throw"Can only connect out to in.";if(t.input!==this)return t.disconnect(),t.input=this,this.output.push(t)},t.prototype.disconnect=function(t){var e,n,r,i;if(this.input&&this.input.disconnect(this),this.output.length){if(!t){for(i=this.output,n=0,r=i.length;r>n;n++)t=i[n],t.input=null;return this.output=[]}if(e=this.output.indexOf(t),e>=0)return this.output.splice(e,1),t.input=null}},t.prototype.setNode=function(t){this.node=t},t}(),e.exports=r},{"./graph":2}],6:[function(t,e){var n,r,i;n=t("./factory"),r=t("./library"),i=function(){function e(t){null==t&&(t={}),this.library=new r(t)}return e.prototype.shader=function(){return new n(this.library)},e.Graph=t("./graph"),e.Snippet=t("./snippet"),e}(),e.exports=i,window.ShaderGraph=i},{"./factory":1,"./graph":3,"./library":7,"./snippet":10}],7:[function(t,e){var n,r;r=t("./snippet"),n=function(){function t(t){this.snippets=null!=t?t:{},this.objects={}}return t.prototype.fetch=function(t){if(null==this.snippets[t])throw"Unknown snippet `"+t+"`";return null==this.objects[t]&&(this.objects[t]=r.load(t,this.snippets[t])),this.objects[t].clone()},t}(),e.exports=n},{"./snippet":10}],8:[function(t,e){var n,r,i,o,u;u=t("./walk"),o=function(){var t;return t=+new Date,function(e){var n;return n=+new Date-t,console.log(e,n+" ms"),n}},r=function(t){var e,n,r,i,o,u,s,a,c,l,h,f,p,d,g;for(e={},n=function(t){return e[t.name]=!0},n(t.main),f=t.external,i=0,a=f.length;a>i;i++)r=f[i],n(r);for(p=t.internal,o=0,c=p.length;c>o;o++)r=p[o],n(r);for(d=t.varying,u=0,l=d.length;l>u;u++)r=d[u],n(r);for(g=t.uniform,s=0,h=g.length;h>s;s++)r=g[s],n(r);return e},n=function(t){var e,n,o,u;return e=t.ast,n=t.code,u=t.signatures,o=r(u),i(n,o)},i=function(t,e){var n,r;return r=new RegExp("\\b("+function(){var t;t=[];for(n in e)t.push(n);return t}().join("|")+")\\b","g"),t=t.replace(/\/\/[^\n]*/g,""),t=t.replace(/\/\*([^*]|\*[^\/])*\*\//g,""),t=t.replace(/^#[^\n]*/gm,""),function(i,o){var u,s;null==i&&(i=""),null==o&&(o={}),u={};for(n in e)u[n]=i+(null!=(s=o[n])?s:n);return t.replace(r,function(t){return u[t]})}},e.exports=n},{"./walk":13}],9:[function(t,e){var n,r;e.exports=n={},n["in"]=0,n.out=1,n.inout=2,r=function(t){return t.token.data},n.copy=function(t){var e,n,r,i;return i=t,n=i.name,t=i.type,r=i.value,e=i.inout,{name:n,type:t,value:r,inout:e}},n.type=function(t,e,r,i){var o,u,s,a,c,l;return s={"float":"f",vec2:"v2",vec3:"v3",vec4:"v4",mat3:"m3",mat4:"m4",sampler2D:"t",samplerCube:"t"},o={"float":0,vec2:window.THREE?new THREE.Vector3:null,vec3:window.THREE?new THREE.Vector3:null,vec4:window.THREE?new THREE.Vector4:null,mat4:window.THREE?new THREE.Matrix4:null,sampler2D:0,samplerCube:0},u={"in":n["in"],out:n.out,inout:n.inout},a=s[e],r&&(a+="v"),c=o[a],i=null!=(l=u[i])?l:u["in"],{name:t,type:a,value:c,inout:i}},n.node=function(t){var e,r;return"function"===(null!=(e=t.children[5])?e.type:void 0)?n["function"](t):"keyword"===(null!=(r=t.token)?r.type:void 0)?n.external(t):void 0},n.external=function(t){var e,n,i,o,u,s,a,c,l,h,f,p,d;for(e=t.children,c=r(e[1]),l=r(e[3]),h=r(e[4]),o=e[5],"attribute"!==c&&"uniform"!==c&&"varying"!==c&&(c="global"),s=[],d=o.children,n=f=0,p=d.length;p>f;n=++f)e=d[n],"ident"===e.type&&(i=r(e),u=o.children[n+1],a="quantifier"===(null!=u?u.type:void 0),s.push({decl:"external",storage:c,type:h,ident:i,quant:!!a}));return s},n["function"]=function(t){var e,i,o,u,s,a,c,l,h,f;return o=t.children,l=r(o[1]),h=r(o[3]),f=r(o[4]),a=o[5],c=r(a.children[0]),e=a.children[1],i=a.children[2],s=function(){var t,r,i,o;for(i=e.children,o=[],t=0,r=i.length;r>t;t++)u=i[t],o.push(n.argument(u));return o}(),{decl:"function",storage:l,type:f,ident:c,body:!!i,args:s}},n.argument=function(t){var e,n,i,o,u,s,a;return e=t.children,s=r(e[1]),i=r(e[2]),a=r(e[4]),o=e[5],n=r(o.children[0]),u=o.children[1],{decl:"argument",storage:s,inout:i,type:a,ident:n,quant:!!u}}},{}],10:[function(t,e,n){n.Snippet=t("./snippet"),n.parse=t("./parse"),n.compile=t("./compile"),n.load=n.Snippet.load},{"./compile":8,"./parse":11,"./snippet":12}],11:[function(t,e){var n,r,i,o,u,s,a,c,l,h,f,p,d;p=t("../../vendor/glsl-tokenizer"),c=t("../../vendor/glsl-parser"),i=t("./decl"),d=t("./walk"),r=!1,f=function(){var t;return t=+new Date,function(e){var n;return n=+new Date-t,console.log(e,n+" ms"),n}},s=function(t,e){var n,r;return n=a(t,e),r=l(n,e)},a=function(t,e){var n,i,o,u,s,a,l,h;if(r&&(u=f()),l=p().process(c(),e),h=l[0],n=h[0],o=l[1],r&&u("GLSL Tokenize & Parse"),!n||o.length){for(s=0,a=o.length;a>s;s++)i=o[s],console.error("[ShaderGraph] "+t+" -",i.message);throw"GLSL parse error"}return n},l=function(t,e){var i,s,a,c,l,p,g;return r&&(p=f()),l=[],d(u,n(l),t,""),g=h(l),a=g[0],s=g[1],i=g[2],c=o(a,s,i),r&&p("GLSL AST"),{ast:t,code:e,signatures:c}},n=function(t){return function(e){var n,r,i,o;if(null!=e){if(e.length){for(o=[],r=0,i=e.length;i>r;r++)n=e[r],o.push(t.push(n));return o}return t.push(e)}}},u=function(t,e){switch(t.type){case"decl":return e(i.node(t)),!1}return!0},h=function(t){var e,n,r,i,o,u,s,a;for(i=null,r=[],n=[],o={},s=0,a=t.length;a>s;s++)u=t[s],u.body?(o[u.ident]&&(n=function(){var t,r,i;for(i=[],t=0,r=n.length;r>t;t++)e=n[t],e.ident!==u.ident&&i.push(e);return i}(),delete o[u.ident]),r.push(u),i=u):"global"===u.storage?r.push(u):(n.push(u),o[u.ident]=!0);return[i,r,n]},o=function(t,e,n){var r,o,u,s,a,c,l,h,f;for(s={uniform:[],attribute:[],varying:[],external:[],internal:[],global:[],main:null},o=function(t){return i.type(t.ident,t.type,t.quant,t.inout)},u=function(t,e){var n,r,u,s,a,c,l,h,f,p,d;for(h=function(){var e,n,i,u;for(i=t.args,u=[],e=0,n=i.length;n>e;e++)r=i[e],u.push(o(r));return u}(),p=0,d=h.length;d>p;p++)s=h[p],s.inout===i.inout&&(n=s,u=i.copy(s),n.inout=i["in"],u.inout=i.out,u.name+="__inout",h.push(u));return"void"!==t.type&&h.push(i.type("_return__",t.type,!1,"out")),c=function(){var t,e,n;for(n=[],t=0,e=h.length;e>t;t++)s=h[t],s.inout===i["in"]&&n.push(s.type);return n}().join(","),l=function(){var t,e,n;for(n=[],t=0,e=h.length;e>t;t++)s=h[t],s.inout===i.out&&n.push(s.type);return n}().join(","),f="("+c+")("+l+")",a={name:t.ident,type:f,signature:h,inout:e}},s.main=u(t,i.out),c=0,h=e.length;h>c;c++)a=e[c],s.internal.push({name:a.ident});for(l=0,f=n.length;f>l;l++)switch(a=n[l],a.decl){case"external":r=o(a),s[a.storage].push(r);break;case"function":r=u(a,i["in"]),s.external.push(r)}return s},e.exports=s},{"../../vendor/glsl-parser":14,"../../vendor/glsl-tokenizer":18,"./decl":9,"./walk":13}],12:[function(t,e){var n,r,i;i=t("./parse"),r=t("./compile"),n=function(){function t(t,e,n){this.signatures=t,this.assembler=e,this._program=n,this.namespace=null,this.program=null,this.uniforms=null,this.entry=null,this.main=null,this.externals=null}return t.id=0,t.namespace=function(){return"_sg_"+ ++t.id+"_"},t.load=function(e,n){var o,u;return u=i(e,n),o=r(u),new t(u.signatures,o,u)},t.prototype.clone=function(){return new t(this.signatures,this.assembler,this._program)},t.prototype.apply=function(e,n){var r,i,o,u,s,a,c,l,h,f,p,d,g,v,m;for(this.namespace=n,null==this.namespace&&(this.namespace=t.namespace()),this.program=this.assembler(this.namespace),this.uniforms={},this.attributes={},this.externals={},a=function(t){return function(e,n){return t.uniforms[t.namespace+(null!=n?n:e.name)]=e}}(this),r=function(t){return function(e){return t.attributes[e.name]=e}}(this),o=function(t){return function(e){return t.externals[t.namespace+e.name]=e}}(this),u=function(t){return function(e){return t.main=e,t.entry=t.namespace+e.name}}(this),g=this.signatures.attribute,c=0,f=g.length;f>c;c++)i=g[c],r(i);for(v=this.signatures.uniform,l=0,p=v.length;p>l;l++)i=v[l],a(i);for(s in e)i=e[s],a(i,s);for(u(this.signatures.main),m=this.signatures.external,h=0,d=m.length;d>h;h++)i=m[h],o(i);return window.snippet=this},t}(),e.exports=n},{"./compile":8,"./parse":11}],13:[function(t,e){var n,r;n=!1,r=function(t,e,i,o){var u,s,a,c,l,h,f,p,d;if(n&&console.log(o,i.type,null!=(h=i.token)?h.data:void 0,null!=(f=i.token)?f.type:void 0),a=t(i,e)){for(p=i.children,d=[],s=c=0,l=p.length;l>c;s=++c)u=p[s],d.push(r(t,e,u,o+"  ",n));return d}},e.exports=r},{}],14:[function(t,e){e.exports=t("./lib/index")},{"./lib/index":16}],15:[function(t,e){function n(){return this}function r(t,e){var n=m[t];return e=e||0,n?e>n.lbp&&(n.lbp=e):(n=Object.create(v),n.id=t,n.lbp=e,m[t]=n),n}function i(t){var e,n=p;for(l(),e=n.nud();t<p.lbp;)n=p,l(),e=n.led(e);return e}function o(t,e,n){var o=r(t,e);o.led=n||function(t){return this.children=[t,i(e)],this.type="binary",this}}function u(t,e,n){var o=r(t,e);return o.led=n||function(t){return this.children=[t,i(e-1)],this.type="binary",this},o}function s(t,e){var n=r(t);return n.nud=e||function(){return this.children=[i(70)],this.type="unary",this},n}function a(t){var e=r(t,150);e.led=function(t){return this.children=[t],this.type="suffix",this}}function c(t){return u(t,10,function(t){return this.children=[t,i(9)],this.assignment=!0,this.type="assign",this})}function l(t){var e,r,i,o;if(t&&p.data!==t)return f.unexpected("expected `"+t+"`, got `"+p.data+"`");if(g>=d.length)return void(p=m["(end)"]);if(e=d[g++],r=e.data,i=e.type,"ident"===i)o=f.scope.find(r)||f.create_node(),i=o.type;else if("builtin"===i)o=m["(builtin)"];else if("keyword"===i)o=m["(keyword)"];else if("operator"===i){if(o=m[r],!o)return f.unexpected("unknown operator `"+r+"`")}else{if("float"!==i&&"integer"!==i)return f.unexpected("unexpected token.");i="literal",o=m["(literal)"]}return o&&(o.nud||(o.nud=n),o.children||(o.children=[])),o=Object.create(o),o.token=e,o.type=i,o.data||(o.data=r),p=o}function h(t){return function(){return f.unexpected(t)}}var f,p,d,g,v={nud:function(){return this.children&&this.children.length?this:h("unexpected")()},led:h("missing operator")},m={};r("(ident)").nud=n,r("(keyword)").nud=n,r("(builtin)").nud=n,r("(literal)").nud=n,r("(end)"),r(":"),r(";"),r(","),r(")"),r("]"),r("}"),u("&&",30),u("||",30),o("|",43),o("^",44),o("&",45),o("==",46),o("!=",46),o("<",47),o("<=",47),o(">",47),o(">=",47),o(">>",48),o("<<",48),o("+",50),o("-",50),o("*",60),o("/",60),o("%",60),o("?",20,function(t){return this.children=[t,i(0),(l(":"),i(0))],this.type="ternary",this}),o(".",80,function(t){return p.type="literal",f.fake(p),this.children=[t,p],l(),this}),o("[",80,function(t){return this.children=[t,i(0)],this.type="binary",l("]"),this}),o("(",80,function(t){if(this.children=[t],this.type="call",")"!==p.data)for(;;){if(this.children.push(i(0)),","!==p.data)break;l(",")}return l(")"),this}),s("-"),s("+"),s("!"),s("~"),s("defined"),s("(",function(){return this.type="group",this.children=[i(0)],l(")"),this}),s("++"),s("--"),a("++"),a("--"),c("="),c("+="),c("-="),c("*="),c("/="),c("%="),c("&="),c("|="),c("^="),c(">>="),c("<<="),e.exports=function(t,e){function n(t){f.unshift(t,!1);for(var e=0,r=t.children.length;r>e;++e)n(t.children[e]);f.shift()}f=t,d=e,g=0;var r;if(d.length){if(l(),r=i(0),r.parent=f[0],n(r),g<d.length)throw new Error("did not use all tokens");r.parent.children=[r]}}},{}],16:[function(t,e){function n(){function t(t){if("whitespace"===t.type||"line-comment"===t.type||"block-comment"===t.type)return void Xe.push(t);for(We.push(t),De=De||We[0],De&&Xe.length&&(De.preceding=De.preceding||[],De.preceding=De.preceding.concat(Xe),Xe=[]);n();)switch(Ke[0].mode){case d:X();break;case g:N();break;case _:Y();break;case x:Z();break;case M:ne();break;case v:xe(!0,!0);break;case T:we();break;case p:ee();break;case P:te();break;case O:$();break;case m:Pe();break;case y:Oe();break;case w:be();break;case k:je();break;case I:Ce();break;case E:Te();break;case b:Me();break;case q:ke()}}function e(e){return arguments.length&&t(e),Ke.length>1?void ce("unexpected EOF"):void Qe.emit("end")}function n(){return Ye||!Ke.length?!1:(De=We[0])&&!Qe.paused}function f(t){Ke.unshift(t),Ke.shift()}function j(t,e){t.parent=Ke[0];var n=[].unshift.call(this,t);if(e=void 0===e?!0:e,h){for(var r="",i=0,o=this.length-1;o>i;++i)r+=" |";console.log(r,"\\"+t.type,t.token.data)}return e&&Se!==t&&Se.children.push(t),Se=t,n}function C(){var t=[].shift.call(this),e=Je[this.length],n=!1;if(h){for(var r="",i=0,o=this.length;o>i;++i)r+=" |";console.log(r,"/"+t.type)}return Je.length?"function"==typeof Je[0]?n=Je[0](t):void 0!==e&&(n=e.test?e.test(t.type):e===t.type):n=!0,n&&Qe.emit("data",t),Se=t.parent,t}function N(){function t(){if(De.data===Ke[0].expecting)return Ke.scope.exit(),Ke.shift();switch(De.type){case"preprocessor":return Ke.fake(ie()),void We.shift();default:return void Ke.unshift(Ie())}}return fe(function(){return Ke.scope.enter(),l},t)()}function X(){if(Ke[0].brace)return"}"!==De.data?ce("expected `}`, got "+De.data):(Ke[0].brace=!1,We.shift(),Ke.shift());switch(De.type){case"eof":return Ke.shift();case"keyword":switch(De.data){case"for":return Ke.unshift(Ue());case"if":return Ke.unshift(Ge());case"while":return Ke.unshift(He());case"do":return Ke.unshift(Ae());case"break":return Ke.fake(r(D,De)),We.shift();case"continue":return Ke.fake(r(S,De)),We.shift();case"discard":return Ke.fake(r(F,De)),We.shift();case"return":return Ke.unshift(ze());case"precision":return Ke.unshift(qe())}return Ke.unshift(oe(A));case"ident":var t;if(t=Ke.scope.find(De.data))return Ke.unshift("struct"===t.parent.type?oe(A):se(";"));case"operator":if("{"===De.data){Ke[0].brace=!0;var e=Fe();return e.expecting="}",We.shift(),Ke.unshift(e)}if(";"===De.data)return We.shift(),Ke.shift();default:return Ke.unshift(se(";"))}}function Y(){function t(){return"invariant"===De.data?d.flags&U?(Ke.unshift(ae()),l):ce("`invariant` is not allowed here"):(Ke.fake(r(L,{data:"",position:De.position})),l)}function e(){return i(De)?d.flags&G?(Ke.unshift(ae()),l):ce("storage is not allowed here"):(Ke.fake(r(L,{data:"",position:De.position})),l)}function n(){return o(De)?d.flags&H?ce("parameter is not allowed here"):(Ke.unshift(ae()),l):(Ke.fake(r(L,{data:"",position:De.position})),l)}function s(){return u(De)?(Ke.unshift(ae()),l):(Ke.fake(r(L,{data:"",position:De.position})),l)}function a(){if("struct"===De.data)return d.flags&z?(Ke.unshift(ue()),l):ce("cannot nest structs");if("keyword"===De.type)return Ke.unshift(ae()),l;var t=Ke.scope.find(De.data);return t?(Ke.fake(Object.create(t)),We.shift(),l):ce("expected user defined type, struct or keyword, got "+De.data)}function c(){return","!==De.data||d.flags&V?"["===De.data?void Ke.unshift(Be()):")"===De.data?Ke.shift():";"===De.data?d.stage+3:"ident"!==De.type?ce("expected identifier, got "+De.data):(d.collected_name=We.shift(),l):Ke.shift()}function h(){return"("===De.data?(We.unshift(d.collected_name),delete d.collected_name,Ke.unshift(Ve()),d.stage+2):l}function f(){return We.unshift(d.collected_name),delete d.collected_name,Ke.unshift(Le()),l}function p(){return Ke.shift()}var d=Ke[0];return fe(t,e,n,s,a,c,h,f,p)()}function Z(){if("ident"===De.type){var t=De.data;return Ke.unshift(Re()),void Ke.scope.define(t)}if("operator"===De.type){if(","===De.data)return Ke[1].flags&V?We.shift():Ke.shift();if("="===De.data)return Ke[1].flags&R?(We.shift(),void Ke.unshift(se(",",";"))):ce("`=` is not allowed here.");if("["===De.data)return void Ke.unshift(Be())}return Ke.shift()}function $(){return"keyword"===De.type?(Ke[0].type="keyword",void(Ke[0].mode=P)):"ident"===De.type?(Ke[0].type="ident",void(Ke[0].mode=p)):ce("expected keyword or user-defined name, got "+De.data)}function te(){return"keyword"!==De.type?ce("expected keyword, got "+De.data):(Ke.shift(),We.shift())}function ee(){return"ident"!==De.type?ce("expected user-defined name, got "+De.data):(Ke[0].data=De.data,Ke.shift(),We.shift())}function ne(){function t(t){return a(Ke,t),Ke.shift()}var e=Ke[0].expecting;if(Ke[0].tokens=Ke[0].tokens||[],void 0===Ke[0].parenlevel&&(Ke[0].parenlevel=0,Ke[0].bracelevel=0),Ke[0].parenlevel<1&&e.indexOf(De.data)>-1)return t(Ke[0].tokens);switch("("===De.data?++Ke[0].parenlevel:")"===De.data&&--Ke[0].parenlevel,De.data){case"{":++Ke[0].bracelevel;break;case"}":--Ke[0].bracelevel;break;case"(":++Ke[0].parenlevel;break;case")":--Ke[0].parenlevel}return Ke[0].parenlevel<0?ce("unexpected `)`"):Ke[0].bracelevel<0?ce("unexpected `}`"):void Ke[0].tokens.push(We.shift())}function re(t){return function(){return r(t,De)}}function ie(){return r(W[De.type],De,Se)}function oe(t){var e=r(_,De,Se);return e.flags=t,e}function ue(t,e){var n=r(v,De,Se);return n.allow_assign=void 0===t?!0:t,n.allow_comma=void 0===e?!0:e,n}function se(){var t=r(M,De,Se);return t.expecting=[].slice.call(arguments),t}function ae(t){var e=De;return t&&(e={type:"(implied)",data:"(default)",position:e.position}),r(P,e,Se)}function ce(t){Ye=!0,Qe.emit("error",new Error((t||"unexpected "+Ke)+" at line "+Ke[0].token.line))}function le(t,e){return he(t,De.type)&&he(e,De.data)}function he(t,e){switch(typeof t){case"string":return e!==t&&ce("expected `"+t+"`, got "+e+"\n"+De.data),!Ye;case"object":return t&&-1===t.indexOf(e)&&ce("expected one of `"+t.join("`, `")+"`, got "+e),!Ye}return!0}function fe(){var t,e,n=[].slice.call(arguments);return function(){var r=Ke[0];return r.stage||(r.stage=0),(t=n[r.stage])?(e=t(),e===l?++r.stage:void(void 0!==e&&(r.stage=e))):ce("parser in undefined state!")}}function pe(t,e){return e=e||"operator",function(){if(le(e,t)){var n=We.shift(),r=Ke[0].children,i=r[r.length-1];return i&&i.token&&n.preceding&&(i.token.succeeding=i.token.succeeding||[],i.token.succeeding=i.token.succeeding.concat(n.preceding)),l}}}function de(t){return function(){return Ke.unshift(se(t)),l}}function ge(t){return t?function(){var t=De.data;return le("ident")&&(Ke.unshift(Re()),Ke.scope.define(t),l)}:function(){if(le("ident")){var t=Object.create(Ke.scope.find(De.data));return t.token=De,We.shift(),l}}}function ve(){return function(){var t=Fe();return t.expecting="}",Ke.unshift(t),l}}function me(t){return function(){var e=Ke[0].stage;return"{"!==De.data?(Ke.unshift(Ie()),e+t):(We.shift(),l)}}function ye(){return function(){return Ke.shift(),Ke.shift()}}function _e(){xe=fe(pe("struct","keyword"),function(){return"{"===De.data?(Ke.fake(r(p,{data:"",position:De.position,type:"ident"})),l):ge(!0)()},function(){return Ke.scope.enter(),l},pe("{"),function(){return"}"===De.data?(Ke.scope.exit(),We.shift(),Ke.shift()):";"===De.data?void We.shift():void Ke.unshift(oe(Q))}),we=fe(function(){return We.shift(),l},function(){return le("keyword",["lowp","mediump","highp"])&&(Ke.unshift(ae()),l)},function(){return Ke.unshift(ae()),l},function(){return Ke.shift()}),ke=fe(pe("["),de("]"),pe("]"),function(){return Ke.shift()}),be=fe(pe("for","keyword"),pe("("),function(){var t;if("ident"===De.type){if((t=Ke.scope.find(De.data))||(t=Ke.create_node()),"struct"===t.parent.type)return Ke.unshift(oe(A)),l}else if("builtin"===De.type||"keyword"===De.type)return Ke.unshift(oe(A)),l;return de(";")()},pe(";"),de(";"),pe(";"),de(")"),pe(")"),me(3),ve(),pe("}"),ye()),Me=fe(pe("if","keyword"),pe("("),de(")"),pe(")"),me(3),ve(),pe("}"),function(){return"else"===De.data?(We.shift(),Ke.unshift(Ie()),l):ye()()},ye()),Te=fe(pe("return","keyword"),function(){return";"===De.data?l:(Ke.unshift(se(";")),l)},function(){We.shift(),ye()()}),je=fe(pe("while","keyword"),pe("("),de(")"),pe(")"),me(3),ve(),pe("}"),ye()),Ce=fe(pe("do","keyword"),me(3),ve(),pe("}"),pe("while","keyword"),pe("("),de(")"),pe(")"),ye()),Pe=fe(function(){for(var t=1,e=Ke.length;e>t;++t)if(Ke[t].mode===m)return ce("function definition is not allowed within another function");return l},function(){if(le("ident")){var t=De.data,e=Ke.scope.find(t);return Ke.unshift(Re()),Ke.scope.define(t),Ke.scope.enter(e?e.scope:null),l}},pe("("),function(){return Ke.unshift(Ne()),l},pe(")"),function(){return";"===De.data?(Ke.scope.exit(),Ke.shift(),Ke.shift()):l},pe("{"),ve(),pe("}"),function(){return Ke.scope.exit(),l},function(){return Ke.shift(),Ke.shift(),Ke.shift()}),Oe=fe(function(){return"void"===De.data?(Ke.fake(ae()),We.shift(),l):")"===De.data?void Ke.shift():"struct"===De.data?(Ke.unshift(ue(J,K)),l):(Ke.unshift(oe(B)),l)},function(){return","===De.data?(We.shift(),0):")"===De.data?void Ke.shift():void ce("expected one of `,` or `)`, got "+De.data)})}var xe,we,ke,be,Me,Te,je,Ce,Pe,Oe,Ee,De,Se,Fe=re(g),Ie=re(d),Le=re(x),qe=re(T),Re=re(p),Ve=(re(O),re(m)),Ne=re(y),Ue=re(w),Ge=re(b),He=re(k),ze=re(E),Ae=re(I),Be=re(q),Qe=s(t,e),Je=arguments.length?[].slice.call(arguments):[],Ke=[],We=[],Xe=[],Ye=!1;return Ke.shift=C,Ke.unshift=j,Ke.fake=f,Ke.unexpected=ce,Ke.scope=new c(Ke),Ke.create_node=function(){var t=r(p,De);return t.parent=Qe.program,t},_e(),Se=Fe(),Se.expecting="(eof)",Se.mode=g,Se.token={type:"(program)",data:"(program)"},Ee=Se,Qe.program=Ee,Qe.scope=function(t){return 1===arguments.length&&(Ke.scope=t),Ke.scope},Ke.unshift(Se),Qe}function r(t,e){return{mode:t,token:e,children:[],type:X[t]}}function i(t){return"const"===t.data||"attribute"===t.data||"uniform"===t.data||"varying"===t.data}function o(t){return"in"===t.data||"inout"===t.data||"out"===t.data}function u(t){return"highp"===t.data||"mediump"===t.data||"lowp"===t.data}e.exports=n;var s=t("../../through"),a=t("./expr"),c=t("./scope"),l=new Object,h=!1,f=0,p=f++,d=f++,g=f++,v=f++,m=f++,y=f++,_=f++,x=f++,w=f++,k=f++,b=f++,M=f++,T=f++,j=f++,C=f++,P=f++,O=f++,E=f++,D=f++,S=f++,F=f++,I=f++,L=f++,q=f++,R=1,V=2,N=4,U=8,G=16,H=32,z=64,A=255,B=A&~(R|V|H|U|N),Q=A&~(R|U|G|z),J=!1,K=!1,W={"block-comment":j,"line-comment":j,preprocessor:C},X=f=["ident","stmt","stmtlist","struct","function","functionargs","decl","decllist","forloop","whileloop","if","expr","precision","comment","preprocessor","keyword","keyword_or_ident","return","break","continue","discard","do-while","placeholder","quantifier"]},{"../../through":22,"./expr":15,"./scope":17}],17:[function(t,e){function n(t){return this.constructor!==n?new n(t):(this.state=t,this.scopes=[],void(this.current=null))}e.exports=n;var r=n,i=r.prototype;i.enter=function(t){this.scopes.push(this.current=this.state[0].scope=t||{})},i.exit=function(){this.scopes.pop(),this.current=this.scopes[this.scopes.length-1]},i.define=function(t){this.current[t]=this.state[0]},i.find=function(t){for(var e=this.scopes.length-1;e>-1;--e)if(this.scopes[e].hasOwnProperty(t))return this.scopes[e][t];return null}},{}],18:[function(t,e){function n(){function t(t){t.length&&q.queue({type:w[N],data:t,position:H,line:G})}function e(t){for(R=0,B+=t.toString(),L=B.length;F=B[R],L>R;)switch(N){case c:R=j();break;case l:R=T();break;case h:R=M();break;case f:R=C();break;case p:R=E();break;case x:R=O();break;case d:R=D();break;case a:R=S();break;case y:R=b();break;case s:R=k()}V+=R,B=B.slice(R)}function n(){U.length&&t(U.join("")),N=_,t("(eof)"),q.queue(null)}function k(){return U=U.length?[]:U,"/"===I&&"*"===F?(H=V+R-1,N=c,I=F,R+1):"/"===I&&"/"===F?(H=V+R-1,N=l,I=F,R+1):"#"===F?(N=h,H=V+R,R):/\s/.test(F)?(N=y,H=V+R,R):(z=/\d/.test(F),A=/[^\w_]/.test(F),H=V+R,N=z?p:A?f:a,R)}function b(){return"\n"===F&&++G,/[^\s]/g.test(F)?(t(U.join("")),N=s,R):(U.push(F),I=F,R+1)}function M(){return"\n"===F&&++G,"\n"===F&&"\\"!==I?(t(U.join("")),N=s,R):(U.push(F),I=F,R+1)}function T(){return M()}function j(){return"/"===F&&"*"===I?(U.push(F),t(U.join("")),N=s,R+1):("\n"===F&&++G,U.push(F),I=F,R+1)}function C(){if("."===I&&/\d/.test(F))return N=d,R;if("/"===I&&"*"===F)return N=c,R;if("/"===I&&"/"===F)return N=l,R;if("."===F&&U.length){for(;P(U););return N=d,R}if(";"===F){if(U.length)for(;P(U););return t(F),N=s,R+1}var e=2===U.length&&"="!==F;if(/[\w_\d\s]/.test(F)||e){for(;P(U););return N=s,R}return U.push(F),I=F,R+1}function P(e){for(var n,r=0,i=e.length;;){n=o.indexOf(e.slice(0,e.length+r).join(""));{if(-1!==n)return t(o[n]),H+=o[n].length,U=U.slice(o[n].length),U.length;if(r-=1,i-=1,0>i)return 0}}}function O(){return/[^a-fA-F0-9]/.test(F)?(t(U.join("")),N=s,R):(U.push(F),I=F,R+1)}function E(){return"."===F?(U.push(F),N=d,I=F,R+1):/[eE]/.test(F)?(U.push(F),N=d,I=F,R+1):"x"===F&&1===U.length&&"0"===U[0]?(N=x,U.push(F),I=F,R+1):/[^\d]/.test(F)?(t(U.join("")),N=s,R):(U.push(F),I=F,R+1)}function D(){return"f"===F&&(U.push(F),I=F,R+=1),/[eE]/.test(F)?(U.push(F),I=F,R+1):/[^\d]/.test(F)?(t(U.join("")),N=s,R):(U.push(F),I=F,R+1)}function S(){if(/[^\d\w_]/.test(F)){var e=U.join("");return N=i.indexOf(e)>-1?m:u.indexOf(e)>-1?v:g,t(U.join("")),N=s,R}return U.push(F),I=F,R+1}var F,I,L,q=r(e,n),R=0,V=0,N=s,U=[],G=1,H=0,z=!1,A=!1,B="";return q}e.exports=n;var r=t("../through"),i=t("./lib/literals"),o=t("./lib/operators"),u=t("./lib/builtins"),s=999,a=9999,c=0,l=1,h=2,f=3,p=4,d=5,g=6,v=7,m=8,y=9,_=10,x=11,w=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"]},{"../through":22,"./lib/builtins":19,"./lib/literals":20,"./lib/operators":21}],19:[function(t,e){e.exports=["gl_Position","gl_PointSize","gl_ClipVertex","gl_FragCoord","gl_FrontFacing","gl_FragColor","gl_FragData","gl_FragDepth","gl_Color","gl_SecondaryColor","gl_Normal","gl_Vertex","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_FogCoord","gl_MaxLights","gl_MaxClipPlanes","gl_MaxTextureUnits","gl_MaxTextureCoords","gl_MaxVertexAttribs","gl_MaxVertexUniformComponents","gl_MaxVaryingFloats","gl_MaxVertexTextureImageUnits","gl_MaxCombinedTextureImageUnits","gl_MaxTextureImageUnits","gl_MaxFragmentUniformComponents","gl_MaxDrawBuffers","gl_ModelViewMatrix","gl_ProjectionMatrix","gl_ModelViewProjectionMatrix","gl_TextureMatrix","gl_NormalMatrix","gl_ModelViewMatrixInverse","gl_ProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverse","gl_TextureMatrixInverse","gl_ModelViewMatrixTranspose","gl_ProjectionMatrixTranspose","gl_ModelViewProjectionMatrixTranspose","gl_TextureMatrixTranspose","gl_ModelViewMatrixInverseTranspose","gl_ProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixInverseTranspose","gl_TextureMatrixInverseTranspose","gl_NormalScale","gl_DepthRangeParameters","gl_DepthRange","gl_ClipPlane","gl_PointParameters","gl_Point","gl_MaterialParameters","gl_FrontMaterial","gl_BackMaterial","gl_LightSourceParameters","gl_LightSource","gl_LightModelParameters","gl_LightModel","gl_LightModelProducts","gl_FrontLightModelProduct","gl_BackLightModelProduct","gl_LightProducts","gl_FrontLightProduct","gl_BackLightProduct","gl_FogParameters","gl_Fog","gl_TextureEnvColor","gl_EyePlaneS","gl_EyePlaneT","gl_EyePlaneR","gl_EyePlaneQ","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_ObjectPlaneR","gl_ObjectPlaneQ","gl_FrontColor","gl_BackColor","gl_FrontSecondaryColor","gl_BackSecondaryColor","gl_TexCoord","gl_FogFragCoord","gl_Color","gl_SecondaryColor","gl_TexCoord","gl_FogFragCoord","gl_PointCoord","radians","degrees","sin","cos","tan","asin","acos","atan","pow","exp","log","exp2","log2","sqrt","inversesqrt","abs","sign","floor","ceil","fract","mod","min","max","clamp","mix","step","smoothstep","length","distance","dot","cross","normalize","faceforward","reflect","refract","matrixCompMult","lessThan","lessThanEqual","greaterThan","greaterThanEqual","equal","notEqual","any","all","not","texture2D","texture2DProj","texture2DLod","texture2DProjLod","textureCube","textureCubeLod"]
},{}],20:[function(t,e){e.exports=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"]},{}],21:[function(t,e){e.exports=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"]},{}],22:[function(t,e){var n;n=function(t,e){var n,r;return r=[],n=[],{output:r,parser:null,write:t,end:e,process:function(e,n){return this.parser=e,t(n),this.flush(),this.parser.flush()},flush:function(){return e(),[r,n]},queue:function(t){var e;return null!=t?null!=(e=this.parser)?e.write(t):void 0:void 0},emit:function(t,e){return"data"===t&&null==e.parent&&r.push(e),"error"===t?n.push(e):void 0}}},e.exports=n},{}]},{},[6]);