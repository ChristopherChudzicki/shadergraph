!function t(e,n,r){function i(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return i(n?n:t)},c,c.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e){var n,r,i;r=t("./graph"),i=function(){function t(t,e){this.start=null!=t?t:[],this.end=null!=e?e:[]}return t}(),n=function(){function t(t){this.library=t,this.end()}return t.prototype._push=function(){return this._stack.unshift(new i),this._state=this._stack[0]},t.prototype._pop=function(){return this._state=this._stack[1],this._stack.shift},t.prototype.snippet=function(t,e){var n,r;return r=this.library.fetch(t),n=Snippet.Apply(r,e),this},t.prototype.append=function(t){var e,n,r,i;for(this.graph.add(t),i=this._state.end,n=0,r=i.length;r>n;n++)e=i[n],e.connect(t);return this._state.start.length||(this._state.start=[t]),this._state.end=[t]},t.prototype.prepend=function(t){var e,n,r,i;for(this.graph.add(t),i=this._state.start,n=0,r=i.length;r>n;n++)e=i[n],t.connect(e);return this._state.end.length||(this._state.end=[t]),this._state.start=[t],this},t.prototype.group=function(){return this._push(),this._push(),this},t.prototype.pass=function(){return this.next(),this._state.start.push(null),this.combine()},t.prototype.next=function(){var t;return t=this._pop(),this._state.start=this._state.start.concat(t.start),this._state.end=this._state.end.concat(t.end),this._push()},t.prototype.combine=function(){var t,e,n,r,i,o,s,a,u,c;if(this._stack.length<=2)throw"Popping factory stack too far";if(this.next(),this._pop(),n=this._pop(),e=this._state,n.start.length)for(u=n.start,i=0,s=u.length;s>i;i++)if(r=u[i])for(c=e.end,o=0,a=c.length;a>o;o++)t=c[o],t.connect(r,!0);else n.end=n.end.concat(e.end);return e.end=n.end,this},t.prototype.end=function(){var t;return t=this.graph,this.graph=new r.Graph,this._state=new i,this._stack=[this._state],this.group(),t&&(t.compile=function(){return t.tail().owner().compile()}),t},t}(),e.exports=n},{"./graph":3}],2:[function(t,e){var n;n=function(){function t(t,e){this.parent=null!=e?e:null,this.nodes=[],t&&this.add(t)}return t.IN=0,t.OUT=1,t.prototype.inputs=function(){var t,e,n,r,i,o,s,a,u;for(t=[],a=this.nodes,r=0,o=a.length;o>r;r++)for(e=a[r],u=e.inputs,i=0,s=u.length;s>i;i++)n=u[i],null===n.input&&t.push(n);return t},t.prototype.outputs=function(){var t,e,n,r,i,o,s,a,u;for(n=[],a=this.nodes,r=0,o=a.length;o>r;r++)for(t=a[r],u=t.outputs,i=0,s=u.length;s>i;i++)e=u[i],0===e.output.length&&n.push(e);return n},t.prototype.tail=function(){return this.nodes[this.nodes.length-1]},t.prototype.add=function(t,e){var n,r,i;{if(!t.length){if(t.graph&&!e)throw"Adding node to two graphs at once";return t.setGraph(this),this.nodes.push(t)}for(n=0,r=t.length;r>n;n++)i=t[n],this.add(i)}},t.prototype.remove=function(t,e){var n,r,i;{if(!t.length){if(t.graph!==this)throw"Removing node from wrong graph.";return e||t.disconnect(),this.nodes.splice(this.nodes.indexOf(t),1),t.setGraph(null)}for(n=0,r=t.length;r>n;n++)i=t[n],this.remove(i)}},t}(),e.exports=n},{}],3:[function(t,e,n){n.Graph=t("./graph"),n.Node=t("./node"),n.Outlet=t("./outlet")},{"./graph":2,"./node":4,"./outlet":5}],4:[function(t,e){var n,r,i;n=t("./graph"),i=t("./outlet"),r=function(){function t(t,e){this.owner=t,this.graph=null,this.inputs=[],this.outputs=[],this.outlets=null,this.setOutlets(e)}return t.prototype.getOwner=function(){return this.owner},t.prototype.setGraph=function(t){this.graph=t},t.prototype.getIn=function(t){var e;return function(){var n,r,i,o;for(i=this.inputs,o=[],n=0,r=i.length;r>n;n++)e=i[n],e.name===t&&o.push(e);return o}.call(this)[0]},t.prototype.getOut=function(t){var e;return function(){var n,r,i,o;for(i=this.outputs,o=[],n=0,r=i.length;r>n;n++)e=i[n],e.name===t&&o.push(e);return o}.call(this)[0]},t.prototype.get=function(t){return this.getIn(t)||this.getOut(t)},t.prototype.setOutlets=function(t){var e,n,r,o,s,a,u,c,l,f,h,p,d;if(o=function(t){return new i(t.inout,t.name,t.hint,t.type,t.meta)},null!=t){if(null==this.outlets){for(this.outlets={},u=0,f=t.length;f>u;u++)a=t[u],this._add(o(a));return this.first=!1}for(n=function(t){return[t.name,t.inout,t.type].join("-")},s={},c=0,h=t.length;h>c;c++)a=t[c],s[n(a)]=!0;d=this.outlets;for(r in d)a=d[r],r=n(a),s[r]?s[r]=a:this._remove(a);for(l=0,p=t.length;p>l;l++)a=t[l],e=s[n(a)],e instanceof i?this._morph(e,a):this._add(o(a))}return this.outlets},t.prototype.connect=function(t,e,n){var r,i,o,s,a,u,c,l,f,h,p,d;for(a={},i={},p=t.inputs,c=0,f=p.length;f>c;c++)s=p[c],(n||!s.input)&&(u=s.type,r=[u,s.hint].join("-"),i[r]||(i[r]=s),a[u]=a[u]||[],a[u].push(s));for(d=this.outputs,l=0,h=d.length;h>l;l++)s=d[l],e&&s.output.length||(u=s.type,r=[u,s.hint].join("-"),o=a[u],i[r]?(i[r].connect(s),delete i[r],o.splice(o.indexOf(s),1)):o&&o.length&&o.shift().connect(s));return this},t.prototype.disconnect=function(){var t,e,n,r,i,o,s;for(o=this.inputs,e=0,r=o.length;r>e;e++)t=o[e],t.disconnect();for(s=this.outputs,n=0,i=s.length;i>n;n++)t=s[n],t.disconnect();return this},t.prototype._key=function(t){return[t.name,t.inout].join("-")},t.prototype._add=function(t){var e;if(e=this._key(t),t.node)throw"Adding outlet to two nodes at once.";if(this.outlets[e])throw"Adding two identical outlets to same node. ("+e+")";return t.setNode(this),t.inout===n.IN&&this.inputs.push(t),t.inout===n.OUT&&this.outputs.push(t),this.outlets[e]=t},t.prototype._morph=function(t,e){var n;return n=this._key(e),delete this.outlets[n],t.morph(e),n=this._key(e),this.outlets[n]=e},t.prototype._remove=function(t){var e,r;if(r=this._key(t),e=t.inout,t.node!==this)throw"Removing outlet from wrong node.";return t.disconnect(),t.setNode(null),delete this.outlets[r],t.inout===n.IN&&this.inputs.splice(this.inputs.indexOf(t),1),t.inout===n.OUT&&this.outputs.splice(this.outputs.indexOf(t),1),this},t}(),e.exports=r},{"./graph":2,"./outlet":5}],5:[function(t,e){var n,r;n=t("./graph"),r=function(){function t(e,n,r,i,o){this.inout=e,this.name=n,this.hint=r,this.type=i,this.meta=null!=o?o:{},this.node=null,null==this.hint&&(this.hint=n),this.index=++t.ID,this.key=null,this.input=null,this.output=[]}return t.ID=0,t.prototype.id=function(){return["","sg",this.name,this.index].join("_")},t.prototype.morph=function(t){return this.inout=t.inout,this.name=t.name,this.type=t.type,this.meta=t.meta||{}},t.prototype.connect=function(t){if(this.inout===n.IN&&t.inout===n.OUT)return t.connect(this);if(this.inout!==n.OUT||t.inout!==n.IN)throw"Can only connect out to in.";if(t.input!==this)return t.disconnect(),t.input=this,this.output.push(t)},t.prototype.disconnect=function(t){var e,n,r,i;if(this.input&&this.input.disconnect(this),this.output.length){if(!t){for(i=this.output,n=0,r=i.length;r>n;n++)t=i[n],t.input=null;return this.output=[]}if(e=this.output.indexOf(t),e>=0)return this.output.splice(e,1),t.input=null}},t.prototype.setNode=function(t){this.node=t},t}(),e.exports=r},{"./graph":2}],6:[function(t,e){var n,r,i,o,s,a,u,c;n=t("./factory"),r=t("./library"),i=function(){function e(t){null==t&&(t={}),this.library=new r(t)}return e.prototype.shader=function(){return new n(this.library)},e.prototype.Graph=t("./graph"),e}(),e.exports=i,window.ShaderGraph=i,o="// Comment\nuniform float uf;\nuniform float ufv1[3];\nuniform vec2 uv2;\n// Comment\nuniform vec2 uv2v[3];\nuniform vec3 uv3;\nuniform vec3 uv3v[3];\nuniform vec4 uv4;\nuniform vec4 uv4v[3];\nuniform sampler2D ut;\nuniform sampler2D utv[3];\nvarying float vf;\nvarying float vfv1[3];\nvarying mat3 vm3;\nvarying mat3 vm3v[3];\nvarying mat4 vm4;\nvarying mat4 vm4v[3];\nattribute float af;\nattribute float afv1[3];\nattribute vec3 av3;\nattribute vec3 av3v[3];\nattribute mat4 am4;\nattribute mat4 am4v[3];\n\nvoid callback1(in vec4 v4in);\n\nvoid callback2(in vec3 v3in, out vec4 v4out);\n\nvoid callback3(in vec3 v3in, in vec4 v4in, out vec4 v4out);\n\nvoid snippetTest(\n  in vec3 v3in, in vec4 v4in, mat3 m3vin[3],\n  out vec4 v4out, out vec4 v4vout[3], out mat4 m4out, out mat4 m4vout[3],\n  inout vec3 v3inout) {\n    callback1(v4in);\n    callback2(v3in, v4out);\n    callback3(v3in, v4in, v4out);\n    gl_FragColor = vec4(v4in.xyz, 1.0);\n}",s="uniform vec3 color;\n\n#pragma external\nconst void callback(const in vec4 rgba);\n\n#pragma export\nvoid main() { gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0); };",s="uniform vec2 sampleStep;\n\nuniform float fadeOut;\nuniform float field;\nuniform float time;\n\nuniform sampler2D texture;\nvarying vec2 vUV;\n\nfloat randf(vec2 xy) {\n  return fract(sin(dot(xy, vec2(3.1380, 7.41)) * 13.414) * 1414.32);\n}\n\nconst float c = .9999875;\nconst float s = .005;\nconst mat2 roto1 = mat2(c, s, -s, c);\nconst mat2 roto2 = mat2(c, -s, s, c);\n\nconst float c2 = .9998;\nconst float s2 = .02;\nconst mat2 roto3 = mat2(c2, -s2, s2, c2);\n\nvec2 rotozoom(vec2 xy) {\n  float r = sqrt(dot(xy, xy));\n  xy *= (7.0 * r + sin(r)) * .125 / r;\n  xy *= roto1;\n\n  return xy;\n}\n\nvec2 planeproject(vec2 xy) {\n  float f = .0625 * (15.0 + 1.0 / (-xy.y + 1.5));\n  xy *= f;\n  xy *= roto2;\n\n  return xy;\n}\n\nvec2 ball(vec2 xy) {\n  float r = sqrt(dot(xy, xy));\n  xy *= (3.0 + 1.75 * tan(r * .5) / r) * .25;\n  xy *= roto3;\n\n  return xy;\n}\n\nvec2 swirl(vec2 xy) {\n  vec2 a = xy * 2.25 * 6.28;\n  xy += vec2(sin(a.y), sin(a.x)) * .01;\n\n  vec2 b = xy * 4.5 * 6.28;\n  xy += vec2(-sin(b.y), sin(b.x)) * .01;\n\n  vec2 c = xy * 9.0 * 6.28;\n  xy += vec2(-sin(c.y), -sin(c.x)) * .01;\n  return xy;\n}\n\nvec2 warp(vec2 xy, float q) {\n\n  float r = sqrt(dot(xy, xy));\n  float th = atan(xy.y, xy.x) * 6.0;\n  float f = .99 * (r + sin(r * r * q * .5 + time + sin(th) * 2.0) * .02) / r;\n\n  return xy * f;\n}\n\nvec2 tiles(vec2 xy) {\n\n  vec2 grid = floor(xy * 9.0);\n  float index = mod(grid.x + grid.y + (1.0 + grid.x) * grid.x * grid.y * 3.0, 4.0);\n\n  float d = .01;\n  if (index < .5) {\n    xy.x += d;\n  }\n  else if (index < 1.5) {\n    xy.x -= d;\n  }\n  else if (index < 2.5) {\n    xy.y += d;\n  }\n  else {\n    xy.y -= d;\n  }\n\n  return xy;\n}\n\nvec2 flower(vec2 xy) {\n  vec2 orig = xy;\n  float r = sqrt(dot(xy, xy));\n  float th = atan(xy.y, xy.x);\n\n  float th2 = th + sin(r * 64.0);\n  float r2 = r + sin(th * 64.0);\n\n  return mix(orig, vec2(cos(th2) * r2, sin(th2) * r2), .01);\n}\n\nvec2 rotate(vec2 xy, vec2 ref, float a) {\n  vec2 diff = xy - ref;\n  float c = cos(a);\n  float s = sin(a);\n  return ref + diff * mat2(c, -s, s, c);\n}\n\nvoid callback();\n\nvoid main() {\n  vec2 xy = (vUV * 2.0 - 1.0) * vec2(16.0/9.0, 1.0);\n  vec2 pos = xy;\n\n  if (field > 0.0) {\n\n    if (field < 1.0) {\n      xy = mix(xy, rotozoom(pos), clamp(field, 0.0, 1.0));\n    }\n    else if (field < 2.0) {\n      xy = rotozoom(pos);\n      xy = mix(xy, planeproject(pos), clamp(field - 1.0, 0.0, 1.0));\n    }\n    else if (field < 3.0) {\n      xy = planeproject(pos);\n      xy = mix(xy, ball(pos), clamp(field - 2.0, 0.0, 1.0));\n    }\n    else if (field < 4.0) {\n      xy = ball(pos);\n      xy = mix(xy, rotate(xy, pos, time), clamp(field - 3.0, 0.0, 1.0));\n    }\n    else if (field < 5.0) {\n      xy = ball(pos);\n      xy = rotate(xy, pos, time);\n      xy = mix(xy, rotate(swirl(pos), pos, time), clamp(field - 4.0, 0.0, 1.0) * .5);\n    }\n    else if (field < 6.0) {\n      xy = ball(pos);\n      xy = rotate(xy, pos, time);\n      xy = mix(xy, rotate(swirl(pos), pos, time), .5);\n      xy = mix(xy, mix(rotate(warp(pos * 1.131, 32.0) / 1.131, pos, -time * 1.711), rotate(warp(pos, 27.0), pos, time), .5), clamp(field - 5.0, 0.0, 1.0));\n    }\n    else if (field < 7.0) {\n      xy = mix(rotate(warp(pos * 1.131, 32.0) / 1.131, pos, -time * 1.711), rotate(warp(pos, 27.0), pos, time), .5);\n      xy = mix(xy, rotate(tiles(pos), pos, -time), clamp(field - 6.0, 0.0, 1.0));\n    }\n    else { //if (field < 8.0) {\n      xy = rotate(tiles(pos), pos, -time) * .995;\n      xy = mix(xy, flower(pos), clamp(field - 7.0, 0.0, 1.0));\n    }\n\n    xy += sampleStep * .2;\n  }\n\n  xy *= vec2(9.0/16.0, 1.0);\n\n  vec2 uv = fract(xy * .5 + .5);\n  vec4 sample = texture2D(texture, uv);\n\n  gl_FragColor = vec4(sample.xyz - vec3(fadeOut), 1.0);\n\n}\n",window.code=o,c={test:o},u=new i(c),a=u.shader().snippet("test")},{"./factory":1,"./graph":3,"./library":7}],7:[function(t,e){var n,r;r=t("./snippet"),n=function(){function t(t){this.snippets=null!=t?t:{},this.objects={}}return t.prototype.fetch=function(t){if(null==this.snippets[t])throw"Unknown snippet `"+t+"`";return null!=this.objects[t]?this.objects[t].clone():this.objects[t]=r.parse(t,this.snippets[t])},t}(),e.exports=n},{"./snippet":9}],8:[function(t,e){var n,r;e.exports=n={},r=function(t){return t.token.data},n.decl=function(t){var e,r,i,o;return"keyword"!==(null!=(e=t.token)?e.type:void 0)||"attribute"!==(r=null!=(i=t.token)?i.data:void 0)&&"uniform"!==r&&"varying"!==r?"function"===(null!=(o=t.children[5])?o.type:void 0)?n["function"](t):void 0:n.external(t)},n.external=function(t){var e,n,i,o,s,a,u;return e=t.children,s=e[1],a=e[3],u=e[4],i=e[5],n=i.children[0],o=i.children[1],{node:t,storage:r(s),type:r(u),ident:r(n),quant:!!o}},n["function"]=function(t){var e,i,o,s,a,u,c,l,f;return o=t.children,c=o[1],l=o[3],f=o[4],a=o[5],u=a.children[0],e=a.children[1],i=a.children[2],{node:t,storage:r(c),type:r(f),ident:r(u),args:function(){var t,r,i,o;for(i=e.children,o=[],t=0,r=i.length;r>t;t++)s=i[t],o.push(n.argument(s));return o}(),body:!!i}},n.argument=function(t){var e,n,i,o,s,a,u;return e=t.children,a=e[1],i=e[2],u=e[4],o=e[5],n=o.children[0],s=o.children[1],{node:t,storage:r(a),inout:r(i),type:r(u),ident:r(n),quant:!!s}}},{}],9:[function(t,e,n){n.Snippet=t("./snippet"),n.parse=t("./parse")},{"./parse":10,"./snippet":11}],10:[function(t,e){var n,r,i,o,s,a,u,c,l,f,h;f=t("../../vendor/glsl-tokenizer"),u=t("../../vendor/glsl-parser"),r=t("./decl"),l=function(){var t;return t=+new Date,function(e){var n;return n=+new Date-t,console.log(e,n+" ms"),n}},s=function(t,e){var n;throw n=a(t,e),c(n),"lol error"},a=function(t,e){var n,r,i,o,s,a,c,h;if(o=l(),c=f().process(u(),e),h=c[0],n=h[0],i=c[1],o("GLSL Tokenize & Parse"),!n||i.length){for(s=0,a=i.length;a>s;s++)r=i[s],console.error("[ShaderGraph] "+t+" -",r.message);throw"GLSL parse error"}return window.ast=n,n},c=function(t){var e,n,r,s,a;return s=l(),n=h(o,t),a=i(n),r=a[0],e=a[1],s("GLSL AST"),window.main=r,window.externals=e},o=function(t){switch(t.type){case"decl":return[r.decl(t),!0]}return[null,!0]},i=function(t){var e,n,r,i,o,s;for(n=[],i=null,o=0,s=t.length;s>o;o++)r=t[o],r.body?(n=function(){var t,i,o;for(o=[],t=0,i=n.length;i>t;t++)e=n[t],e.ident!==r.ident&&o.push(e);return o}(),i=r):n.push(r);return[i,n]},n=function(){var t,e,n;return t=function(t){switch(t.type){case"preprocessor":e(t);break;case"stmt":n(t)}return[null,!0]},n=function(){},e=function(t){var e;return e=t.token.data.split(" ")[1]}},h=function(t,e,n,r,i){var o,s,a,u,c,l,f,p,d;if(null==n&&(n=0),null==r&&(r=0),null==i&&(i=[]),console.log("                ".substring(16-r),e.type,null!=(l=e.token)?l.data:void 0,null!=(f=e.token)?f.type:void 0),p=t(e),a=p[0],s=p[1],null!=a&&i.push(a),s)for(d=e.children,n=u=0,c=d.length;c>u;n=++u)o=d[n],h(t,o,n,r+1,i);return i},e.exports=s},{"../../vendor/glsl-parser":12,"../../vendor/glsl-tokenizer":16,"./decl":8}],11:[function(t,e){var n;n=function(){function t(){}return t}(),e.exports=n},{}],12:[function(t,e){e.exports=t("./lib/index")},{"./lib/index":14}],13:[function(t,e){function n(){return this}function r(t,e){var n=y[t];return e=e||0,n?e>n.lbp&&(n.lbp=e):(n=Object.create(v),n.id=t,n.lbp=e,y[t]=n),n}function i(t){var e,n=p;for(l(),e=n.nud();t<p.lbp;)n=p,l(),e=n.led(e);return e}function o(t,e,n){var o=r(t,e);o.led=n||function(t){return this.children=[t,i(e)],this.type="binary",this}}function s(t,e,n){var o=r(t,e);return o.led=n||function(t){return this.children=[t,i(e-1)],this.type="binary",this},o}function a(t,e){var n=r(t);return n.nud=e||function(){return this.children=[i(70)],this.type="unary",this},n}function u(t){var e=r(t,150);e.led=function(t){return this.children=[t],this.type="suffix",this}}function c(t){return s(t,10,function(t){return this.children=[t,i(9)],this.assignment=!0,this.type="assign",this})}function l(t){var e,r,i,o;if(t&&p.data!==t)return h.unexpected("expected `"+t+"`, got `"+p.data+"`");if(g>=d.length)return void(p=y["(end)"]);if(e=d[g++],r=e.data,i=e.type,"ident"===i)o=h.scope.find(r)||h.create_node(),i=o.type;else if("builtin"===i)o=y["(builtin)"];else if("keyword"===i)o=y["(keyword)"];else if("operator"===i){if(o=y[r],!o)return h.unexpected("unknown operator `"+r+"`")}else{if("float"!==i&&"integer"!==i)return h.unexpected("unexpected token.");i="literal",o=y["(literal)"]}return o&&(o.nud||(o.nud=n),o.children||(o.children=[])),o=Object.create(o),o.token=e,o.type=i,o.data||(o.data=r),p=o}function f(t){return function(){return h.unexpected(t)}}var h,p,d,g,v={nud:function(){return this.children&&this.children.length?this:f("unexpected")()},led:f("missing operator")},y={};r("(ident)").nud=n,r("(keyword)").nud=n,r("(builtin)").nud=n,r("(literal)").nud=n,r("(end)"),r(":"),r(";"),r(","),r(")"),r("]"),r("}"),s("&&",30),s("||",30),o("|",43),o("^",44),o("&",45),o("==",46),o("!=",46),o("<",47),o("<=",47),o(">",47),o(">=",47),o(">>",48),o("<<",48),o("+",50),o("-",50),o("*",60),o("/",60),o("%",60),o("?",20,function(t){return this.children=[t,i(0),(l(":"),i(0))],this.type="ternary",this}),o(".",80,function(t){return p.type="literal",h.fake(p),this.children=[t,p],l(),this}),o("[",80,function(t){return this.children=[t,i(0)],this.type="binary",l("]"),this}),o("(",80,function(t){if(this.children=[t],this.type="call",")"!==p.data)for(;;){if(this.children.push(i(0)),","!==p.data)break;l(",")}return l(")"),this}),a("-"),a("+"),a("!"),a("~"),a("defined"),a("(",function(){return this.type="group",this.children=[i(0)],l(")"),this}),a("++"),a("--"),u("++"),u("--"),c("="),c("+="),c("-="),c("*="),c("/="),c("%="),c("&="),c("|="),c("^="),c(">>="),c("<<="),e.exports=function(t,e){function n(t){h.unshift(t,!1);for(var e=0,r=t.children.length;r>e;++e)n(t.children[e]);h.shift()}h=t,d=e,g=0;var r;if(d.length){if(l(),r=i(0),r.parent=h[0],n(r),g<d.length)throw new Error("did not use all tokens");r.parent.children=[r]}}},{}],14:[function(t,e){function n(){function t(t){if("whitespace"===t.type||"line-comment"===t.type||"block-comment"===t.type)return void Xe.push(t);for(We.push(t),Fe=Fe||We[0],Fe&&Xe.length&&(Fe.preceding=Fe.preceding||[],Fe.preceding=Fe.preceding.concat(Xe),Xe=[]);n();)switch(Ke[0].mode){case d:X();break;case g:N();break;case m:Y();break;case _:Z();break;case M:ne();break;case v:_e(!0,!0);break;case j:we();break;case p:ee();break;case P:te();break;case O:$();break;case y:Pe();break;case x:Oe();break;case w:ke();break;case b:Ce();break;case I:Te();break;case D:je();break;case k:Me();break;case V:be()}}function e(e){return arguments.length&&t(e),Ke.length>1?void ce("unexpected EOF"):void He.emit("end")}function n(){return Ye||!Ke.length?!1:(Fe=We[0])&&!He.paused}function h(t){Ke.unshift(t),Ke.shift()}function C(t,e){t.parent=Ke[0];var n=[].unshift.call(this,t);if(e=void 0===e?!0:e,f){for(var r="",i=0,o=this.length-1;o>i;++i)r+=" |";console.log(r,"\\"+t.type,t.token.data)}return e&&Se!==t&&Se.children.push(t),Se=t,n}function T(){var t=[].shift.call(this),e=Je[this.length],n=!1;if(f){for(var r="",i=0,o=this.length;o>i;++i)r+=" |";console.log(r,"/"+t.type)}return Je.length?"function"==typeof Je[0]?n=Je[0](t):void 0!==e&&(n=e.test?e.test(t.type):e===t.type):n=!0,n&&He.emit("data",t),Se=t.parent,t}function N(){function t(){if(Fe.data===Ke[0].expecting)return Ke.scope.exit(),Ke.shift();switch(Fe.type){case"preprocessor":return Ke.fake(ie()),void We.shift();default:return void Ke.unshift(Ie())}}return he(function(){return Ke.scope.enter(),l},t)()}function X(){if(Ke[0].brace)return"}"!==Fe.data?ce("expected `}`, got "+Fe.data):(Ke[0].brace=!1,We.shift(),Ke.shift());switch(Fe.type){case"eof":return Ke.shift();case"keyword":switch(Fe.data){case"for":return Ke.unshift(ze());case"if":return Ke.unshift(Ge());case"while":return Ke.unshift(Re());case"do":return Ke.unshift(Be());case"break":return Ke.fake(r(F,Fe)),We.shift();case"continue":return Ke.fake(r(S,Fe)),We.shift();case"discard":return Ke.fake(r(q,Fe)),We.shift();case"return":return Ke.unshift(Ae());case"precision":return Ke.unshift(Ve())}return Ke.unshift(oe(B));case"ident":var t;if(t=Ke.scope.find(Fe.data))return Ke.unshift("struct"===t.parent.type?oe(B):ae(";"));case"operator":if("{"===Fe.data){Ke[0].brace=!0;var e=qe();return e.expecting="}",We.shift(),Ke.unshift(e)}if(";"===Fe.data)return We.shift(),Ke.shift();default:return Ke.unshift(ae(";"))}}function Y(){function t(){return"invariant"===Fe.data?d.flags&z?(Ke.unshift(ue()),l):ce("`invariant` is not allowed here"):(Ke.fake(r(L,{data:"",position:Fe.position})),l)}function e(){return i(Fe)?d.flags&G?(Ke.unshift(ue()),l):ce("storage is not allowed here"):(Ke.fake(r(L,{data:"",position:Fe.position})),l)}function n(){return o(Fe)?d.flags&R?ce("parameter is not allowed here"):(Ke.unshift(ue()),l):(Ke.fake(r(L,{data:"",position:Fe.position})),l)}function a(){return s(Fe)?(Ke.unshift(ue()),l):(Ke.fake(r(L,{data:"",position:Fe.position})),l)}function u(){if("struct"===Fe.data)return d.flags&A?(Ke.unshift(se()),l):ce("cannot nest structs");if("keyword"===Fe.type)return Ke.unshift(ue()),l;var t=Ke.scope.find(Fe.data);return t?(Ke.fake(Object.create(t)),We.shift(),l):ce("expected user defined type, struct or keyword, got "+Fe.data)}function c(){return","!==Fe.data||d.flags&U?"["===Fe.data?void Ke.unshift(Qe()):")"===Fe.data?Ke.shift():";"===Fe.data?d.stage+3:"ident"!==Fe.type?ce("expected identifier, got "+Fe.data):(d.collected_name=We.shift(),l):Ke.shift()}function f(){return"("===Fe.data?(We.unshift(d.collected_name),delete d.collected_name,Ke.unshift(Ue()),d.stage+2):l}function h(){return We.unshift(d.collected_name),delete d.collected_name,Ke.unshift(Le()),l}function p(){return Ke.shift()}var d=Ke[0];return he(t,e,n,a,u,c,f,h,p)()}function Z(){if("ident"===Fe.type){var t=Fe.data;return Ke.unshift(Ee()),void Ke.scope.define(t)}if("operator"===Fe.type){if(","===Fe.data)return Ke[1].flags&U?We.shift():Ke.shift();if("="===Fe.data)return Ke[1].flags&E?(We.shift(),void Ke.unshift(ae(",",";"))):ce("`=` is not allowed here.");if("["===Fe.data)return void Ke.unshift(Qe())}return Ke.shift()}function $(){return"keyword"===Fe.type?(Ke[0].type="keyword",void(Ke[0].mode=P)):"ident"===Fe.type?(Ke[0].type="ident",void(Ke[0].mode=p)):ce("expected keyword or user-defined name, got "+Fe.data)}function te(){return"keyword"!==Fe.type?ce("expected keyword, got "+Fe.data):(Ke.shift(),We.shift())}function ee(){return"ident"!==Fe.type?ce("expected user-defined name, got "+Fe.data):(Ke[0].data=Fe.data,Ke.shift(),We.shift())}function ne(){function t(t){return u(Ke,t),Ke.shift()}var e=Ke[0].expecting;if(Ke[0].tokens=Ke[0].tokens||[],void 0===Ke[0].parenlevel&&(Ke[0].parenlevel=0,Ke[0].bracelevel=0),Ke[0].parenlevel<1&&e.indexOf(Fe.data)>-1)return t(Ke[0].tokens);switch("("===Fe.data?++Ke[0].parenlevel:")"===Fe.data&&--Ke[0].parenlevel,Fe.data){case"{":++Ke[0].bracelevel;break;case"}":--Ke[0].bracelevel;break;case"(":++Ke[0].parenlevel;break;case")":--Ke[0].parenlevel}return Ke[0].parenlevel<0?ce("unexpected `)`"):Ke[0].bracelevel<0?ce("unexpected `}`"):void Ke[0].tokens.push(We.shift())}function re(t){return function(){return r(t,Fe)}}function ie(){return r(W[Fe.type],Fe,Se)}function oe(t){var e=r(m,Fe,Se);return e.flags=t,e}function se(t,e){var n=r(v,Fe,Se);return n.allow_assign=void 0===t?!0:t,n.allow_comma=void 0===e?!0:e,n}function ae(){var t=r(M,Fe,Se);return t.expecting=[].slice.call(arguments),t}function ue(t){var e=Fe;return t&&(e={type:"(implied)",data:"(default)",position:e.position}),r(P,e,Se)}function ce(t){Ye=!0,He.emit("error",new Error((t||"unexpected "+Ke)+" at line "+Ke[0].token.line))}function le(t,e){return fe(t,Fe.type)&&fe(e,Fe.data)}function fe(t,e){switch(typeof t){case"string":return e!==t&&ce("expected `"+t+"`, got "+e+"\n"+Fe.data),!Ye;case"object":return t&&-1===t.indexOf(e)&&ce("expected one of `"+t.join("`, `")+"`, got "+e),!Ye}return!0}function he(){var t,e,n=[].slice.call(arguments);return function(){var r=Ke[0];return r.stage||(r.stage=0),(t=n[r.stage])?(e=t(),e===l?++r.stage:void(void 0!==e&&(r.stage=e))):ce("parser in undefined state!")}}function pe(t,e){return e=e||"operator",function(){if(le(e,t)){var n=We.shift(),r=Ke[0].children,i=r[r.length-1];return i&&i.token&&n.preceding&&(i.token.succeeding=i.token.succeeding||[],i.token.succeeding=i.token.succeeding.concat(n.preceding)),l}}}function de(t){return function(){return Ke.unshift(ae(t)),l}}function ge(t){return t?function(){var t=Fe.data;return le("ident")&&(Ke.unshift(Ee()),Ke.scope.define(t),l)}:function(){if(le("ident")){var t=Object.create(Ke.scope.find(Fe.data));return t.token=Fe,We.shift(),l}}}function ve(){return function(){var t=qe();return t.expecting="}",Ke.unshift(t),l}}function ye(t){return function(){var e=Ke[0].stage;return"{"!==Fe.data?(Ke.unshift(Ie()),e+t):(We.shift(),l)}}function xe(){return function(){return Ke.shift(),Ke.shift()}}function me(){_e=he(pe("struct","keyword"),function(){return"{"===Fe.data?(Ke.fake(r(p,{data:"",position:Fe.position,type:"ident"})),l):ge(!0)()},function(){return Ke.scope.enter(),l},pe("{"),function(){return"}"===Fe.data?(Ke.scope.exit(),We.shift(),Ke.shift()):";"===Fe.data?void We.shift():void Ke.unshift(oe(H))}),we=he(function(){return We.shift(),l},function(){return le("keyword",["lowp","mediump","highp"])&&(Ke.unshift(ue()),l)},function(){return Ke.unshift(ue()),l},function(){return Ke.shift()}),be=he(pe("["),de("]"),pe("]"),function(){return Ke.shift()}),ke=he(pe("for","keyword"),pe("("),function(){var t;if("ident"===Fe.type){if((t=Ke.scope.find(Fe.data))||(t=Ke.create_node()),"struct"===t.parent.type)return Ke.unshift(oe(B)),l}else if("builtin"===Fe.type||"keyword"===Fe.type)return Ke.unshift(oe(B)),l;return de(";")()},pe(";"),de(";"),pe(";"),de(")"),pe(")"),ye(3),ve(),pe("}"),xe()),Me=he(pe("if","keyword"),pe("("),de(")"),pe(")"),ye(3),ve(),pe("}"),function(){return"else"===Fe.data?(We.shift(),Ke.unshift(Ie()),l):xe()()},xe()),je=he(pe("return","keyword"),function(){return";"===Fe.data?l:(Ke.unshift(ae(";")),l)},function(){We.shift(),xe()()}),Ce=he(pe("while","keyword"),pe("("),de(")"),pe(")"),ye(3),ve(),pe("}"),xe()),Te=he(pe("do","keyword"),ye(3),ve(),pe("}"),pe("while","keyword"),pe("("),de(")"),pe(")"),xe()),Pe=he(function(){for(var t=1,e=Ke.length;e>t;++t)if(Ke[t].mode===y)return ce("function definition is not allowed within another function");return l},function(){if(le("ident")){var t=Fe.data,e=Ke.scope.find(t);return Ke.unshift(Ee()),Ke.scope.define(t),Ke.scope.enter(e?e.scope:null),l}},pe("("),function(){return Ke.unshift(Ne()),l},pe(")"),function(){return";"===Fe.data?(Ke.scope.exit(),Ke.shift(),Ke.shift()):l},pe("{"),ve(),pe("}"),function(){return Ke.scope.exit(),l},function(){return Ke.shift(),Ke.shift(),Ke.shift()}),Oe=he(function(){return"void"===Fe.data?(Ke.fake(ue()),We.shift(),l):")"===Fe.data?void Ke.shift():"struct"===Fe.data?(Ke.unshift(se(J,K)),l):(Ke.unshift(oe(Q)),l)},function(){return","===Fe.data?(We.shift(),0):")"===Fe.data?void Ke.shift():void ce("expected one of `,` or `)`, got "+Fe.data)})}var _e,we,be,ke,Me,je,Ce,Te,Pe,Oe,De,Fe,Se,qe=re(g),Ie=re(d),Le=re(_),Ve=re(j),Ee=re(p),Ue=(re(O),re(y)),Ne=re(x),ze=re(w),Ge=re(k),Re=re(b),Ae=re(D),Be=re(I),Qe=re(V),He=a(t,e),Je=arguments.length?[].slice.call(arguments):[],Ke=[],We=[],Xe=[],Ye=!1;return Ke.shift=T,Ke.unshift=C,Ke.fake=h,Ke.unexpected=ce,Ke.scope=new c(Ke),Ke.create_node=function(){var t=r(p,Fe);return t.parent=He.program,t},me(),Se=qe(),Se.expecting="(eof)",Se.mode=g,Se.token={type:"(program)",data:"(program)"},De=Se,He.program=De,He.scope=function(t){return 1===arguments.length&&(Ke.scope=t),Ke.scope},Ke.unshift(Se),He}function r(t,e){return{mode:t,token:e,children:[],type:X[t],id:(4294967295*Math.random()).toString(16)}}function i(t){return"const"===t.data||"attribute"===t.data||"uniform"===t.data||"varying"===t.data}function o(t){return"in"===t.data||"inout"===t.data||"out"===t.data}function s(t){return"highp"===t.data||"mediump"===t.data||"lowp"===t.data}e.exports=n;var a=t("../../through"),u=t("./expr"),c=t("./scope"),l=new Object,f=!1,h=0,p=h++,d=h++,g=h++,v=h++,y=h++,x=h++,m=h++,_=h++,w=h++,b=h++,k=h++,M=h++,j=h++,C=h++,T=h++,P=h++,O=h++,D=h++,F=h++,S=h++,q=h++,I=h++,L=h++,V=h++,E=1,U=2,N=4,z=8,G=16,R=32,A=64,B=255,Q=B&~(E|U|R|z|N),H=B&~(E|z|G|A),J=!1,K=!1,W={"block-comment":C,"line-comment":C,preprocessor:T},X=h=["ident","stmt","stmtlist","struct","function","functionargs","decl","decllist","forloop","whileloop","if","expr","precision","comment","preprocessor","keyword","keyword_or_ident","return","break","continue","discard","do-while","placeholder","quantifier"]},{"../../through":20,"./expr":13,"./scope":15}],15:[function(t,e){function n(t){return this.constructor!==n?new n(t):(this.state=t,this.scopes=[],void(this.current=null))}e.exports=n;var r=n,i=r.prototype;i.enter=function(t){this.scopes.push(this.current=this.state[0].scope=t||{})},i.exit=function(){this.scopes.pop(),this.current=this.scopes[this.scopes.length-1]},i.define=function(t){this.current[t]=this.state[0]},i.find=function(t){for(var e=this.scopes.length-1;e>-1;--e)if(this.scopes[e].hasOwnProperty(t))return this.scopes[e][t];return null}},{}],16:[function(t,e){function n(){function t(t){t.length&&V.queue({type:w[N],data:t,position:R,line:G})}function e(t){for(E=0,Q+=t.toString(),L=Q.length;q=Q[E],L>E;)switch(N){case c:E=C();break;case l:E=j();break;case f:E=M();break;case h:E=T();break;case p:E=D();break;case _:E=O();break;case d:E=F();break;case u:E=S();break;case x:E=k();break;case a:E=b()}U+=E,Q=Q.slice(E)}function n(){z.length&&t(z.join("")),N=m,t("(eof)"),V.queue(null)}function b(){return z=z.length?[]:z,"/"===I&&"*"===q?(R=U+E-1,N=c,I=q,E+1):"/"===I&&"/"===q?(R=U+E-1,N=l,I=q,E+1):"#"===q?(N=f,R=U+E,E):/\s/.test(q)?(N=x,R=U+E,E):(A=/\d/.test(q),B=/[^\w_]/.test(q),R=U+E,N=A?p:B?h:u,E)}function k(){return"\n"===q&&++G,/[^\s]/g.test(q)?(t(z.join("")),N=a,E):(z.push(q),I=q,E+1)}function M(){return"\n"===q&&++G,"\n"===q&&"\\"!==I?(t(z.join("")),N=a,E):(z.push(q),I=q,E+1)}function j(){return M()}function C(){return"/"===q&&"*"===I?(z.push(q),t(z.join("")),N=a,E+1):("\n"===q&&++G,z.push(q),I=q,E+1)}function T(){if("."===I&&/\d/.test(q))return N=d,E;if("/"===I&&"*"===q)return N=c,E;if("/"===I&&"/"===q)return N=l,E;if("."===q&&z.length){for(;P(z););return N=d,E}if(";"===q){if(z.length)for(;P(z););return t(q),N=a,E+1}var e=2===z.length&&"="!==q;if(/[\w_\d\s]/.test(q)||e){for(;P(z););return N=a,E}return z.push(q),I=q,E+1}function P(e){for(var n,r=0,i=e.length;;){n=o.indexOf(e.slice(0,e.length+r).join(""));{if(-1!==n)return t(o[n]),R+=o[n].length,z=z.slice(o[n].length),z.length;if(r-=1,i-=1,0>i)return 0}}}function O(){return/[^a-fA-F0-9]/.test(q)?(t(z.join("")),N=a,E):(z.push(q),I=q,E+1)}function D(){return"."===q?(z.push(q),N=d,I=q,E+1):/[eE]/.test(q)?(z.push(q),N=d,I=q,E+1):"x"===q&&1===z.length&&"0"===z[0]?(N=_,z.push(q),I=q,E+1):/[^\d]/.test(q)?(t(z.join("")),N=a,E):(z.push(q),I=q,E+1)}function F(){return"f"===q&&(z.push(q),I=q,E+=1),/[eE]/.test(q)?(z.push(q),I=q,E+1):/[^\d]/.test(q)?(t(z.join("")),N=a,E):(z.push(q),I=q,E+1)}function S(){if(/[^\d\w_]/.test(q)){var e=z.join("");return N=i.indexOf(e)>-1?y:s.indexOf(e)>-1?v:g,t(z.join("")),N=a,E}return z.push(q),I=q,E+1}var q,I,L,V=r(e,n),E=0,U=0,N=a,z=[],G=1,R=0,A=!1,B=!1,Q="";return V}e.exports=n;var r=t("../through"),i=t("./lib/literals"),o=t("./lib/operators"),s=t("./lib/builtins"),a=999,u=9999,c=0,l=1,f=2,h=3,p=4,d=5,g=6,v=7,y=8,x=9,m=10,_=11,w=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"]
},{"../through":20,"./lib/builtins":17,"./lib/literals":18,"./lib/operators":19}],17:[function(t,e){e.exports=["gl_Position","gl_PointSize","gl_ClipVertex","gl_FragCoord","gl_FrontFacing","gl_FragColor","gl_FragData","gl_FragDepth","gl_Color","gl_SecondaryColor","gl_Normal","gl_Vertex","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_FogCoord","gl_MaxLights","gl_MaxClipPlanes","gl_MaxTextureUnits","gl_MaxTextureCoords","gl_MaxVertexAttribs","gl_MaxVertexUniformComponents","gl_MaxVaryingFloats","gl_MaxVertexTextureImageUnits","gl_MaxCombinedTextureImageUnits","gl_MaxTextureImageUnits","gl_MaxFragmentUniformComponents","gl_MaxDrawBuffers","gl_ModelViewMatrix","gl_ProjectionMatrix","gl_ModelViewProjectionMatrix","gl_TextureMatrix","gl_NormalMatrix","gl_ModelViewMatrixInverse","gl_ProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverse","gl_TextureMatrixInverse","gl_ModelViewMatrixTranspose","gl_ProjectionMatrixTranspose","gl_ModelViewProjectionMatrixTranspose","gl_TextureMatrixTranspose","gl_ModelViewMatrixInverseTranspose","gl_ProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixInverseTranspose","gl_TextureMatrixInverseTranspose","gl_NormalScale","gl_DepthRangeParameters","gl_DepthRange","gl_ClipPlane","gl_PointParameters","gl_Point","gl_MaterialParameters","gl_FrontMaterial","gl_BackMaterial","gl_LightSourceParameters","gl_LightSource","gl_LightModelParameters","gl_LightModel","gl_LightModelProducts","gl_FrontLightModelProduct","gl_BackLightModelProduct","gl_LightProducts","gl_FrontLightProduct","gl_BackLightProduct","gl_FogParameters","gl_Fog","gl_TextureEnvColor","gl_EyePlaneS","gl_EyePlaneT","gl_EyePlaneR","gl_EyePlaneQ","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_ObjectPlaneR","gl_ObjectPlaneQ","gl_FrontColor","gl_BackColor","gl_FrontSecondaryColor","gl_BackSecondaryColor","gl_TexCoord","gl_FogFragCoord","gl_Color","gl_SecondaryColor","gl_TexCoord","gl_FogFragCoord","gl_PointCoord","radians","degrees","sin","cos","tan","asin","acos","atan","pow","exp","log","exp2","log2","sqrt","inversesqrt","abs","sign","floor","ceil","fract","mod","min","max","clamp","mix","step","smoothstep","length","distance","dot","cross","normalize","faceforward","reflect","refract","matrixCompMult","lessThan","lessThanEqual","greaterThan","greaterThanEqual","equal","notEqual","any","all","not","texture2D","texture2DProj","texture2DLod","texture2DProjLod","textureCube","textureCubeLod"]},{}],18:[function(t,e){e.exports=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"]},{}],19:[function(t,e){e.exports=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"]},{}],20:[function(t,e){var n;n=function(t,e){var n,r;return r=[],n=[],{output:r,parser:null,write:t,end:e,process:function(e,n){return this.parser=e,t(n),this.flush(),this.parser.flush()},flush:function(){return e(),[r,n]},queue:function(t){var e;return null!=t?null!=(e=this.parser)?e.write(t):void 0:void 0},emit:function(t,e){return"data"===t&&null==e.parent&&r.push(e),"error"===t?n.push(e):void 0}}},e.exports=n},{}]},{},[6]);