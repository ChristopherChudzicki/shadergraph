!function t(e,n,r){function i(u,s){if(!n[u]){if(!e[u]){var a="function"==typeof require&&require;if(!s&&a)return a(u,!0);if(o)return o(u,!0);throw new Error("Cannot find module '"+u+"'")}var c=n[u]={exports:{}};e[u][0].call(c.exports,function(t){var n=e[u][1][t];return i(n?n:t)},c,c.exports,t,e,n,r)}return n[u].exports}for(var o="function"==typeof require&&require,u=0;u<r.length;u++)i(r[u]);return i}({1:[function(t,e){var n,r;r=t("../graph"),n=function(){function t(){this.node=new r.Node(this,this.makeOutlets())}return t.prototype.link=function(){},t.prototype.call=function(t,e){null==e&&(e=0)},t.prototype.externals=function(){return{}},t.prototype.solo=function(){},t.prototype._link=function(t,e,n,r){return t.link(this.node,e,n,r)},t.prototype._include=function(t,e){return t.include(this.node,e)},t.prototype._call=function(t,e,n){var r,i,o,u,s,a,c,l,p,h,f;for(t.call(this.node,e,n),p=this.node.inputs,c=0,l=p.length;l>c;c++)if(s=p[c],a=null!=(h=s.input)?h.node.owner:void 0,"("===s.type[0]){f=this.externals();for(o in f)r=f[o],r.name===s.name&&(i=r,u=o);null!=a&&a.link(t,u,i)}else null!=a&&a.call(t,n+1);return t},t}(),e.exports=n},{"../graph":7}],2:[function(t,e){var n,r,i,o,u={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=t("../graph"),n=t("./block"),o=t("../linker"),r=function(t){function e(t){this.graph=t,e.__super__.constructor.apply(this,arguments),this.namespace=o.entry()}return s(e,t),e.prototype.makeOutlets=function(){var t,e,n,r,o,u,s,a,c,l,p;for(n=[],t=[],r=[],l=this.graph.inputs(),u=0,a=l.length;a>u;u++)e=l[u],t.push(e.type);for(p=this.graph.outputs(),s=0,c=p.length;c>s;s++)e=p[s],r.push(e.type);return t=t.join(","),r=r.join(","),o="("+t+")("+r+")",n.push({name:"callback",type:o,inout:i.OUT}),n},e.prototype.externals=function(){var t,e;return null!=(t=null!=(e=this.subroutine)?e.externals:void 0)?t:{}},e.prototype.solo=function(){return this.subroutine=o.compile(this.graph.tail().owner,this.namespace)},e.prototype.link=function(t,e,n){return this.solo(),this._include(t,this.subroutine),this._link(t,this.subroutine,e,n)},e}(n),e.exports=r},{"../graph":7,"../linker":12,"./block":1}],3:[function(t,e,n){n.Block=t("./block"),n.Shader=t("./shader"),n.Isolate=t("./isolate"),n.Callback=t("./callback")},{"./block":1,"./callback":2,"./isolate":4,"./shader":5}],4:[function(t,e){var n,r,i,o,u={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};r=t("../graph"),n=t("./block"),o=t("../linker"),i=function(t){function e(t){this.graph=t,e.__super__.constructor.apply(this,arguments),this.namespace=o.entry()}return s(e,t),e.prototype.makeOutlets=function(){var t,e,n,r,i,o,u,s;for(e=[],u=this.graph.inputs(),n=0,i=u.length;i>n;n++)t=u[n],e.push(t);for(s=this.graph.outputs(),r=0,o=s.length;o>r;r++)t=s[r],e.push(t);return e},e.prototype.externals=function(){var t,e;return null!=(t=null!=(e=this.subroutine)?e.externals:void 0)?t:{}},e.prototype.solo=function(){return this.subroutine=o.compile(this.graph.tail().owner,this.namespace)},e.prototype.call=function(t,e){return null==e&&(e=0),this.solo(),this._call(t,this.subroutine,e)},e}(n),e.exports=i},{"../graph":7,"../linker":12,"./block":1}],5:[function(t,e){var n,r,i={}.hasOwnProperty,o=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=t("./block"),r=function(t){function e(t){this.snippet=t,this.namespace=this.snippet.namespace,e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.externals=function(){return this.snippet.externals},e.prototype.makeOutlets=function(){var t,e,n,r;n=[],n=n.concat(this.snippet.main.signature),r=this.snippet.externals;for(e in r)t=r[e],n.push(t);return n},e.prototype.solo=function(){return this.snippet},e.prototype.link=function(t,e,n){return this._include(t,this.snippet),this._link(t,this.snippet,e,n)},e.prototype.call=function(t,e){return null==e&&(e=0),this._call(t,this.snippet,e)},e}(n),e.exports=r},{"./block":1}],6:[function(t,e){var n;n=function(){function t(t,e){this.parent=null!=e?e:null,this.nodes=[],t&&this.add(t)}return t.IN=0,t.OUT=1,t.prototype.inputs=function(){var t,e,n,r,i,o,u,s,a;for(t=[],s=this.nodes,r=0,o=s.length;o>r;r++)for(e=s[r],a=e.inputs,i=0,u=a.length;u>i;i++)n=a[i],null===n.input&&t.push(n);return t},t.prototype.outputs=function(){var t,e,n,r,i,o,u,s,a;for(n=[],s=this.nodes,r=0,o=s.length;o>r;r++)for(t=s[r],a=t.outputs,i=0,u=a.length;u>i;i++)e=a[i],0===e.output.length&&n.push(e);return n},t.prototype.tail=function(){return this.nodes[this.nodes.length-1]},t.prototype.add=function(t,e){var n,r,i;{if(!t.length){if(t.graph&&!e)throw"Adding node to two graphs at once";return t.graph=this,this.nodes.push(t)}for(n=0,r=t.length;r>n;n++)i=t[n],this.add(i)}},t.prototype.remove=function(t,e){var n,r,i;{if(!t.length){if(t.graph!==this)throw"Removing node from wrong graph.";return e||t.disconnect(),this.nodes.splice(this.nodes.indexOf(t),1),t.graph=null}for(n=0,r=t.length;r>n;n++)i=t[n],this.remove(i)}},t}(),e.exports=n},{}],7:[function(t,e,n){n.Graph=t("./graph"),n.Node=t("./node"),n.Outlet=t("./outlet"),n.IN=n.Graph.IN,n.OUT=n.Graph.OUT},{"./graph":6,"./node":8,"./outlet":9}],8:[function(t,e){var n,r,i;n=t("./graph"),i=t("./outlet"),r=function(){function t(t,e){this.owner=t,this.graph=null,this.inputs=[],this.outputs=[],this.outlets=null,this.setOutlets(e)}return t.prototype.getIn=function(t){var e;return function(){var n,r,i,o;for(i=this.inputs,o=[],n=0,r=i.length;r>n;n++)e=i[n],e.name===t&&o.push(e);return o}.call(this)[0]},t.prototype.getOut=function(t){var e;return function(){var n,r,i,o;for(i=this.outputs,o=[],n=0,r=i.length;r>n;n++)e=i[n],e.name===t&&o.push(e);return o}.call(this)[0]},t.prototype.get=function(t){return this.getIn(t)||this.getOut(t)},t.prototype.setOutlets=function(t){var e,n,r,o,u,s,a,c,l,p,h,f,d;if(o=function(t){return new i(t.inout,t.name,t.hint,t.type,t.meta)},null!=t){if(null==this.outlets){for(this.outlets={},a=0,p=t.length;p>a;a++)s=t[a],this._add(o(s));return}for(n=function(t){return[t.name,t.inout,t.type].join("-")},u={},c=0,h=t.length;h>c;c++)s=t[c],u[n(s)]=!0;d=this.outlets;for(r in d)s=d[r],r=n(s),u[r]?u[r]=s:this._remove(s);for(l=0,f=t.length;f>l;l++)s=t[l],e=u[n(s)],e instanceof i?this._morph(e,s):this._add(o(s))}return this.outlets},t.prototype.connect=function(t,e,n){var r,i,o,u,s,a,c,l,p,h,f,d;for(s={},i={},f=t.inputs,c=0,p=f.length;p>c;c++)u=f[c],(n||!u.input)&&(a=u.type,r=[a,u.hint].join("-"),i[r]||(i[r]=u),s[a]=s[a]||[],s[a].push(u));for(d=this.outputs,l=0,h=d.length;h>l;l++)u=d[l],e&&u.output.length||(a=u.type,r=[a,u.hint].join("-"),o=s[a],i[r]?(i[r].connect(u),delete i[r],o.splice(o.indexOf(u),1)):o&&o.length&&o.shift().connect(u));return this},t.prototype.disconnect=function(){var t,e,n,r,i,o,u;for(o=this.inputs,e=0,r=o.length;r>e;e++)t=o[e],t.disconnect();for(u=this.outputs,n=0,i=u.length;i>n;n++)t=u[n],t.disconnect();return this},t.prototype._key=function(t){return[t.name,t.inout].join("-")},t.prototype._add=function(t){var e;if(e=this._key(t),t.node)throw"Adding outlet to two nodes at once.";if(this.outlets[e])throw"Adding two identical outlets to same node. ("+e+")";return t.setNode(this),t.inout===n.IN&&this.inputs.push(t),t.inout===n.OUT&&this.outputs.push(t),this.outlets[e]=t},t.prototype._morph=function(t,e){var n;return n=this._key(e),delete this.outlets[n],t.morph(e),n=this._key(e),this.outlets[n]=e},t.prototype._remove=function(t){var e,r;if(r=this._key(t),e=t.inout,t.node!==this)throw"Removing outlet from wrong node.";return t.disconnect(),t.setNode(null),delete this.outlets[r],t.inout===n.IN&&this.inputs.splice(this.inputs.indexOf(t),1),t.inout===n.OUT&&this.outputs.splice(this.outputs.indexOf(t),1),this},t}(),e.exports=r},{"./graph":6,"./outlet":9}],9:[function(t,e){var n,r;n=t("./graph"),r=function(){function t(e,n,r,i,o){this.inout=e,this.name=n,this.hint=r,this.type=i,this.meta=o,null==this.hint&&(this.hint=n),this.node=null,this.input=null,this.output=[],this.id=t.id(this.hint)}return t.index=0,t.id=function(e){return"_io_"+ ++t.index+"_"+e},t.prototype.morph=function(t){return this.inout=t.inout,this.name=t.name,this.hint=t.hint,this.type=t.type,this.meta=t.meta},t.prototype.connect=function(t){if(this.inout===n.IN&&t.inout===n.OUT)return t.connect(this);if(this.inout!==n.OUT||t.inout!==n.IN)throw"Can only connect out to in.";if(t.input!==this)return t.disconnect(),t.input=this,this.output.push(t)},t.prototype.disconnect=function(t){var e,n,r,i;if(this.input&&this.input.disconnect(this),this.output.length){if(!t){for(i=this.output,n=0,r=i.length;r>n;n++)t=i[n],t.input=null;return this.output=[]}if(e=this.output.indexOf(t),e>=0)return this.output.splice(e,1),t.input=null}},t.prototype.setNode=function(t){this.node=t},t}(),e.exports=r},{"./graph":6}],10:[function(t,e){var n,r,i,o,u,s,a,c,l,p,h;n=t("./linker"),r=function(){function e(t){return null==t&&(t={}),this instanceof e?void(this.library=new n.Library(t)):new e(t)}return e.prototype.shader=function(){return new n.Factory(this.library)},e.Graph=t("./graph"),e.Snippet=t("./snippet"),e.Block=t("./block"),e.Linker=t("./linker"),e}(),e.exports=r,window.ShaderGraph=r,i="float foobar(vec3 color) {\n}",o="float callback(vec3 color);\nfloat foobar(vec3 color) {\n}",u="float callback(vec3 color);\nvoid main(in vec3 color) {\n  float f = callback(color);\n}",h={code1:i,code2:o,code3:u},l=r(h),c=l.shader(),s=c.group().group().snippet("code1").callback().snippet("code2").callback().snippet("code3").end(),p=s.compile(),a=function(t){var e,n,r,i;return e={},n=i=r=0,t=t.replace(/\b_io_[0-9]+([A-Za-z0-9_]+)\b/g,function(t,r){var i;return null!=(i=e[t])?i:e[t]="_io_"+ ++n+r}),t=t.replace(/\b_sn_[0-9]+([A-Za-z0-9_]+)\b/g,function(t,n){var r;return null!=(r=e[t])?r:e[t]="_sn_"+ ++i+n}),t=t.replace(/\b_pg_[0-9]+_\b/g,function(t){var n;return null!=(n=e[t])?n:e[t]="_pg_"+ ++r+"_"})},window.graph=s,window.snippet=p,window.code=a(p.code)},{"./block":3,"./graph":7,"./linker":12,"./snippet":17}],11:[function(t,e){var n,r,i,o,u;i=t("../graph"),n=t("../block"),o=t("./program"),r=function(){function t(t){this.library=t,this.end()}return t.prototype.snippet=function(t,e){return this._append(this._shader(t,e))},t.prototype.before=function(t,e){return this._prepend(this._shader(t,e))},t.prototype.callback=function(){var t,e,r,i,o;return o=this._combine(),r=o[0],e=o[1],r.nodes.length&&(i=this._subgraph(r),t=new n.Callback(i),this._append(t.node)),this},t.prototype.isolate=function(){var t,e,r,i,o;return o=this._combine(),r=o[0],e=o[1],r.nodes.length&&(i=this._subgraph(r),t=new n.Isolate(i),this._append(t.node)),this},t.prototype.combine=function(){var t,e,n,r,i,o,u,s,a,c,l;for(a=this._combine(),n=a[0],e=a[1],c=n.start,i=0,u=c.length;u>i;i++)for(r=c[i],l=e.end,o=0,s=l.length;s>o;o++)t=l[o],t.connect(r,!0);return e.end=n.end,this},t.prototype.group=function(){return this._push(),this._push(),this},t.prototype.next=function(){var t;return t=this._pop(),this._state.start=this._state.start.concat(t.start),this._state.end=this._state.end.concat(t.end),this._state.nodes=this._state.nodes.concat(t.nodes),this._push(),this},t.prototype.pass=function(){return this.next(),this._state.end=this._stack[2].end,this.combine()},t.prototype.end=function(){var t;return t=this.graph,this.graph=new i.Graph,this._state=new u,this._stack=[this._state],t&&(t.compile=function(){return o.compile(t.tail().owner)}),t},t.prototype.compile=function(){return this.end().compile()},t.prototype._shader=function(t,e){var r,i;return i=this.library.fetch(t),i.apply(e),r=new n.Shader(i),r.node},t.prototype._subgraph=function(t){var e,n,r,o,u;for(n=new i.Graph,u=t.nodes,r=0,o=u.length;o>r;r++)e=u[r],this.graph.remove(e,!0),n.add(e,!0);return n},t.prototype._combine=function(){if(this._stack.length<=2)throw"Popping factory stack too far";return this.next()._pop(),[this._pop(),this._state]},t.prototype._push=function(){return this._stack.unshift(new u),this._state=this._stack[0]},t.prototype._pop=function(){return this._state=this._stack[1],this._stack.shift()},t.prototype._append=function(t){var e,n,r,i;for(this.graph.add(t),i=this._state.end,n=0,r=i.length;r>n;n++)e=i[n],e.connect(t);return this._state.start.length||(this._state.start=[t]),this._state.end=[t],this._state.nodes.push(t),this},t.prototype._prepend=function(t){var e,n,r,i;for(this.graph.add(t),i=this._state.start,n=0,r=i.length;r>n;n++)e=i[n],t.connect(e);return this._state.end.length||(this._state.end=[t]),this._state.start=[t],this._state.nodes.push(t),this},t}(),u=function(){function t(t,e,n){this.start=null!=t?t:[],this.end=null!=e?e:[],this.nodes=null!=n?n:[]}return t}(),e.exports=r},{"../block":3,"../graph":7,"./program":14}],12:[function(t,e,n){n.Factory=t("./factory"),n.Library=t("./library"),n.Program=t("./program"),n.compile=n.Program.compile,n.entry=n.Program.entry},{"./factory":11,"./library":13,"./program":14}],13:[function(t,e){var n,r;r=t("../snippet"),n=function(){function t(t){this.snippets=null!=t?t:{},this.objects={}}return t.prototype.fetch=function(t){if(null==this.snippets[t])throw"Unknown snippet `"+t+"`";return null==this.objects[t]&&(this.objects[t]=r.load(t,this.snippets[t])),this.objects[t].clone()},t}(),e.exports=n},{"../snippet":17}],14:[function(t,e){var n,r,i;n=t("../graph"),i=t("../snippet").Snippet,r=function(){function t(t,e){this.block=t,this.namespace=e,this.modules={},this.calls={},this.links=[],this.includes=[],this.externals={},this.uniforms={},this.attributes={}}return t.index=0,t.entry=function(){return"_pg_"+ ++t.index+"_"},t.compile=function(e){var n;return n=new t(e,this.namespace),n.compile()},t.prototype.compile=function(){var t;return t=this.block.node.graph,1===t.nodes.length?this._snippet(this.block.solo()):(this.block.call(this,0),this._assemble())},t.prototype.link=function(t,e,n,r){return this.links.push({node:t,module:e,name:n,external:r})},t.prototype.include=function(t,e){var n,r,i,o,u,s,a,c;if(!this._included(e)){this.modules[e.namespace]=e,this.includes.push(e.code),u=e.uniforms;for(r in u)n=u[r],this.uniforms[r]=n;s=e.attributes;for(r in s)n=s[r],this.attributes[r]=n;a=e.externals,c=[];for(r in a)n=a[r],i=n.name,o=t.get(i),c.push(o.input?void 0:this.externals[r]=n);return c}},t.prototype.call=function(t,e,n){var r,i;return i=e.namespace,(r=this.calls[i])?r.priority=Math.max(r.priority,n):this.calls[i]={node:t,module:e,priority:n},this},t.prototype._snippet=function(t){var e;return e=new i,e._program=this,e.namespace=t.namespace,e.code=t.code,e.main=t.main,e.entry=t.entry,e.externals=t.externals,e.uniforms=t.uniforms,e.attributes=t.attributes,e},t.prototype._included=function(t){return!!this.modules[t.namespace]},t.prototype._assemble=function(){var e,r,i,o,u,s,a,c,l,p,h,f,d,g,m,v;return e="_i_n_o_u_t",r="return",c=function(t){return t.replace(e,"")},p=function(t){var e;return e=c(t),e!==t},l=function(t,e){var r;return r=t.get(e),r.inout===n.IN?null===r.input:r.inout===n.OUT?0===r.output.length:void 0},d=function(t,e){var n;return n=t.get(e),n.input&&(n=n.input),e=n.name,p(e)?d(n.node,c(e)):n.id},v=function(t,e,n,i,o){var u,s,a,c,l,h,f,d;for(s=[],h="",f=0,d=i.length;d>f;f++)if(u=i[f],l=u.param,c=u.name,!p(c)&&(a=t(c),c===r?h=""+a+" = ":s.push(a),o))if(e(c))if(c===r){if(""!==o["return"])throw"Error: two unconnected return values within same graph";o.type=u.spec,o["return"]="  return "+a+";\n",o.vars[a]="  "+l(a),o.signature.push(u)}else o.params.push(l(a,!0)),o.signature.push(u.copy(a));else o.vars[a]="  "+l(a);return s=s.join(", "),"  "+h+n+"("+s+")"},u=function(t){var e;return t=function(){var n,r,i;for(i=[],n=0,r=t.length;r>n;n++)e=t[n],i.push(h(e));return i}(),t.join(";\n")},h=function(){return function(t){var e,i,u,s,a,c,l,p,h,f,d,g,y,_,x,b,k,w,M,T,j,P,C,O,E,S,I;for(g=t.node,f=t.module,d=t.name,s=t.external,p=f.main,u=f.entry,k=!0,c=[],x=[],h={},b=[f.namespace,r].join(""),S=s.signature,T=0,P=S.length;P>T;T++)e=S[T],l=e.inout===n.IN?c:x,l.push(e);for(I=p.signature,j=0,C=I.length;C>j;j++)e=I[j],l=e.inout===n.IN?c:x,y=l.shift(),E=y.name,E===r&&(E=b),h[e.name]=E;return O=function(t){return h[t]},M=function(){return!0},a=m(),i=v(O,M,u,p.signature,a),h={"return":b},O=function(t){var e;return null!=(e=h[t])?e:t},_=m(),w=v(O,M,u,s.signature,_),_.calls=[i],_.entry=d,o(_).code}}(this),s=function(t){return function(e){var n,r,i,o,u,s,a;for(i=function(e,r){var i,o,u,s;return t.include(e,r),o=r.main,i=r.entry,s=function(t){return d(e,t)},u=function(t){return l(e,t)},n.calls.push(v(s,u,i,o.signature,n))},n=m(),o=function(){var t;t=[];for(u in e)r=e[u],t.push(r);return t}(),o.sort(function(t,e){return e.priority-t.priority}),s=0,a=o.length;a>s;s++)r=o[s],i(r.node,r.module);return n}}(this),m=function(){return{entry:null,vars:{},"return":"",type:"void",calls:[],params:[],signature:[]}},o=function(e){var n,r,i,o,u,s,a,c,l,p;return o=null!=(p=e.entry)?p:t.entry(),l=function(){var t,n;t=e.vars,n=[];for(c in t)i=t[c],n.push(i);return n}(),u=e.params,n=e.calls,a=e.type,s=e["return"],n.push(""),l.length?(l.push(""),l=l.join(";\n")+"\n"):l="",n=n.join(";\n"),u=u.join(", "),r=""+a+" "+o+"("+u+") {\n"+l+n+s+"}",{signature:e.signature,code:r,name:o}},i=s(this.calls),this.namespace&&(i.entry=this.namespace),f=u(this.links),f.length&&this.includes.push(f),g=o(i),this.includes.push(g.code),a=this.includes.join("\n"),this._snippet({namespace:g.name,code:a,main:g,entry:g.name,externals:this.externals,uniforms:this.uniforms,attributes:this.attributes})},t}(),e.exports=r},{"../graph":7,"../snippet":17}],15:[function(t,e){var n,r,i,o,u;u=t("./walk"),o=function(){var t;return t=+new Date,function(e){var n;return n=+new Date-t,console.log(e,n+" ms"),n}},r=function(t){var e,n,r,i,o,u,s,a,c,l;for(n={},r=function(t){return n[t.name]=!0},r(t.main),c=["external","internal","varying","uniform"],o=0,s=c.length;s>o;o++)for(e=c[o],l=t[e],u=0,a=l.length;a>u;u++)i=l[u],r(i);return n},n=function(t){var e,n,o,u;return e=t.ast,n=t.code,u=t.signatures,o=r(u),i(n,o)},i=function(t,e){var n,r;return r=new RegExp("\\b("+function(){var t;t=[];for(n in e)t.push(n);return t}().join("|")+")\\b","g"),t=t.replace(/\/\/[^\n]*/g,""),t=t.replace(/\/\*([^*]|\*[^\/])*\*\//g,""),t=t.replace(/^#[^\n]*/gm,""),function(i,o){var u,s;null==i&&(i=""),null==o&&(o={}),u={};for(n in e)u[n]=i+(null!=(s=o[n])?s:n);return t.replace(r,function(t){return u[t]})}},e.exports=n},{"./walk":20}],16:[function(t,e){var n,r;e.exports=n={},n["in"]=0,n.out=1,n.inout=2,r=function(t){return t.token.data},n.node=function(t){var e,r;return"function"===(null!=(e=t.children[5])?e.type:void 0)?n["function"](t):"keyword"===(null!=(r=t.token)?r.type:void 0)?n.external(t):void 0},n.external=function(t){var e,n,i,o,u,s,a,c,l,p,h,f,d;for(e=t.children,c=r(e[1]),l=r(e[3]),p=r(e[4]),o=e[5],"attribute"!==c&&"uniform"!==c&&"varying"!==c&&(c="global"),s=[],d=o.children,n=h=0,f=d.length;f>h;n=++h)e=d[n],"ident"===e.type&&(i=r(e),u=o.children[n+1],a="quantifier"===(null!=u?u.type:void 0),s.push({decl:"external",storage:c,type:p,ident:i,quant:!!a}));return s},n["function"]=function(t){var e,i,o,u,s,a,c,l,p,h;return o=t.children,l=r(o[1]),p=r(o[3]),h=r(o[4]),a=o[5],c=r(a.children[0]),e=a.children[1],i=a.children[2],s=function(){var t,r,i,o;for(i=e.children,o=[],t=0,r=i.length;r>t;t++)u=i[t],o.push(n.argument(u));return o}(),[{decl:"function",storage:l,type:h,ident:c,body:!!i,args:s}]},n.argument=function(t){var e,n,i,o,u,s,a;return e=t.children,s=r(e[1]),i=r(e[2]),a=r(e[4]),o=e[5],n=r(o.children[0]),u=o.children[1],{decl:"argument",storage:s,inout:i,type:a,ident:n,quant:!!u}},n.param=function(t,e,n,r){var i,o;return i=[],null!=e&&i.push(e),null!=n&&i.push(n),i.push(""),i=i.join(" "),o=r?"["+r+"]":"",""!==t&&(t+=" "),function(e,n){return(n?t:"")+(""+i+e+o)}},n.type=function(t,e,r,i,o){var u,s,a,c,l,p,h,f,d;return p={"float":"f",vec2:"v2",vec3:"v3",vec4:"v4",mat3:"m3",mat4:"m4",sampler2D:"t",samplerCube:"t"},u={"float":0,vec2:window.THREE?new THREE.Vector3:null,vec3:window.THREE?new THREE.Vector3:null,vec4:window.THREE?new THREE.Vector4:null,mat4:window.THREE?new THREE.Matrix4:null,sampler2D:0,samplerCube:0},s={"in":n["in"],out:n.out,inout:n.inout},l={"const":"const"},h=p[e],r&&(h+="v"),f=u[h],a=null!=(d=s[i])?d:s["in"],o=l[o],c=n.param(i,o,e,r),{name:t,type:h,spec:e,param:c,value:f,inout:a,copy:function(t){return n.copy(this,t)}}},n.copy=function(t,e){var n,r,i,o,u,s,a;return a=t,i=a.name,t=a.type,u=a.spec,o=a.param,s=a.value,r=a.inout,n=a.copy,null!=e&&(i=e),{name:i,type:t,spec:u,param:o,value:s,inout:r,copy:n}}},{}],17:[function(t,e,n){n.Snippet=t("./snippet"),n.parse=t("./parse"),n.compile=t("./compile"),n.decl=t("./decl"),n.load=n.Snippet.load},{"./compile":15,"./decl":16,"./parse":18,"./snippet":19}],18:[function(t,e){var n,r,i,o,u,s,a,c,l,p,h,f,d,g,m;g=t("../../vendor/glsl-tokenizer"),p=t("../../vendor/glsl-parser"),u=t("./decl"),m=t("./walk"),o=!1,n="_i_n_o_u_t",r="return",d=function(){var t;return t=+new Date,function(e){var n;return n=+new Date-t,console.log(e,n+" ms"),n}},c=function(t,e){var n,r;return n=l(t,e),r=h(n,e)},l=function(t,e){var n,r,i,u,s,a,c,l;if(o&&(u=d()),c=g().process(p(),e),l=c[0],n=l[0],i=c[1],o&&u("GLSL Tokenize & Parse"),!n||i.length){for(s=0,a=i.length;a>s;s++)r=i[s],console.error("[ShaderGraph] "+t+" -",r.message);throw"GLSL parse error"}return n},h=function(t,e){var n,r,u,c,l,p,h;return o&&(p=d()),l=[],m(a,i(l),t,""),h=f(l),u=h[0],r=h[1],n=h[2],c=s(u,r,n),o&&p("GLSL AST"),{ast:t,code:e,signatures:c}},a=function(t,e){switch(t.type){case"decl":return e(u.node(t)),!1}return!0},i=function(t){return function(e){var n,r,i,o;if(null!=e){for(o=[],r=0,i=e.length;i>r;r++)n=e[r],o.push(t.push(n));return o}}},f=function(t){var e,n,r,i,o,u,s,a;for(i=null,r=[],n=[],o={},s=0,a=t.length;a>s;s++)u=t[s],u.body?(o[u.ident]&&(n=function(){var t,r,i;for(i=[],t=0,r=n.length;r>t;t++)e=n[t],e.ident!==u.ident&&i.push(e);return i}(),delete o[u.ident]),r.push(u),i=u):"global"===u.storage?r.push(u):(n.push(u),o[u.ident]=!0);return[i,r,n]},s=function(t,e,i){var o,s,a,c,l,p,h,f,d;for(c={uniform:[],attribute:[],varying:[],external:[],internal:[],global:[],main:null},s=function(t){return u.type(t.ident,t.type,t.quant,t.inout,t.storage)},a=function(t,e){var i,o,a,c,l,p,h,f,d,g,m;for(f=function(){var e,n,r,i;for(r=t.args,i=[],e=0,n=r.length;n>e;e++)o=r[e],i.push(s(o));return i}(),g=0,m=f.length;m>g;g++)c=f[g],c.inout===u.inout&&(i=c,a=c.copy(),i.inout=u["in"],a.inout=u.out,a.name+=n,f.push(a));return"void"!==t.type&&f.push(u.type(r,t.type,!1,"out")),p=function(){var t,e,n;for(n=[],t=0,e=f.length;e>t;t++)c=f[t],c.inout===u["in"]&&n.push(c.type);return n}().join(","),h=function(){var t,e,n;for(n=[],t=0,e=f.length;e>t;t++)c=f[t],c.inout===u.out&&n.push(c.type);return n}().join(","),d="("+p+")("+h+")",l={name:t.ident,type:d,signature:f,inout:e,spec:t.type}},c.main=a(t,u.out),p=0,f=e.length;f>p;p++)l=e[p],c.internal.push({name:l.ident});for(h=0,d=i.length;d>h;h++)switch(l=i[h],l.decl){case"external":o=s(l),c[l.storage].push(o);break;case"function":o=a(l,u["in"]),c.external.push(o)}return c},e.exports=c},{"../../vendor/glsl-parser":21,"../../vendor/glsl-tokenizer":25,"./decl":16,"./walk":20}],19:[function(t,e){var n,r,i;i=t("./parse"),r=t("./compile"),n=function(){function t(t,e){this._signatures=t,this._assembler=e,this.namespace=null,this.code=null,this.main=null,this.entry=null,this.uniforms=null,this.externals=null,this.attributes=null}return t.index=0,t.namespace=function(){return"_sn_"+ ++t.index+"_"},t.load=function(e,n){var o,u;return u=i(e,n),o=r(u),new t(u.signatures,o)},t.prototype.clone=function(){return new t(this._signatures,this._assembler)},t.prototype.apply=function(e,n){var r,i,o,u,s,a,c,l,p,h,f,d,g,m;for(this.namespace=n,null==this.namespace&&(this.namespace=t.namespace()),this.code=this._assembler(this.namespace),this.main=this._signatures.main,this.entry=this.namespace+this.main.name,this.uniforms={},this.externals={},this.attributes={},s=function(t){return function(e,n){return t.uniforms[t.namespace+(null!=n?n:e.name)]=e}}(this),o=function(t){return function(e){return t.externals[t.namespace+e.name]=e}}(this),r=function(t){return function(e){return t.attributes[e.name]=e}}(this),d=this._signatures.uniform,a=0,p=d.length;p>a;a++)i=d[a],s(i);for(g=this._signatures.external,c=0,h=g.length;h>c;c++)i=g[c],o(i);for(m=this._signatures.attribute,l=0,f=m.length;f>l;l++)i=m[l],r(i);for(u in e)i=e[u],s(i,u);return null},t}(),e.exports=n},{"./compile":15,"./parse":18}],20:[function(t,e){var n,r;n=!1,r=function(t,e,i,o){var u,s,a,c,l,p,h,f;if(n&&console.log(o,i.type,null!=(p=i.token)?p.data:void 0,null!=(h=i.token)?h.type:void 0),a=t(i,e))for(f=i.children,s=c=0,l=f.length;l>c;s=++c)u=f[s],r(t,e,u,o+"  ",n);return null},e.exports=r},{}],21:[function(t,e){e.exports=t("./lib/index")},{"./lib/index":23}],22:[function(t,e){function n(){return this}function r(t,e){var n=v[t];return e=e||0,n?e>n.lbp&&(n.lbp=e):(n=Object.create(m),n.id=t,n.lbp=e,v[t]=n),n}function i(t){var e,n=f;for(l(),e=n.nud();t<f.lbp;)n=f,l(),e=n.led(e);return e}function o(t,e,n){var o=r(t,e);o.led=n||function(t){return this.children=[t,i(e)],this.type="binary",this}}function u(t,e,n){var o=r(t,e);return o.led=n||function(t){return this.children=[t,i(e-1)],this.type="binary",this},o}function s(t,e){var n=r(t);return n.nud=e||function(){return this.children=[i(70)],this.type="unary",this},n}function a(t){var e=r(t,150);e.led=function(t){return this.children=[t],this.type="suffix",this}}function c(t){return u(t,10,function(t){return this.children=[t,i(9)],this.assignment=!0,this.type="assign",this})}function l(t){var e,r,i,o;if(t&&f.data!==t)return h.unexpected("expected `"+t+"`, got `"+f.data+"`");if(g>=d.length)return void(f=v["(end)"]);if(e=d[g++],r=e.data,i=e.type,"ident"===i)o=h.scope.find(r)||h.create_node(),i=o.type;else if("builtin"===i)o=v["(builtin)"];else if("keyword"===i)o=v["(keyword)"];else if("operator"===i){if(o=v[r],!o)return h.unexpected("unknown operator `"+r+"`")}else{if("float"!==i&&"integer"!==i)return h.unexpected("unexpected token.");i="literal",o=v["(literal)"]}return o&&(o.nud||(o.nud=n),o.children||(o.children=[])),o=Object.create(o),o.token=e,o.type=i,o.data||(o.data=r),f=o}function p(t){return function(){return h.unexpected(t)}}var h,f,d,g,m={nud:function(){return this.children&&this.children.length?this:p("unexpected")()},led:p("missing operator")},v={};r("(ident)").nud=n,r("(keyword)").nud=n,r("(builtin)").nud=n,r("(literal)").nud=n,r("(end)"),r(":"),r(";"),r(","),r(")"),r("]"),r("}"),u("&&",30),u("||",30),o("|",43),o("^",44),o("&",45),o("==",46),o("!=",46),o("<",47),o("<=",47),o(">",47),o(">=",47),o(">>",48),o("<<",48),o("+",50),o("-",50),o("*",60),o("/",60),o("%",60),o("?",20,function(t){return this.children=[t,i(0),(l(":"),i(0))],this.type="ternary",this}),o(".",80,function(t){return f.type="literal",h.fake(f),this.children=[t,f],l(),this}),o("[",80,function(t){return this.children=[t,i(0)],this.type="binary",l("]"),this}),o("(",80,function(t){if(this.children=[t],this.type="call",")"!==f.data)for(;;){if(this.children.push(i(0)),","!==f.data)break;l(",")}return l(")"),this}),s("-"),s("+"),s("!"),s("~"),s("defined"),s("(",function(){return this.type="group",this.children=[i(0)],l(")"),this}),s("++"),s("--"),a("++"),a("--"),c("="),c("+="),c("-="),c("*="),c("/="),c("%="),c("&="),c("|="),c("^="),c(">>="),c("<<="),e.exports=function(t,e){function n(t){h.unshift(t,!1);for(var e=0,r=t.children.length;r>e;++e)n(t.children[e]);h.shift()}h=t,d=e,g=0;var r;if(d.length){if(l(),r=i(0),r.parent=h[0],n(r),g<d.length)throw new Error("did not use all tokens");r.parent.children=[r]}}},{}],23:[function(t,e){function n(){function t(t){if("whitespace"===t.type||"line-comment"===t.type||"block-comment"===t.type)return void We.push(t);for(Ke.push(t),Se=Se||Ke[0],Se&&We.length&&(Se.preceding=Se.preceding||[],Se.preceding=Se.preceding.concat(We),We=[]);n();)switch(Je[0].mode){case d:W();break;case g:V();break;case _:X();break;case x:Y();break;case M:ne();break;case m:xe(!0,!0);break;case T:be();break;case f:ee();break;case C:te();break;case O:$();break;case v:Ce();break;case y:Oe();break;case b:we();break;case k:je();break;case D:Pe();break;case E:Te();break;case w:Me();break;case q:ke()}}function e(e){return arguments.length&&t(e),Je.length>1?void ce("unexpected EOF"):void Qe.emit("end")}function n(){return Xe||!Je.length?!1:(Se=Ke[0])&&!Qe.paused}function h(t){Je.unshift(t),Je.shift()}function j(t,e){t.parent=Je[0];var n=[].unshift.call(this,t);if(e=void 0===e?!0:e,p){for(var r="",i=0,o=this.length-1;o>i;++i)r+=" |";console.log(r,"\\"+t.type,t.token.data)}return e&&Ie!==t&&Ie.children.push(t),Ie=t,n}function P(){var t=[].shift.call(this),e=Ze[this.length],n=!1;if(p){for(var r="",i=0,o=this.length;o>i;++i)r+=" |";console.log(r,"/"+t.type)}return Ze.length?"function"==typeof Ze[0]?n=Ze[0](t):void 0!==e&&(n=e.test?e.test(t.type):e===t.type):n=!0,n&&Qe.emit("data",t),Ie=t.parent,t}function V(){function t(){if(Se.data===Je[0].expecting)return Je.scope.exit(),Je.shift();switch(Se.type){case"preprocessor":return Je.fake(ie()),void Ke.shift();default:return void Je.unshift(De())}}return he(function(){return Je.scope.enter(),l},t)()}function W(){if(Je[0].brace)return"}"!==Se.data?ce("expected `}`, got "+Se.data):(Je[0].brace=!1,Ke.shift(),Je.shift());switch(Se.type){case"eof":return Je.shift();case"keyword":switch(Se.data){case"for":return Je.unshift(Ue());case"if":return Je.unshift(Ge());case"while":return Je.unshift(ze());case"do":return Je.unshift(Be());case"break":return Je.fake(r(S,Se)),Ke.shift();case"continue":return Je.fake(r(I,Se)),Ke.shift();case"discard":return Je.fake(r(F,Se)),Ke.shift();case"return":return Je.unshift(Ae());case"precision":return Je.unshift(qe())}return Je.unshift(oe(B));case"ident":var t;if(t=Je.scope.find(Se.data))return Je.unshift("struct"===t.parent.type?oe(B):se(";"));case"operator":if("{"===Se.data){Je[0].brace=!0;var e=Fe();return e.expecting="}",Ke.shift(),Je.unshift(e)}if(";"===Se.data)return Ke.shift(),Je.shift();default:return Je.unshift(se(";"))}}function X(){function t(){return"invariant"===Se.data?d.flags&U?(Je.unshift(ae()),l):ce("`invariant` is not allowed here"):(Je.fake(r(L,{data:"",position:Se.position})),l)}function e(){return i(Se)?d.flags&G?(Je.unshift(ae()),l):ce("storage is not allowed here"):(Je.fake(r(L,{data:"",position:Se.position})),l)}function n(){return o(Se)?d.flags&z?ce("parameter is not allowed here"):(Je.unshift(ae()),l):(Je.fake(r(L,{data:"",position:Se.position})),l)}function s(){return u(Se)?(Je.unshift(ae()),l):(Je.fake(r(L,{data:"",position:Se.position})),l)}function a(){if("struct"===Se.data)return d.flags&A?(Je.unshift(ue()),l):ce("cannot nest structs");if("keyword"===Se.type)return Je.unshift(ae()),l;var t=Je.scope.find(Se.data);return t?(Je.fake(Object.create(t)),Ke.shift(),l):ce("expected user defined type, struct or keyword, got "+Se.data)}function c(){return","!==Se.data||d.flags&R?"["===Se.data?void Je.unshift(He()):")"===Se.data?Je.shift():";"===Se.data?d.stage+3:"ident"!==Se.type?ce("expected identifier, got "+Se.data):(d.collected_name=Ke.shift(),l):Je.shift()}function p(){return"("===Se.data?(Ke.unshift(d.collected_name),delete d.collected_name,Je.unshift(Re()),d.stage+2):l}function h(){return Ke.unshift(d.collected_name),delete d.collected_name,Je.unshift(Le()),l}function f(){return Je.shift()}var d=Je[0];return he(t,e,n,s,a,c,p,h,f)()}function Y(){if("ident"===Se.type){var t=Se.data;return Je.unshift(Ne()),void Je.scope.define(t)}if("operator"===Se.type){if(","===Se.data)return Je[1].flags&R?Ke.shift():Je.shift();if("="===Se.data)return Je[1].flags&N?(Ke.shift(),void Je.unshift(se(",",";"))):ce("`=` is not allowed here.");if("["===Se.data)return void Je.unshift(He())}return Je.shift()}function $(){return"keyword"===Se.type?(Je[0].type="keyword",void(Je[0].mode=C)):"ident"===Se.type?(Je[0].type="ident",void(Je[0].mode=f)):ce("expected keyword or user-defined name, got "+Se.data)
}function te(){return"keyword"!==Se.type?ce("expected keyword, got "+Se.data):(Je.shift(),Ke.shift())}function ee(){return"ident"!==Se.type?ce("expected user-defined name, got "+Se.data):(Je[0].data=Se.data,Je.shift(),Ke.shift())}function ne(){function t(t){return a(Je,t),Je.shift()}var e=Je[0].expecting;if(Je[0].tokens=Je[0].tokens||[],void 0===Je[0].parenlevel&&(Je[0].parenlevel=0,Je[0].bracelevel=0),Je[0].parenlevel<1&&e.indexOf(Se.data)>-1)return t(Je[0].tokens);switch("("===Se.data?++Je[0].parenlevel:")"===Se.data&&--Je[0].parenlevel,Se.data){case"{":++Je[0].bracelevel;break;case"}":--Je[0].bracelevel;break;case"(":++Je[0].parenlevel;break;case")":--Je[0].parenlevel}return Je[0].parenlevel<0?ce("unexpected `)`"):Je[0].bracelevel<0?ce("unexpected `}`"):void Je[0].tokens.push(Ke.shift())}function re(t){return function(){return r(t,Se)}}function ie(){return r(K[Se.type],Se,Ie)}function oe(t){var e=r(_,Se,Ie);return e.flags=t,e}function ue(t,e){var n=r(m,Se,Ie);return n.allow_assign=void 0===t?!0:t,n.allow_comma=void 0===e?!0:e,n}function se(){var t=r(M,Se,Ie);return t.expecting=[].slice.call(arguments),t}function ae(t){var e=Se;return t&&(e={type:"(implied)",data:"(default)",position:e.position}),r(C,e,Ie)}function ce(t){Xe=!0,Qe.emit("error",new Error((t||"unexpected "+Je)+" at line "+Je[0].token.line))}function le(t,e){return pe(t,Se.type)&&pe(e,Se.data)}function pe(t,e){switch(typeof t){case"string":return e!==t&&ce("expected `"+t+"`, got "+e+"\n"+Se.data),!Xe;case"object":return t&&-1===t.indexOf(e)&&ce("expected one of `"+t.join("`, `")+"`, got "+e),!Xe}return!0}function he(){var t,e,n=[].slice.call(arguments);return function(){var r=Je[0];return r.stage||(r.stage=0),(t=n[r.stage])?(e=t(),e===l?++r.stage:void(void 0!==e&&(r.stage=e))):ce("parser in undefined state!")}}function fe(t,e){return e=e||"operator",function(){if(le(e,t)){var n=Ke.shift(),r=Je[0].children,i=r[r.length-1];return i&&i.token&&n.preceding&&(i.token.succeeding=i.token.succeeding||[],i.token.succeeding=i.token.succeeding.concat(n.preceding)),l}}}function de(t){return function(){return Je.unshift(se(t)),l}}function ge(t){return t?function(){var t=Se.data;return le("ident")&&(Je.unshift(Ne()),Je.scope.define(t),l)}:function(){if(le("ident")){var t=Object.create(Je.scope.find(Se.data));return t.token=Se,Ke.shift(),l}}}function me(){return function(){var t=Fe();return t.expecting="}",Je.unshift(t),l}}function ve(t){return function(){var e=Je[0].stage;return"{"!==Se.data?(Je.unshift(De()),e+t):(Ke.shift(),l)}}function ye(){return function(){return Je.shift(),Je.shift()}}function _e(){xe=he(fe("struct","keyword"),function(){return"{"===Se.data?(Je.fake(r(f,{data:"",position:Se.position,type:"ident"})),l):ge(!0)()},function(){return Je.scope.enter(),l},fe("{"),function(){return"}"===Se.data?(Je.scope.exit(),Ke.shift(),Je.shift()):";"===Se.data?void Ke.shift():void Je.unshift(oe(Q))}),be=he(function(){return Ke.shift(),l},function(){return le("keyword",["lowp","mediump","highp"])&&(Je.unshift(ae()),l)},function(){return Je.unshift(ae()),l},function(){return Je.shift()}),ke=he(fe("["),de("]"),fe("]"),function(){return Je.shift()}),we=he(fe("for","keyword"),fe("("),function(){var t;if("ident"===Se.type){if((t=Je.scope.find(Se.data))||(t=Je.create_node()),"struct"===t.parent.type)return Je.unshift(oe(B)),l}else if("builtin"===Se.type||"keyword"===Se.type)return Je.unshift(oe(B)),l;return de(";")()},fe(";"),de(";"),fe(";"),de(")"),fe(")"),ve(3),me(),fe("}"),ye()),Me=he(fe("if","keyword"),fe("("),de(")"),fe(")"),ve(3),me(),fe("}"),function(){return"else"===Se.data?(Ke.shift(),Je.unshift(De()),l):ye()()},ye()),Te=he(fe("return","keyword"),function(){return";"===Se.data?l:(Je.unshift(se(";")),l)},function(){Ke.shift(),ye()()}),je=he(fe("while","keyword"),fe("("),de(")"),fe(")"),ve(3),me(),fe("}"),ye()),Pe=he(fe("do","keyword"),ve(3),me(),fe("}"),fe("while","keyword"),fe("("),de(")"),fe(")"),ye()),Ce=he(function(){for(var t=1,e=Je.length;e>t;++t)if(Je[t].mode===v)return ce("function definition is not allowed within another function");return l},function(){if(le("ident")){var t=Se.data,e=Je.scope.find(t);return Je.unshift(Ne()),Je.scope.define(t),Je.scope.enter(e?e.scope:null),l}},fe("("),function(){return Je.unshift(Ve()),l},fe(")"),function(){return";"===Se.data?(Je.scope.exit(),Je.shift(),Je.shift()):l},fe("{"),me(),fe("}"),function(){return Je.scope.exit(),l},function(){return Je.shift(),Je.shift(),Je.shift()}),Oe=he(function(){return"void"===Se.data?(Je.fake(ae()),Ke.shift(),l):")"===Se.data?void Je.shift():"struct"===Se.data?(Je.unshift(ue(Z,J)),l):(Je.unshift(oe(H)),l)},function(){return","===Se.data?(Ke.shift(),0):")"===Se.data?void Je.shift():void ce("expected one of `,` or `)`, got "+Se.data)})}var xe,be,ke,we,Me,Te,je,Pe,Ce,Oe,Ee,Se,Ie,Fe=re(g),De=re(d),Le=re(x),qe=re(T),Ne=re(f),Re=(re(O),re(v)),Ve=re(y),Ue=re(b),Ge=re(w),ze=re(k),Ae=re(E),Be=re(D),He=re(q),Qe=s(t,e),Ze=arguments.length?[].slice.call(arguments):[],Je=[],Ke=[],We=[],Xe=!1;return Je.shift=P,Je.unshift=j,Je.fake=h,Je.unexpected=ce,Je.scope=new c(Je),Je.create_node=function(){var t=r(f,Se);return t.parent=Qe.program,t},_e(),Ie=Fe(),Ie.expecting="(eof)",Ie.mode=g,Ie.token={type:"(program)",data:"(program)"},Ee=Ie,Qe.program=Ee,Qe.scope=function(t){return 1===arguments.length&&(Je.scope=t),Je.scope},Je.unshift(Ie),Qe}function r(t,e){return{mode:t,token:e,children:[],type:W[t]}}function i(t){return"const"===t.data||"attribute"===t.data||"uniform"===t.data||"varying"===t.data}function o(t){return"in"===t.data||"inout"===t.data||"out"===t.data}function u(t){return"highp"===t.data||"mediump"===t.data||"lowp"===t.data}e.exports=n;var s=t("../../through"),a=t("./expr"),c=t("./scope"),l=new Object,p=!1,h=0,f=h++,d=h++,g=h++,m=h++,v=h++,y=h++,_=h++,x=h++,b=h++,k=h++,w=h++,M=h++,T=h++,j=h++,P=h++,C=h++,O=h++,E=h++,S=h++,I=h++,F=h++,D=h++,L=h++,q=h++,N=1,R=2,V=4,U=8,G=16,z=32,A=64,B=255,H=B&~(N|R|z|U|V),Q=B&~(N|U|G|A),Z=!1,J=!1,K={"block-comment":j,"line-comment":j,preprocessor:P},W=h=["ident","stmt","stmtlist","struct","function","functionargs","decl","decllist","forloop","whileloop","if","expr","precision","comment","preprocessor","keyword","keyword_or_ident","return","break","continue","discard","do-while","placeholder","quantifier"]},{"../../through":29,"./expr":22,"./scope":24}],24:[function(t,e){function n(t){return this.constructor!==n?new n(t):(this.state=t,this.scopes=[],void(this.current=null))}e.exports=n;var r=n,i=r.prototype;i.enter=function(t){this.scopes.push(this.current=this.state[0].scope=t||{})},i.exit=function(){this.scopes.pop(),this.current=this.scopes[this.scopes.length-1]},i.define=function(t){this.current[t]=this.state[0]},i.find=function(t){for(var e=this.scopes.length-1;e>-1;--e)if(this.scopes[e].hasOwnProperty(t))return this.scopes[e][t];return null}},{}],25:[function(t,e){function n(){function t(t){t.length&&q.queue({type:b[V],data:t,position:z,line:G})}function e(t){for(N=0,H+=t.toString(),L=H.length;F=H[N],L>N;)switch(V){case c:N=j();break;case l:N=T();break;case p:N=M();break;case h:N=P();break;case f:N=E();break;case x:N=O();break;case d:N=S();break;case a:N=I();break;case y:N=w();break;case s:N=k()}R+=N,H=H.slice(N)}function n(){U.length&&t(U.join("")),V=_,t("(eof)"),q.queue(null)}function k(){return U=U.length?[]:U,"/"===D&&"*"===F?(z=R+N-1,V=c,D=F,N+1):"/"===D&&"/"===F?(z=R+N-1,V=l,D=F,N+1):"#"===F?(V=p,z=R+N,N):/\s/.test(F)?(V=y,z=R+N,N):(A=/\d/.test(F),B=/[^\w_]/.test(F),z=R+N,V=A?f:B?h:a,N)}function w(){return"\n"===F&&++G,/[^\s]/g.test(F)?(t(U.join("")),V=s,N):(U.push(F),D=F,N+1)}function M(){return"\n"===F&&++G,"\n"===F&&"\\"!==D?(t(U.join("")),V=s,N):(U.push(F),D=F,N+1)}function T(){return M()}function j(){return"/"===F&&"*"===D?(U.push(F),t(U.join("")),V=s,N+1):("\n"===F&&++G,U.push(F),D=F,N+1)}function P(){if("."===D&&/\d/.test(F))return V=d,N;if("/"===D&&"*"===F)return V=c,N;if("/"===D&&"/"===F)return V=l,N;if("."===F&&U.length){for(;C(U););return V=d,N}if(";"===F){if(U.length)for(;C(U););return t(F),V=s,N+1}var e=2===U.length&&"="!==F;if(/[\w_\d\s]/.test(F)||e){for(;C(U););return V=s,N}return U.push(F),D=F,N+1}function C(e){for(var n,r=0,i=e.length;;){n=o.indexOf(e.slice(0,e.length+r).join(""));{if(-1!==n)return t(o[n]),z+=o[n].length,U=U.slice(o[n].length),U.length;if(r-=1,i-=1,0>i)return 0}}}function O(){return/[^a-fA-F0-9]/.test(F)?(t(U.join("")),V=s,N):(U.push(F),D=F,N+1)}function E(){return"."===F?(U.push(F),V=d,D=F,N+1):/[eE]/.test(F)?(U.push(F),V=d,D=F,N+1):"x"===F&&1===U.length&&"0"===U[0]?(V=x,U.push(F),D=F,N+1):/[^\d]/.test(F)?(t(U.join("")),V=s,N):(U.push(F),D=F,N+1)}function S(){return"f"===F&&(U.push(F),D=F,N+=1),/[eE]/.test(F)?(U.push(F),D=F,N+1):/[^\d]/.test(F)?(t(U.join("")),V=s,N):(U.push(F),D=F,N+1)}function I(){if(/[^\d\w_]/.test(F)){var e=U.join("");return V=i.indexOf(e)>-1?v:u.indexOf(e)>-1?m:g,t(U.join("")),V=s,N}return U.push(F),D=F,N+1}var F,D,L,q=r(e,n),N=0,R=0,V=s,U=[],G=1,z=0,A=!1,B=!1,H="";return q}e.exports=n;var r=t("../through"),i=t("./lib/literals"),o=t("./lib/operators"),u=t("./lib/builtins"),s=999,a=9999,c=0,l=1,p=2,h=3,f=4,d=5,g=6,m=7,v=8,y=9,_=10,x=11,b=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"]},{"../through":29,"./lib/builtins":26,"./lib/literals":27,"./lib/operators":28}],26:[function(t,e){e.exports=["gl_Position","gl_PointSize","gl_ClipVertex","gl_FragCoord","gl_FrontFacing","gl_FragColor","gl_FragData","gl_FragDepth","gl_Color","gl_SecondaryColor","gl_Normal","gl_Vertex","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_FogCoord","gl_MaxLights","gl_MaxClipPlanes","gl_MaxTextureUnits","gl_MaxTextureCoords","gl_MaxVertexAttribs","gl_MaxVertexUniformComponents","gl_MaxVaryingFloats","gl_MaxVertexTextureImageUnits","gl_MaxCombinedTextureImageUnits","gl_MaxTextureImageUnits","gl_MaxFragmentUniformComponents","gl_MaxDrawBuffers","gl_ModelViewMatrix","gl_ProjectionMatrix","gl_ModelViewProjectionMatrix","gl_TextureMatrix","gl_NormalMatrix","gl_ModelViewMatrixInverse","gl_ProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverse","gl_TextureMatrixInverse","gl_ModelViewMatrixTranspose","gl_ProjectionMatrixTranspose","gl_ModelViewProjectionMatrixTranspose","gl_TextureMatrixTranspose","gl_ModelViewMatrixInverseTranspose","gl_ProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixInverseTranspose","gl_TextureMatrixInverseTranspose","gl_NormalScale","gl_DepthRangeParameters","gl_DepthRange","gl_ClipPlane","gl_PointParameters","gl_Point","gl_MaterialParameters","gl_FrontMaterial","gl_BackMaterial","gl_LightSourceParameters","gl_LightSource","gl_LightModelParameters","gl_LightModel","gl_LightModelProducts","gl_FrontLightModelProduct","gl_BackLightModelProduct","gl_LightProducts","gl_FrontLightProduct","gl_BackLightProduct","gl_FogParameters","gl_Fog","gl_TextureEnvColor","gl_EyePlaneS","gl_EyePlaneT","gl_EyePlaneR","gl_EyePlaneQ","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_ObjectPlaneR","gl_ObjectPlaneQ","gl_FrontColor","gl_BackColor","gl_FrontSecondaryColor","gl_BackSecondaryColor","gl_TexCoord","gl_FogFragCoord","gl_Color","gl_SecondaryColor","gl_TexCoord","gl_FogFragCoord","gl_PointCoord","radians","degrees","sin","cos","tan","asin","acos","atan","pow","exp","log","exp2","log2","sqrt","inversesqrt","abs","sign","floor","ceil","fract","mod","min","max","clamp","mix","step","smoothstep","length","distance","dot","cross","normalize","faceforward","reflect","refract","matrixCompMult","lessThan","lessThanEqual","greaterThan","greaterThanEqual","equal","notEqual","any","all","not","texture2D","texture2DProj","texture2DLod","texture2DProjLod","textureCube","textureCubeLod"]},{}],27:[function(t,e){e.exports=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"]},{}],28:[function(t,e){e.exports=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"]},{}],29:[function(t,e){var n;n=function(t,e){var n,r;return r=[],n=[],{output:r,parser:null,write:t,end:e,process:function(e,n){return this.parser=e,t(n),this.flush(),this.parser.flush()},flush:function(){return e(),[r,n]},queue:function(t){var e;return null!=t?null!=(e=this.parser)?e.write(t):void 0:void 0},emit:function(t,e){return"data"===t&&null==e.parent&&r.push(e),"error"===t?n.push(e):void 0}}},e.exports=n},{}]},{},[10]);