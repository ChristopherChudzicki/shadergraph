<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ShaderGraph - Test</title>
  <script type="text/javascript" src="../build/shadergraph.js"></script>

<script type="application/x-glsl" id="vertex">
attribute vec3 color;
varying vec3 vColor;

void main() {
  vColor = color;
}
</script>

<script type="application/x-glsl" id="getColor">
varying vec3 vColor;
vec3 getColor() {
  return vColor * vColor * 2.0;
}
</script>

<script type="application/x-glsl" id="setColor">
void setColor(vec3 color) {
  gl_FragColor = vec4(color, 1.0);
}
</script>

</head>
<body>
  <h6>See Console For Result</h6>
  <pre></pre>

  <script>

  // Fetch snippets above
  var fetch = function (key) {
    element = document.getElementById(key);
    return element.textContent || element.innerText;
  }

  // Load ShaderGraph with given fetch function
  // (can also pass in dictionary of snippets)
  shadergraph = ShaderGraph(fetch);

  // Prepare new material (vertex + fragment shader)
  material = shadergraph.material()

  // Build vertex shader graph
  material.vertex
    // Use a namespace to match up varying between two graphs
    .call('vertex', {}, 'shader')

  // Build fragment shader graph
  material.fragment
    // Repeat 'shader' namespace
    .call('getColor', {}, 'shader')
    .call('setColor')

  // Link both shaders and combine into a three.js style material
  program = material.build()

  // Show in document body
  result = program.vertexShader
         + "\n\n\n\n/********************/\n\n\n\n"
         + program.fragmentShader

  document.querySelector('pre').innerText = result
  console.log(program);

  </script>
  
</body>
</html>
